!function(e){"use strict";e.fn.filer=function(t){return this.each(function(a,n){var i=e(n),r=e(),o=e(),s=e(),l=[],d=e.isFunction(t)?t(i,e.fn.filer.defaults):t,c=d&&e.isPlainObject(d)?e.extend(!0,{},e.fn.filer.defaults,d):e.fn.filer.defaults,u={init:function(){i.wrap('<div class="jFiler"></div>'),u._set("props"),i.prop("jFiler").boxEl=r=i.closest(".jFiler"),u._changeInput()},_bindInput:function(){c.changeInput&&o.length>0&&o.on("click",u._clickHandler),i.on({focus:function(){o.addClass("focused")},blur:function(){o.removeClass("focused")},change:u._onChange}),c.dragDrop&&(c.dragDrop.dragContainer.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}),c.dragDrop.dragContainer.on("drop",u._dragDrop.drop),c.dragDrop.dragContainer.on("dragover",u._dragDrop.dragEnter),c.dragDrop.dragContainer.on("dragleave",u._dragDrop.dragLeave)),c.uploadFile&&c.clipBoardPaste&&e(window).on("paste",u._clipboardPaste)},_unbindInput:function(t){c.changeInput&&o.length>0&&o.off("click",u._clickHandler),t&&(i.off("change",u._onChange),c.dragDrop&&(c.dragDrop.dragContainer.off("drop",u._dragDrop.drop),c.dragDrop.dragContainer.off("dragover",u._dragDrop.dragEnter),c.dragDrop.dragContainer.off("dragleave",u._dragDrop.dragLeave)),c.uploadFile&&c.clipBoardPaste&&e(window).off("paste",u._clipboardPaste))},_clickHandler:function(){if(!c.uploadFile&&c.addMore&&0!=i.val().length){u._unbindInput(!0);var t=e('<input type="file" />'),a=i.prop("attributes");e.each(a,function(){"required"!=this.name&&t.attr(this.name,this.value)}),i.after(t),l.push(t),i=t,u._bindInput(),u._set("props")}i.click()},_applyAttrSettings:function(){var e=["name","limit","maxSize","fileMaxSize","extensions","changeInput","showThumbs","appendTo","theme","addMore","excludeName","files","uploadUrl","uploadData","options"];for(var t in e){var a="data-jfiler-"+e[t];if(u._assets.hasAttr(a)){switch(e[t]){case"changeInput":case"showThumbs":case"addMore":c[e[t]]=["true","false"].indexOf(i.attr(a))>-1?"true"==i.attr(a):i.attr(a);break;case"extensions":c[e[t]]=i.attr(a).replace(/ /g,"").split(",");break;case"uploadUrl":c.uploadFile&&(c.uploadFile.url=i.attr(a));break;case"uploadData":c.uploadFile&&(c.uploadFile.data=JSON.parse(i.attr(a)));break;case"files":case"options":c[e[t]]=JSON.parse(i.attr(a));break;default:c[e[t]]=i.attr(a)}i.removeAttr(a)}}},_changeInput:function(){if(u._applyAttrSettings(),null!=c.beforeRender&&"function"==typeof c.beforeRender&&c.beforeRender(r,i),c.theme&&r.addClass("jFiler-theme-"+c.theme),"input"!=i.get(0).tagName.toLowerCase()&&"file"!=i.get(0).type)o=i,(i=e('<input type="file" name="'+c.name+'" />')).css({position:"absolute",left:"-9999px",top:"-9999px","z-index":"-9999"}),r.prepend(i),u._isGn=i;else if(c.changeInput){switch(typeof c.changeInput){case"boolean":o=e('<div class="jFiler-input"><div class="jFiler-input-caption"><span>'+c.captions.feedback+'</span></div><div class="jFiler-input-button">'+c.captions.button+'</div></div>"');break;case"string":case"object":o=e(c.changeInput);break;case"function":o=e(c.changeInput(r,i,c))}i.after(o),i.css({position:"absolute",left:"-9999px",top:"-9999px","z-index":"-9999"})}i.prop("jFiler").newInputEl=o,c.dragDrop&&(c.dragDrop.dragContainer=c.dragDrop.dragContainer?e(c.dragDrop.dragContainer):o),(!c.limit||c.limit&&c.limit>=2)&&(i.attr("multiple","multiple"),"[]"!=i.attr("name").slice(-2)&&i.attr("name",i.attr("name")+"[]")),i.attr("disabled")||c.disabled?(c.disabled=!0,u._unbindInput(!0),r.addClass("jFiler-disabled")):(c.disabled=!1,u._bindInput(),r.removeClass("jFiler-disabled")),c.files&&u._append(!1,{files:c.files}),null!=c.afterRender&&"function"==typeof c.afterRender&&c.afterRender(s,r,o,i)},_clear:function(){u.files=null,i.prop("jFiler").files=null,c.uploadFile||c.addMore||u._reset(),u._set("feedback",u._itFl&&u._itFl.length>0?u._itFl.length+" "+c.captions.feedback2:c.captions.feedback),null!=c.onEmpty&&"function"==typeof c.onEmpty&&c.onEmpty(r,o,i)},_reset:function(t){if(!t){if(!c.uploadFile&&c.addMore){for(var a=0;a<l.length;a++)l[a].remove();l=[],u._unbindInput(!0),i=u._isGn?u._isGn:e(n),u._bindInput()}u._set("input","")}u._itFl=[],u._itFc=null,u._ajFc=0,u._set("props"),i.prop("jFiler").files_list=u._itFl,i.prop("jFiler").current_file=u._itFc,u._itFr=[],r.find("input[name^='jfiler-items-exclude-']:hidden").remove(),s.fadeOut("fast",function(){e(this).remove()}),i.prop("jFiler").listEl=s=e()},_set:function(e,t){switch(e){case"input":i.val(t);break;case"feedback":o.length>0&&o.find(".jFiler-input-caption span").html(t);break;case"props":i.prop("jFiler")||i.prop("jFiler",{options:c,listEl:s,boxEl:r,newInputEl:o,inputEl:i,files:u.files,files_list:u._itFl,current_file:u._itFc,append:function(e){return u._append(!1,{files:[e]})},enable:function(){c.disabled&&(c.disabled=!1,i.removeAttr("disabled"),r.removeClass("jFiler-disabled"),u._bindInput())},disable:function(){c.disabled||(c.disabled=!0,r.addClass("jFiler-disabled"),u._unbindInput(!0))},remove:function(e){return u._remove(null,{binded:!0,data:{id:e}}),!0},reset:function(){return u._reset(),u._clear(),!0},retry:function(e){return u._retryUpload(e)}})}},_filesCheck:function(){var t=0;if(c.limit&&u.files.length+u._itFl.length>c.limit)return c.dialogs.alert(u._assets.textParse(c.captions.errors.filesLimit)),!1;for(var a=0;a<u.files.length;a++){var n=u.files[a],i=n.name.split(".").pop().toLowerCase(),r={name:n.name,size:n.size,size2:u._assets.bytesToSize(n.size),type:n.type,ext:i};if(null!=c.extensions&&-1==e.inArray(i,c.extensions)&&-1==e.inArray(r.type,c.extensions))return c.dialogs.alert(u._assets.textParse(c.captions.errors.filesType,r)),!1;if(null!=c.maxSize&&u.files[a].size>1048576*c.maxSize||null!=c.fileMaxSize&&u.files[a].size>1048576*c.fileMaxSize)return c.dialogs.alert(u._assets.textParse(c.captions.errors.filesSize,r)),!1;if(4096==n.size&&0==n.type.length)return c.dialogs.alert(u._assets.textParse(c.captions.errors.folderUpload,r)),!1;if(null!=c.onFileCheck&&"function"==typeof c.onFileCheck&&!1===c.onFileCheck(r,c,u._assets.textParse))return!1;if((c.uploadFile||c.addMore)&&!c.allowDuplicates)if((r=u._itFl.filter(function(e,t){if(e.file.name==n.name&&e.file.size==n.size&&e.file.type==n.type&&(!n.lastModified||e.file.lastModified==n.lastModified))return!0})).length>0){if(1==u.files.length)return!1;n._pendRemove=!0}t+=u.files[a].size}return!(null!=c.maxSize&&t>=Math.round(1048576*c.maxSize)&&(c.dialogs.alert(u._assets.textParse(c.captions.errors.filesSizeAll)),1))},_thumbCreator:{create:function(t){var a=u.files[t],n=u._itFc?u._itFc.id:t,i=a.name,r=a.size,o=a.file,l=a.type?a.type.split("/",1):"".toString().toLowerCase(),d=-1!=i.indexOf(".")?i.split(".").pop().toLowerCase():"",p=c.uploadFile?'<div class="jFiler-jProgressBar">'+c.templates.progressBar+"</div>":"",m={id:n,name:i,size:r,size2:u._assets.bytesToSize(r),url:o,type:l,extension:d,icon:u._assets.getIcon(d,l),icon2:u._thumbCreator.generateIcon({type:l,extension:d}),image:'<div class="jFiler-item-thumb-image fi-loading"></div>',progressBar:p,_appended:a._appended},h="";return a.opts&&(m=e.extend({},a.opts,m)),(h=e(u._thumbCreator.renderContent(m)).attr("data-jfiler-index",n)).get(0).jfiler_id=n,u._thumbCreator.renderFile(a,h,m),a.forList?h:(u._itFc.html=h,h.hide()[c.templates.itemAppendToEnd?"appendTo":"prependTo"](s.find(c.templates._selectors.list)).show(),void(a._appended||u._onSelect(t)))},renderContent:function(e){return u._assets.textParse(e._appended?c.templates.itemAppend:c.templates.item,e)},renderFile:function(t,a,n){if(0==a.find(".jFiler-item-thumb-image").length)return!1;if(t.file&&"image"==n.type){var i='<img src="'+t.file+'" draggable="false" />',r=a.find(".jFiler-item-thumb-image.fi-loading");return e(i).error(function(){i=u._thumbCreator.generateIcon(n),a.addClass("jFiler-no-thumbnail"),r.removeClass("fi-loading").html(i)}).load(function(){r.removeClass("fi-loading").html(i)}),!0}if(window.File&&window.FileList&&window.FileReader&&"image"==n.type&&n.size<1e7){var o=new FileReader;o.onload=function(e){var t=a.find(".jFiler-item-thumb-image.fi-loading");if(c.templates.canvasImage){var i=document.createElement("canvas"),r=i.getContext("2d"),o=new Image;o.onload=function(){var e=t.height(),a=t.width(),n=o.height/e,s=o.width/a,l=n<s?n:s,d=o.height/l,c=o.width/l,u=Math.ceil(Math.log(o.width/c)/Math.log(2));if(i.height=e,i.width=a,o.width<i.width||o.height<i.height||u<=1){var p=o.width<i.width?i.width/2-o.width/2:o.width>i.width?-(o.width-i.width)/2:0,m=o.height<i.height?i.height/2-o.height/2:0;r.drawImage(o,p,m,o.width,o.height)}else{var h=document.createElement("canvas"),f=h.getContext("2d");h.width=.5*o.width,h.height=.5*o.height,f.fillStyle="#fff",f.fillRect(0,0,h.width,h.height),f.drawImage(o,0,0,h.width,h.height),f.drawImage(h,0,0,.5*h.width,.5*h.height),r.drawImage(h,c>i.width?c-i.width:0,0,.5*h.width,.5*h.height,0,0,c,d)}t.removeClass("fi-loading").html('<img src="'+i.toDataURL("image/png")+'" draggable="false" />')},o.onerror=function(){a.addClass("jFiler-no-thumbnail"),t.removeClass("fi-loading").html(u._thumbCreator.generateIcon(n))},o.src=e.target.result}else t.removeClass("fi-loading").html('<img src="'+e.target.result+'" draggable="false" />')},o.readAsDataURL(t)}else{i=u._thumbCreator.generateIcon(n),r=a.find(".jFiler-item-thumb-image.fi-loading");a.addClass("jFiler-no-thumbnail"),r.removeClass("fi-loading").html(i)}},generateIcon:function(t){var a=new Array(3);if(t&&t.type&&t.type[0]&&t.extension)switch(t.type[0]){case"image":a[0]="f-image",a[1]='<i class="icon-jfi-file-image"></i>';break;case"video":a[0]="f-video",a[1]='<i class="icon-jfi-file-video"></i>';break;case"audio":a[0]="f-audio",a[1]='<i class="icon-jfi-file-audio"></i>';break;default:a[0]="f-file f-file-ext-"+t.extension,a[1]=t.extension.length>0?"."+t.extension:"",a[2]=1}else a[0]="f-file",a[1]=t.extension&&t.extension.length>0?"."+t.extension:"",a[2]=1;var n='<span class="jFiler-icon-file '+a[0]+'">'+a[1]+"</span>";if(1==a[2]&&u._assets.text2Color(t.extension)){var i=e(n).appendTo("body");i.css("background-color",u._assets.text2Color(t.extension)),n=i.prop("outerHTML"),i.remove()}return n},_box:function(t){if(null!=c.beforeShow&&"function"==typeof c.beforeShow&&!c.beforeShow(u.files,s,r,o,i))return!1;if(s.length<1){if(c.appendTo)var a=e(c.appendTo);else a=r;a.find(".jFiler-items").remove(),s=e('<div class="jFiler-items jFiler-row"></div>'),i.prop("jFiler").listEl=s,s.append(u._assets.textParse(c.templates.box)).appendTo(a),s.on("click",c.templates._selectors.remove,function(a){a.preventDefault();var n=[t?t.remove.event:a,t?t.remove.el:e(this).closest(c.templates._selectors.item)],i=function(e){u._remove(n[0],n[1])};c.templates.removeConfirmation?c.dialogs.confirm(c.captions.removeConfirmation,i):i()})}for(var n=0;n<u.files.length;n++)u.files[n]._appended||(u.files[n]._choosed=!0),u._addToMemory(n),u._thumbCreator.create(n)}},_upload:function(t){var a=u._itFl[t],n=a.html,r=new FormData;if(r.append(i.attr("name"),a.file,!!a.file.name&&a.file.name),null!=c.uploadFile.data&&e.isPlainObject("function"==typeof c.uploadFile.data?c.uploadFile.data(a.file):c.uploadFile.data))for(var o in c.uploadFile.data)r.append(o,c.uploadFile.data[o]);u._ajax.send(n,r,a)},_ajax:{send:function(t,a,n){return n.ajax=e.ajax({url:c.uploadFile.url,data:a,type:c.uploadFile.type,enctype:c.uploadFile.enctype,xhr:function(){var a=e.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",function(e){u._ajax.progressHandling(e,t)},!1),a},complete:function(e,t){n.ajax=!1,u._ajFc++,c.uploadFile.synchron&&n.id+1<u._itFl.length&&u._upload(n.id+1),u._ajFc>=u.files.length&&(u._ajFc=0,i.get(0).value="",null!=c.uploadFile.onComplete&&"function"==typeof c.uploadFile.onComplete&&c.uploadFile.onComplete(s,r,o,i,e,t))},beforeSend:function(e,a){return null==c.uploadFile.beforeSend||"function"!=typeof c.uploadFile.beforeSend||c.uploadFile.beforeSend(t,s,r,o,i,n.id,e,a)},success:function(e,a,l){n.uploaded=!0,null!=c.uploadFile.success&&"function"==typeof c.uploadFile.success&&c.uploadFile.success(e,t,s,r,o,i,n.id,a,l)},error:function(e,a,l){n.uploaded=!1,null!=c.uploadFile.error&&"function"==typeof c.uploadFile.error&&c.uploadFile.error(t,s,r,o,i,n.id,e,a,l)},statusCode:c.uploadFile.statusCode,cache:!1,contentType:!1,processData:!1}),n.ajax},progressHandling:function(e,t){if(e.lengthComputable){var a=Math.round(100*e.loaded/e.total).toString();null!=c.uploadFile.onProgress&&"function"==typeof c.uploadFile.onProgress&&c.uploadFile.onProgress(a,t,s,r,o,i),t.find(".jFiler-jProgressBar").find(c.templates._selectors.progressBar).css("width",a+"%")}}},_dragDrop:{dragEnter:function(e){clearTimeout(u._dragDrop._drt),c.dragDrop.dragContainer.addClass("dragged"),u._set("feedback",c.captions.drop),null!=c.dragDrop.dragEnter&&"function"==typeof c.dragDrop.dragEnter&&c.dragDrop.dragEnter(e,o,i,r)},dragLeave:function(e){clearTimeout(u._dragDrop._drt),u._dragDrop._drt=setTimeout(function(e){return u._dragDrop._dragLeaveCheck(e)?(c.dragDrop.dragContainer.removeClass("dragged"),u._set("feedback",c.captions.feedback),void(null!=c.dragDrop.dragLeave&&"function"==typeof c.dragDrop.dragLeave&&c.dragDrop.dragLeave(e,o,i,r))):(u._dragDrop.dragLeave(e),!1)},100,e)},drop:function(e){clearTimeout(u._dragDrop._drt),c.dragDrop.dragContainer.removeClass("dragged"),u._set("feedback",c.captions.feedback),e&&e.originalEvent&&e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files&&e.originalEvent.dataTransfer.files.length>0&&u._onChange(e,e.originalEvent.dataTransfer.files),null!=c.dragDrop.drop&&"function"==typeof c.dragDrop.drop&&c.dragDrop.drop(e.originalEvent.dataTransfer.files,e,o,i,r)},_dragLeaveCheck:function(t){var a=e(t.currentTarget),n=0;return!(!a.is(o)&&(n=o.find(a).length,n>0))}},_clipboardPaste:function(e,t){if((t||e.originalEvent.clipboardData||e.originalEvent.clipboardData.items)&&(!t||e.originalEvent.dataTransfer||e.originalEvent.dataTransfer.items)&&!u._clPsePre){var a=t?e.originalEvent.dataTransfer.items:e.originalEvent.clipboardData.items,n=function(e,t,a){t=t||"",a=a||512;for(var n=atob(e),i=[],r=0;r<n.length;r+=a){for(var o=n.slice(r,r+a),s=new Array(o.length),l=0;l<o.length;l++)s[l]=o.charCodeAt(l);var d=new Uint8Array(s);i.push(d)}return new Blob(i,{type:t})};if(a)for(var i=0;i<a.length;i++)if(-1!==a[i].type.indexOf("image")||-1!==a[i].type.indexOf("text/uri-list")){if(t)try{window.atob(e.originalEvent.dataTransfer.getData("text/uri-list").toString().split(",")[1])}catch(e){return}var r=t?n(e.originalEvent.dataTransfer.getData("text/uri-list").toString().split(",")[1],"image/png"):a[i].getAsFile();r.name=Math.random().toString(36).substring(5),r.name+=-1!=r.type.indexOf("/")?"."+r.type.split("/")[1].toString().toLowerCase():".png",u._onChange(e,[r]),u._clPsePre=setTimeout(function(){delete u._clPsePre},1e3)}}},_onSelect:function(t){c.uploadFile&&!e.isEmptyObject(c.uploadFile)&&(!c.uploadFile.synchron||c.uploadFile.synchron&&0==e.grep(u._itFl,function(e){return e.ajax}).length)&&u._upload(u._itFc.id),u.files[t]._pendRemove&&(u._itFc.html.hide(),u._remove(null,{binded:!0,data:{id:u._itFc.id}})),null!=c.onSelect&&"function"==typeof c.onSelect&&c.onSelect(u.files[t],u._itFc.html,s,r,o,i),t+1>=u.files.length&&null!=c.afterShow&&"function"==typeof c.afterShow&&c.afterShow(s,r,o,i)},_onChange:function(t,a){if(a){if(!a||0==a.length)return u._set("input",""),u._clear(),!1;u.files=a}else{if(!i.get(0).files||void 0===i.get(0).files||0==i.get(0).files.length)return c.uploadFile||c.addMore||(u._set("input",""),u._clear()),!1;u.files=i.get(0).files}if(c.uploadFile||c.addMore||u._reset(!0),i.prop("jFiler").files=u.files,!u._filesCheck()||null!=c.beforeSelect&&"function"==typeof c.beforeSelect&&!c.beforeSelect(u.files,s,r,o,i))return u._set("input",""),u._clear(),c.addMore&&l.length>0&&(u._unbindInput(!0),l[l.length-1].remove(),l.splice(l.length-1,1),i=l.length>0?l[l.length-1]:e(n),u._bindInput()),!1;if(u._set("feedback",u.files.length+u._itFl.length+" "+c.captions.feedback2),c.showThumbs)u._thumbCreator._box();else for(var d=0;d<u.files.length;d++)u.files[d]._choosed=!0,u._addToMemory(d),u._onSelect(d)},_append:function(e,t){var a=!!t&&t.files;if(a&&!(a.length<=0)&&(u.files=a,i.prop("jFiler").files=u.files,c.showThumbs)){for(var n=0;n<u.files.length;n++)u.files[n]._appended=!0;u._thumbCreator._box()}},_getList:function(e,t){var a=!!t&&t.files;if(a&&!(a.length<=0)&&(u.files=a,i.prop("jFiler").files=u.files,c.showThumbs)){for(var n=[],l=0;l<u.files.length;l++)u.files[l].forList=!0,n.push(u._thumbCreator.create(l));t.callback&&t.callback(n,s,r,o,i)}},_retryUpload:function(t,a){var n=parseInt("object"==typeof a?a.attr("data-jfiler-index"):a),r=u._itFl.filter(function(e,t){return e.id==n});return r.length>0&&(!c.uploadFile||e.isEmptyObject(c.uploadFile)||r[0].uploaded?void 0:(u._itFc=r[0],i.prop("jFiler").current_file=u._itFc,u._upload(n),!0))},_remove:function(t,n){if(n.binded){if(void 0!==n.data.id&&0==(n=s.find(c.templates._selectors.item+"[data-jfiler-index='"+n.data.id+"']")).length)return!1;n.data.el&&(n=n.data.el)}var l=function(t,n){var o,s,l=u._itFl[n],d=[];if(l.file._choosed||l.file._appended||l.uploaded){u._itFr.push(l);for(var p=u._itFl.filter(function(e){return e.file.name==l.file.name}),m=0;m<u._itFr.length;m++)c.addMore&&u._itFr[m]==l&&p.length>0&&(u._itFr[m].remove_name=p.indexOf(l)+"://"+u._itFr[m].file.name),d.push(u._itFr[m].remove_name?u._itFr[m].remove_name:u._itFr[m].file.name)}o=d,0==(s=r.find("input[name^='jfiler-items-exclude-']:hidden").first()).length&&(s=e('<input type="hidden" name="jfiler-items-exclude-'+(c.excludeName?c.excludeName:("[]"!=i.attr("name").slice(-2)?i.attr("name"):i.attr("name").substring(0,i.attr("name").length-2))+"-"+a)+'">')).appendTo(r),o&&e.isArray(o)&&(o=JSON.stringify(o),s.val(o)),u._itFl.splice(n,1),u._itFl.length<1?(u._reset(),u._clear()):u._set("feedback",u._itFl.length+" "+c.captions.feedback2),t.fadeOut("fast",function(){e(this).remove()})},d=n.get(0).jfiler_id||n.attr("data-jfiler-index"),p=null;for(var m in u._itFl)"length"!==m&&u._itFl.hasOwnProperty(m)&&u._itFl[m].id==d&&(p=m);return!!u._itFl.hasOwnProperty(p)&&(u._itFl[p].ajax?(u._itFl[p].ajax.abort(),void l(n,p)):void(null!=c.onRemove&&"function"==typeof c.onRemove&&!1===c.onRemove(n,u._itFl[p].file,p,s,r,o,i)||l(n,p)))},_addToMemory:function(t){u._itFl.push({id:u._itFl.length,file:u.files[t],html:e(),ajax:!1,uploaded:!1}),(c.addMore||u.files[t]._appended)&&(u._itFl[u._itFl.length-1].input=i),u._itFc=u._itFl[u._itFl.length-1],i.prop("jFiler").files_list=u._itFl,i.prop("jFiler").current_file=u._itFc},_assets:{bytesToSize:function(e){if(0==e)return"0 Byte";var t=Math.floor(Math.log(e)/Math.log(1e3));return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},hasAttr:function(e,t){var a=(t=t||i).attr(e);return!(!a||void 0===a)},getIcon:function(t,a){return e.inArray(a,["audio","image","text","video"])>-1?'<i class="icon-jfi-file-'+a+" jfi-file-ext-"+t+'"></i>':'<i class="icon-jfi-file-o jfi-file-type-'+a+" jfi-file-ext-"+t+'"></i>'},textParse:function(t,a){switch(a=e.extend({},{limit:c.limit,maxSize:c.maxSize,fileMaxSize:c.fileMaxSize,extensions:c.extensions?c.extensions.join(","):null},a&&e.isPlainObject(a)?a:{},c.options),typeof t){case"string":return t.replace(/\{\{fi-(.*?)\}\}/g,function(e,t){return(t=t.replace(/ /g,"")).match(/(.*?)\|limitTo\:(\d+)/)?t.replace(/(.*?)\|limitTo\:(\d+)/,function(e,t,n){var i=(t=a[t]?a[t]:"").substring(0,n);return t.length>i.length?i.substring(0,i.length-3)+"...":i}):a[t]?a[t]:""});case"function":return t(a);default:return t}},text2Color:function(e){if(!e||0==e.length)return!1;for(var t=0,a=0;t<e.length;a=e.charCodeAt(t++)+((a<<5)-a));t=0;for(var n="#";t<3;n+=("00"+(a>>2*t++&255).toString(16)).slice(-2));return n}},files:null,_itFl:[],_itFc:null,_itFr:[],_itPl:[],_ajFc:0};return i.on("filer.append",function(e,t){u._append(e,t)}).on("filer.remove",function(e,t){t.binded=!0,u._remove(e,t)}).on("filer.reset",function(e){return u._reset(),u._clear(),!0}).on("filer.generateList",function(e,t){return u._getList(e,t)}).on("filer.retry",function(e,t){return u._retryUpload(e,t)}),u.init(),this})},e.fn.filer.defaults={limit:null,maxSize:null,fileMaxSize:null,extensions:null,changeInput:!0,showThumbs:!1,appendTo:null,theme:"default",templates:{box:'<ul class="jFiler-items-list jFiler-items-default"></ul>',item:'<li class="jFiler-item"><div class="jFiler-item-container"><div class="jFiler-item-inner"><div class="jFiler-item-icon pull-left">{{fi-icon}}</div><div class="jFiler-item-info pull-left"><div class="jFiler-item-title" title="{{fi-name}}">{{fi-name | limitTo:30}}</div><div class="jFiler-item-others"><span>size: {{fi-size2}}</span><span>type: {{fi-extension}}</span><span class="jFiler-item-status">{{fi-progressBar}}</span></div><div class="jFiler-item-assets"><ul class="list-inline"><li><a class="icon-jfi-trash jFiler-item-trash-action"></a></li></ul></div></div></div></div></li>',itemAppend:'<li class="jFiler-item"><div class="jFiler-item-container"><div class="jFiler-item-inner"><div class="jFiler-item-icon pull-left">{{fi-icon}}</div><div class="jFiler-item-info pull-left"><div class="jFiler-item-title">{{fi-name | limitTo:35}}</div><div class="jFiler-item-others"><span>size: {{fi-size2}}</span><span>type: {{fi-extension}}</span><span class="jFiler-item-status"></span></div><div class="jFiler-item-assets"><ul class="list-inline"><li><a class="icon-jfi-trash jFiler-item-trash-action"></a></li></ul></div></div></div></div></li>',progressBar:'<div class="bar"></div>',itemAppendToEnd:!1,removeConfirmation:!0,canvasImage:!0,_selectors:{list:".jFiler-items-list",item:".jFiler-item",progressBar:".bar",remove:".jFiler-item-trash-action"}},files:null,uploadFile:null,dragDrop:null,addMore:!1,allowDuplicates:!1,clipBoardPaste:!0,excludeName:null,beforeRender:null,afterRender:null,beforeShow:null,beforeSelect:null,onSelect:null,onFileCheck:null,afterShow:null,onRemove:null,onEmpty:null,options:null,dialogs:{alert:function(e){return alert(e)},confirm:function(e,t){confirm(e)&&t()}},captions:{button:"Choose Files",feedback:"Choose files To Upload",feedback2:"files were chosen",drop:"Drop file here to Upload",removeConfirmation:"Are you sure you want to remove this file?",errors:{filesLimit:"Only {{fi-limit}} files are allowed to be uploaded.",filesType:"Only Images are allowed to be uploaded.",filesSize:"{{fi-name}} is too large! Please upload file up to {{fi-fileMaxSize}} MB.",filesSizeAll:"Files you've choosed are too large! Please upload files up to {{fi-maxSize}} MB.",folderUpload:"You are not allowed to upload folders."}}}}(jQuery),"undefined"==typeof Tablesaw&&(Tablesaw={i18n:{modes:["Stack","Swipe","Toggle"],columns:'Col<span class="a11y-sm">umn</span>s',columnBtnText:"Columns",columnsDialogError:"No eligible columns.",sort:"Sort"},mustard:"querySelector"in document&&(!window.blackberry||window.WebKitPoint)&&!window.operamini}),Tablesaw.config||(Tablesaw.config={}),Tablesaw.mustard&&jQuery(document.documentElement).addClass("tablesaw-enhanced"),function(e){var t="table",a="tablesaw-bar",n="tablesawcreate",i="tablesawdestroy",r="tablesawrefresh",o=function(t){if(!t)throw new Error("Tablesaw requires an element.");this.table=t,this.$table=e(t),this.mode=this.$table.attr("data-tablesaw-mode")||"stack",this.init()};o.prototype.init=function(){this.$table.attr("id")||this.$table.attr("id",t+"-"+Math.round(1e4*Math.random())),this.createToolbar();var e=this._initCells();this.$table.trigger(n,[this,e])},o.prototype._initCells=function(){var t,a=this.table.querySelectorAll("thead tr"),n=this;return e(a).each(function(){var i=0;e(this).children().each(function(){var e=parseInt(this.getAttribute("colspan"),10),r=":nth-child("+(i+1)+")";if(t=i+1,e)for(var o=0;o<e-1;o++)r+=", :nth-child("+(++i+1)+")";this.cells=n.$table.find("tr").not(a[0]).not(this).children().filter(r),i++})}),t},o.prototype.refresh=function(){this._initCells(),this.$table.trigger(r)},o.prototype.createToolbar=function(){var t=this.$table.prev().filter("."+a);t.length||(t=e("<div>").addClass(a).insertBefore(this.$table)),this.$toolbar=t,this.mode&&this.$toolbar.addClass("mode-"+this.mode)},o.prototype.destroy=function(){this.$table.prev().filter("."+a).each(function(){this.className=this.className.replace(/\bmode\-\w*\b/gi,"")});var n=this.$table.attr("id");e(document).unbind("."+n),e(window).unbind("."+n),this.$table.trigger(i,[this]),this.$table.removeData(t)},e.fn[t]=function(){return this.each(function(){var a=e(this);if(!a.data(t)){var n=new o(this);a.data(t,n)}})},e(document).on("enhance.tablesaw",function(a){Tablesaw.mustard&&e(a.target).find("table[data-tablesaw-mode],table[data-tablesaw-sortable]")[t]()})}(jQuery),function(e,t,a){var n="tablesaw-stack",i="tablesaw-cell-label",r="tablesaw-cell-content",o="tablesaw-stack",s="data-tablesaw-no-labels",l="data-tablesaw-hide-empty",d=function(e){this.$table=t(e),this.labelless=this.$table.is("["+s+"]"),this.hideempty=this.$table.is("["+l+"]"),this.labelless||(this.allHeaders=this.$table.find("th")),this.$table.data(o,this)};d.prototype.init=function(e){if(this.$table.addClass(n),!this.labelless){var a=t(this.allHeaders),o=this.hideempty;a.each(function(){var a=t(this),n=t(this.cells).filter(function(){return!(t(this).parent().is("["+s+"]")||o&&t(this).is(":empty"))}),l=n.not(this).filter("thead th").length&&" tablesaw-cell-label-top",d=a.find(".tablesaw-sortable-btn"),c=d.length?d.html():a.html();if(""!==c)if(l){var u=parseInt(t(this).attr("colspan"),10),p="";u&&(p="td:nth-child("+u+"n + "+e+")"),n.filter(p).prepend("<b class='"+i+l+"'>"+c+"</b>")}else n.wrapInner("<span class='"+r+"'></span>"),n.prepend("<b class='"+i+"'>"+c+"</b>")})}},d.prototype.destroy=function(){this.$table.removeClass(n),this.$table.find("."+i).remove(),this.$table.find("."+r).each(function(){t(this).replaceWith(this.childNodes)})},t(document).on("tablesawcreate",function(e,t,a){"stack"===t.mode&&new d(t.table).init(a)}),t(document).on("tablesawdestroy",function(e,a){"stack"===a.mode&&t(a.table).data(o).destroy()})}(0,jQuery),function(e){var t="tablesawbtn",a={_create:function(){return e(this).each(function(){e(this).trigger("beforecreate."+t)[t]("_init").trigger("create."+t)})},_init:function(){var a=e(this),n=this.getElementsByTagName("select")[0];return n&&e(this).addClass("btn-select")[t]("_select",n),a},_select:function(t){var a=function(t,a){var n,i,r,o=e(a).find("option");if(o.each(function(){this.selected&&(n=document.createTextNode(this.text))}),r=t.childNodes,o.length>0)for(var s=0,l=r.length;s<l;s++)(i=r[s])&&3===i.nodeType&&t.replaceChild(n,i)};a(this,t),e(this).bind("change refresh",function(){a(this,t)})}};e.fn[t]=function(a,n,i,r){return this.each(function(){return a&&"string"==typeof a?e.fn[t].prototype[a].call(this,n,i,r):e(this).data(t+"active")?e(this):(e(this).data(t+"active",!0),void e.fn[t].prototype._create.call(this))})},e.extend(e.fn[t].prototype,a)}(jQuery),function(e,t,a){var n=function(e){this.$table=t(e),this.classes={columnToggleTable:"tablesaw-columntoggle",columnBtnContain:"tablesaw-columntoggle-btnwrap tablesaw-advance",columnBtn:"tablesaw-columntoggle-btn tablesaw-nav-btn down",popup:"tablesaw-columntoggle-popup",priorityPrefix:"tablesaw-priority-",toolbar:"tablesaw-bar"},this.headers=this.$table.find("tr:first > th"),this.$table.data("tablesaw-coltoggle",this)};n.prototype.init=function(){var e,a,n,i,r,o,s=this;this.$table.addClass(this.classes.columnToggleTable),a=(e=this.$table.attr("id"))+"-popup",o=t("<div class='"+this.classes.columnBtnContain+"'></div>"),n=t("<a href='#"+a+"' class='btn btn-micro "+this.classes.columnBtn+"' data-popup-link><span>"+Tablesaw.i18n.columnBtnText+"</span></a>"),i=t("<div class='dialog-table-coltoggle "+this.classes.popup+"' id='"+a+"'></div>"),r=t("<div class='btn-group'></div>");var l,d=!1;function c(a){a&&t(a.target).closest("."+s.classes.popup).length||(t(document).unbind("click."+e),n.removeClass("up").addClass("down"),o.removeClass("visible"))}t(this.headers).not("td").each(function(){var e=t(this),a=e.attr("data-tablesaw-priority"),n=s.$getCells(this);a&&"persist"!==a&&(n.addClass(s.classes.priorityPrefix+a),t("<label><input type='checkbox' checked>"+e.text()+"</label>").appendTo(r).children(0).data("tablesaw-header",this),d=!0)}),d||r.append("<label>"+Tablesaw.i18n.columnsDialogError+"</label>"),r.appendTo(i),r.find('input[type="checkbox"]').on("change",function(e){var t=e.target.checked;s.$getCellsFromCheckbox(e.target).toggleClass("tablesaw-cell-hidden",!t).toggleClass("tablesaw-cell-visible",t),s.$table.trigger("tablesawcolumns")}),n.appendTo(o),o.appendTo(this.$table.prev().filter("."+this.classes.toolbar)),n.on("click.tablesaw",function(a){a.preventDefault(),o.is(".visible")?c():(o.addClass("visible"),n.removeClass("down").addClass("up"),t(document).unbind("click."+e,c),window.clearTimeout(l),l=window.setTimeout(function(){t(document).one("click."+e,c)},15))}),i.appendTo(o),this.$menu=r,t(window).on("resize."+e,function(){s.refreshToggle()}),this.refreshToggle()},n.prototype.$getCells=function(e){return t(e).add(e.cells)},n.prototype.$getCellsFromCheckbox=function(e){var a=t(e).data("tablesaw-header");return this.$getCells(a)},n.prototype.refreshToggle=function(){var e=this;this.$menu.find("input").each(function(){this.checked="table-cell"===e.$getCellsFromCheckbox(this).eq(0).css("display")})},n.prototype.refreshPriority=function(){var e=this;t(this.headers).not("td").each(function(){var a=t(this),n=a.attr("data-tablesaw-priority"),i=a.add(this.cells);n&&"persist"!==n&&i.addClass(e.classes.priorityPrefix+n)})},n.prototype.destroy=function(){this.$table.removeClass(this.classes.columnToggleTable),this.$table.find("th, td").each(function(){t(this).removeClass("tablesaw-cell-hidden").removeClass("tablesaw-cell-visible"),this.className=this.className.replace(/\bui\-table\-priority\-\d\b/g,"")})},t(document).on("tablesawcreate",function(e,t){"columntoggle"===t.mode&&new n(t.table).init()}),t(document).on("tablesawdestroy",function(e,a){"columntoggle"===a.mode&&t(a.table).data("tablesaw-coltoggle").destroy()})}(0,jQuery),function(e,t,a){t.extend(Tablesaw.config,{swipe:{horizontalThreshold:15,verticalThreshold:30}});var n={toolbar:"tablesaw-bar",hideBtn:"disabled",persistWidths:"tablesaw-fix-persist",allColumnsVisible:"tablesaw-all-cols-visible"};function i(a){var i,r,o=t("<div class='tablesaw-advance'></div>"),s=t("<a href='#' class='tablesaw-nav-btn btn btn-micro left' title='Previous Column'></a>").appendTo(o),l=t("<a href='#' class='tablesaw-nav-btn btn btn-micro right' title='Next Column'></a>").appendTo(o),d=a.find("thead th"),c=d.not('[data-tablesaw-priority="persist"]'),u=[],p=t(document.head||"head"),m=a.attr("id"),h=(i=document.createElement("div"),r=i.getElementsByTagName("i"),i.innerHTML="\x3c!--[if lte IE 8]><i></i><![endif]--\x3e",!r.length);if(!d.length)throw new Error("tablesaw swipe: no header cells found. Are you using <th> inside of <thead>?");function f(e){return t(e.cells).add(e)}function g(e){f(e).removeClass("tablesaw-cell-hidden")}function v(e){f(e).addClass("tablesaw-cell-hidden")}function $(){var e,i="#"+m+".tablesaw-swipe ",r=[],o=a.width(),s=[];d.each(function(e){var a;t(this).is('[data-tablesaw-priority="persist"]')&&(a=t(this).outerWidth())<.75*o&&(s.push(e+"-"+a),r.push(i+" .tablesaw-cell-persist:nth-child("+(e+1)+") { width: "+a+"px; }"))}),e=s.join("_"),a.addClass(n.persistWidths);var l=t("#"+m+"-persist");l.length&&l.data("hash")===e||(l.remove(),r.length&&t("<style>"+r.join("\n")+"</style>").attr("id",m+"-persist").data("hash",e).appendTo(p))}function b(){var e,a=[];return c.each(function(n){var i=t(this),r="none"===i.css("display")||i.is(".tablesaw-cell-hidden");if(r||e){if(r&&e)return a[1]=n,!1}else e=!0,a[0]=n}),a}function w(){var e=b();return[e[1]-1,e[0]-1]}function y(e){return e[1]>-1&&e[1]<c.length}function C(){if(!(i=a.attr("data-tablesaw-swipe-media"))||"matchMedia"in e&&e.matchMedia(i).matches){var i,r=a.parent().width(),o=[],s=0,l=[],c=d.length;d.each(function(e){var a=t(this).is('[data-tablesaw-priority="persist"]');o.push(a),s+=u[e]+(a?0:20),l.push(s),(a||s>r)&&c--});var p=0===c;d.each(function(e){o[e]?f(this).addClass("tablesaw-cell-persist"):l[e]<=r||p?(p=!1,g(this)):v(this)}),h&&(a.removeClass(n.persistWidths),t("#"+m+"-persist").remove()),a.trigger("tablesawcolumns")}}function k(e){var t=e?b():w();y(t)&&(isNaN(t[0])&&(t[0]=e?0:c.length-1),h&&$(),v(c.get(t[0])),g(c.get(t[1])),a.trigger("tablesawcolumns"))}function _(e,t){return(e.touches||e.originalEvent.touches)[0][t]}a.css("width","auto"),d.each(function(){u.push(t(this).outerWidth())}),a.css("width",""),o.appendTo(a.prev().filter(".tablesaw-bar")),a.addClass("tablesaw-swipe"),m||(m="tableswipe-"+Math.round(1e4*Math.random()),a.attr("id",m)),s.add(l).click(function(e){k(!!t(e.target).closest(l).length),e.preventDefault()}),a.bind("touchstart.swipetoggle",function(a){var n,i,r=_(a,"pageX"),o=_(a,"pageY");t(e).off("resize",C),t(this).bind("touchmove",function(e){n=_(e,"pageX"),i=_(e,"pageY");var t=Tablesaw.config.swipe;Math.abs(n-r)>t.horizontalThreshold&&Math.abs(i-o)<t.verticalThreshold&&e.preventDefault()}).bind("touchend.swipetoggle",function(){var a=Tablesaw.config.swipe;Math.abs(i-o)<a.verticalThreshold&&(n-r<-1*a.horizontalThreshold&&k(!0),n-r>a.horizontalThreshold&&k(!1)),window.setTimeout(function(){t(e).on("resize",C)},300),t(this).unbind("touchmove touchend")})}).bind("tablesawcolumns.swipetoggle",function(){var e=y(w()),t=y(b());s[e?"removeClass":"addClass"](n.hideBtn),l[t?"removeClass":"addClass"](n.hideBtn),s.closest("."+n.toolbar)[e||t?"removeClass":"addClass"](n.allColumnsVisible)}).bind("tablesawnext.swipetoggle",function(){k(!0)}).bind("tablesawprev.swipetoggle",function(){k(!1)}).bind("tablesawdestroy.swipetoggle",function(){var a=t(this);a.removeClass("tablesaw-swipe"),a.prev().filter(".tablesaw-bar").find(".tablesaw-advance").remove(),t(e).off("resize",C),a.unbind(".swipetoggle")}),C(),t(e).on("resize",C)}t(document).on("tablesawcreate",function(e,t){"swipe"===t.mode&&i(t.$table)})}(this,jQuery),function(e){function t(t){return e.map(t.childNodes,function(t){var a=e(t);return a.is("input, select")?a.val():a.hasClass("tablesaw-cell-label")?void 0:e.trim(a.text())}).join("")}var a="tablesaw-sortable",n="data-tablesaw-sortable-default-col",i={head:a+"-head",ascend:a+"-ascending",descend:a+"-descending",switcher:a+"-switch",tableToolbar:"tablesaw-toolbar",sortButton:a+"-btn"},r={_create:function(t){return e(this).each(function(){if(e(this).data("init"+a))return!1;e(this).data("init"+a,!0).trigger("beforecreate."+a)[a]("_init",t).trigger("create."+a)})},_init:function(){var r,o,s,l,d,c,u=e(this),p=function(t){e.each(t,function(t,a){var r=e(a);r.removeAttr(n),r.removeClass(i.ascend),r.removeClass(i.descend)})};u.addClass(a),r=u.find("thead th[data-"+a+"-col]"),s=r,e.each(s,function(t,a){e(a).addClass(i.head)}),l=r,d=function(t){if(!e(t.target).is("a[href]")){t.stopPropagation();var n=e(this).parent(),s=t.data.col,l=r.index(n);p(n.siblings()),n.hasClass(i.descend)?(u[a]("sortBy",s,!0),l+="_asc"):(u[a]("sortBy",s),l+="_desc"),o&&o.find("select").val(l).trigger("refresh"),t.preventDefault()}},e.each(l,function(t,a){var n=e("<button class='"+i.sortButton+"'/>");n.bind("click",{col:a},d),e(a).wrapInner(n)}),c=r,e.each(c,function(t,a){var r=e(a);r.is("["+n+"]")&&(r.hasClass(i.descend)||r.addClass(i.ascend))}),u.is("[data-tablesaw-sortable-switch]")&&function(r){o=e("<div>").addClass(i.switcher).addClass(i.tableToolbar).html(function(){var a=["<label>"+Tablesaw.i18n.sort+":"];return a.push('<span class="btn btn-small">&#160;<select>'),r.each(function(r){var o=e(this),s=o.is("["+n+"]"),l=o.hasClass(i.descend),d=o.is("[data-sortable-numeric]"),c=0;e(this.cells).slice(0,5).each(function(){isNaN(parseInt(t(this),10))||c++});var u=5===c;d||o.attr("data-sortable-numeric",u?"":"false"),a.push("<option"+(s&&!l?" selected":"")+' value="'+r+'_asc">'+o.text()+" "+(u?"&#x2191;":"(A-Z)")+"</option>"),a.push("<option"+(s&&l?" selected":"")+' value="'+r+'_desc">'+o.text()+" "+(u?"&#x2193;":"(Z-A)")+"</option>")}),a.push("</select></span></label>"),a.join("")});var s=u.prev().filter(".tablesaw-bar"),l=s.children().eq(0);l.length?o.insertBefore(l):o.appendTo(s),o.find(".btn").tablesawbtn(),o.find("select").on("change",function(){var t=e(this).val().split("_"),n=r.eq(t[0]);p(n.siblings()),u[a]("sortBy",n.get(0),"asc"===t[1])})}(r,u.find("tbody tr:nth-child(-n+3)"))},getColumnNumber:function(t){return e(t).prevAll().length},getTableRows:function(){return e(this).find("tbody tr")},sortRows:function(a,n,i,r){var o,s,l,d;l=a,d=[],e.each(l,function(a,i){var r=e(i).children().get(n);d.push({element:r,cell:t(r),rowNum:a})}),o=d;var c,u,p,m=e(r).data("tablesaw-sort");return s=!(!m||"function"!=typeof m)&&m(i)||(c=i,u=e(r).is("[data-sortable-numeric]")&&!e(r).is('[data-sortable-numeric="false"]'),p=/[^\-\+\d\.]/g,c?function(e,t){return u?parseFloat(e.cell.replace(p,""))-parseFloat(t.cell.replace(p,"")):e.cell.toLowerCase()>t.cell.toLowerCase()?1:-1}:function(e,t){return u?parseFloat(t.cell.replace(p,""))-parseFloat(e.cell.replace(p,"")):e.cell.toLowerCase()<t.cell.toLowerCase()?1:-1}),a=function(e,t){var a,n,i,r=[];for(a=0,n=e.length;a<n;a++)i=e[a].rowNum,r.push(t[i]);return r}(o.sort(s),a)},replaceTableRows:function(t){e(this).find("tbody").html(t)},makeColDefault:function(t,a){var r=e(t);r.attr(n,"true"),a?(r.removeClass(i.descend),r.addClass(i.ascend)):(r.removeClass(i.ascend),r.addClass(i.descend))},sortBy:function(t,n){var i,r,o=e(this);i=o[a]("getColumnNumber",t),r=o[a]("getTableRows"),r=o[a]("sortRows",r,i,n,t),o[a]("replaceTableRows",r),o[a]("makeColDefault",t,n)}};e.fn[a]=function(t){var n,i=Array.prototype.slice.call(arguments,1);return t&&"string"==typeof t?void 0!==(n=e.fn[a].prototype[t].apply(this[0],i))?n:e(this):(e(this).data(a+"data")||(e(this).data(a+"active",!0),e.fn[a].prototype._create.call(this,t)),e(this))},e.extend(e.fn[a].prototype,r),e(document).on("tablesawcreate",function(e,t){t.$table.is("table[data-tablesaw-sortable]")&&t.$table[a]()})}(jQuery),function(e,t,a){var n={attr:{init:"data-tablesaw-minimap"}};function i(a){var i=t('<div class="tablesaw-advance minimap">'),r=t('<ul class="tablesaw-advance-dots">').appendTo(i),o="tablesaw-advance-dots-hide";function s(){if(!(s=a.attr(n.attr.init))||e.matchMedia&&e.matchMedia(s).matches){var s;i.show();var l=r.find("li").removeClass(o);a.find("thead th").each(function(e){"none"===t(this).css("display")&&l.eq(e).addClass(o)})}else i.hide()}a.find("thead th").each(function(){r.append("<li><i></i></li>")}),i.appendTo(a.prev().filter(".tablesaw-bar")),s(),t(e).on("resize",s),a.bind("tablesawcolumns.minimap",function(){s()}).bind("tablesawdestroy.minimap",function(){var a=t(this);a.prev().filter(".tablesaw-bar").find(".tablesaw-advance").remove(),t(e).off("resize",s),a.unbind(".minimap")})}t(document).on("tablesawcreate",function(e,t){"swipe"!==t.mode&&"columntoggle"!==t.mode||!t.$table.is("[ "+n.attr.init+"]")||i(t.$table)})}(this,jQuery),function(e,t){var a={selectors:{init:"table[data-tablesaw-mode-switch]"},attributes:{excludeMode:"data-tablesaw-mode-exclude"},classes:{main:"tablesaw-modeswitch",toolbar:"tablesaw-toolbar"},modes:["stack","swipe","columntoggle"],init:function(e){var n=t(e),i=n.attr(a.attributes.excludeMode),r=n.prev().filter(".tablesaw-bar"),o=t("<div>").addClass(a.classes.main+" "+a.classes.toolbar).html(function(){var e,t=["<label>"+Tablesaw.i18n.columns+":"],r=n.attr("data-tablesaw-mode");t.push('<span class="btn btn-small">&#160;<select>');for(var o=0,s=a.modes.length;o<s;o++)i&&i.toLowerCase()===a.modes[o]||((e=r===a.modes[o])&&a.modes[o],t.push("<option"+(e?" selected":"")+' value="'+a.modes[o]+'">'+Tablesaw.i18n.modes[o]+"</option>"));return t.push("</select></span></label>"),t.join("")}),s=r.find(".tablesaw-advance").eq(0);s.length?o.insertBefore(s):o.appendTo(r),o.find(".btn").tablesawbtn(),o.find("select").bind("change",a.onModeChange)},onModeChange:function(){var e=t(this),n=e.closest("."+a.classes.main),i=e.closest(".tablesaw-bar").nextUntil(i).eq(0),r=e.val();n.remove(),i.data("table").destroy(),i.attr("data-tablesaw-mode",r),i.table()}};t(e.document).on("tablesawcreate",function(e,t){t.$table.is(a.selectors.init)&&a.init(t.table)})}(this,jQuery),$.validator.methods.range=function(e,t,a){var n=e.replace(",",".");return this.optional(t)||n>=a[0]&&n<=a[1]},$.validator.methods.number=function(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:[\s\.,]\d{3})+)(?:[\.,]\d+)?$/.test(e)},Array.prototype.find||(Array.prototype.find=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,a=Object(this),n=a.length>>>0,i=arguments[1],r=0;r<n;r++)if(t=a[r],e.call(i,t,r,a))return t}),Date.prototype.toShortDateString||(Date.prototype.toShortDateString=function(){return this.getFullYear()+"-"+("0"+(this.getMonth()+1)).slice(-2)+"-"+("0"+this.getDate()).slice(-2)});var GroCommon=GroCommon||function(){var e=function(t,a,n){var i,r=$(t),o=a.closest(t),s=a.html().trim()+a.val().trim()==="";if(r.length>0){var l=(i=o,$(r).index(i));if(l>=0&&l<r.length-1){var d=$(r[l+1]);!s&&d.hasClass("disabled")?(d.removeClass("disabled"),e(t,d.find("input"))):!s&&!n||d.hasClass("disabled")||(d.addClass("disabled"),e(t,d.find("input"),!0))}}},t={warning:"warning",error:"warning",info:"-info-circle",success:"success"};return{blockUI:function(){},unblockUI:function(){},handleExternalLink:function(){$("a").each(function(){var e=$(this).attr("href");$(this).attr("target")||$(this).closest(".agri-chart__content").length||null!=e&&0!==e.trim().indexOf("/")&&"#"!==e.trim()&&e.trim().indexOf("script:void")&&e.trim().indexOf("script:window.print()")<0&&$(this).attr("target","_blank")})},dateFromISO:function(e){return e=e.split(/\D/),new Date(Date.UTC(e[0],--e[1]||"",e[2]||"",e[3]||"",e[4]||"",e[5]||"",e[6]||""))},parseInt:function(e){var t=parseInt(e);return isNaN(t)&&(t=0),t},getModalIconClass:function(e){if(!e)return"";var a=t[e];return a||(a=""),a},modalInfoClass:t,disableOrEnableElement:e}}(),ImagePlaceHolder=function(){$("img[data-img-source]").each(function(){$(this).attr("src",$(this).data("imgSource")),$(this).on("error",function(e){$(e.target).on("error",null),$(e.target).data("placeholder")&&$(e.target).attr("src",$(e.target).data("placeholder"))})})},UploadImageModule=function(e){var t,a={fileSelector:"",previewImgSelector:"",uploadBtnSelector:"",linkSelector:"",handleUrl:"",cancelUploadBtnSelector:"",deleteLinkSelector:"",handleDeleteUrl:"",errorMessage:"",prevImageData:"",isNeedToUpdateHeader:!1,messages:{confirmationDialogSelector:"#dialog-confirmation",delConfirmationMess:"Är du säker på att du vill ta bort bilden?",yesDelBtnText:"Ja, ta bort",noDelBtnText:"Nej, spara den",uploadingErrorMessage:"Något gick fel när du försökte ladda upp bilden. Vänligen försök igen.",uploadingErrorTitle:"Bilden kunde inte laddas upp",informationDialogSelector:"#informationDialog"}},n=[],i=GroCommon.modalInfoClass;$.extend(a,e);var r=function(){var e=new FormData;if(n&&n.length>0)for(var t=0;t<n.length;t++){var a=n[t];a.key&&a.value&&e.append(a.key,a.value)}return e},o=function(){$(a.previewImgSelector).prev().show(),$(".popup-sub, .list-action-item").hide();var e=r();$.ajax({url:a.handleDeleteUrl,type:"POST",data:e,contentType:!1,cache:!1,processData:!1,success:function(e){$(a.previewImgSelector).prev().hide(),e.success?(t=e.imageUrl,$(a.deleteLinkSelector).hide(),$(a.previewImgSelector).attr("src",t),this.settings.isNeedToUpdateHeader&&$(".lm__user-avatar-wrapper .header_user_avatar").attr("src",t)):($(a.previewImgSelector).attr("src",t),l("","Det uppstod ett fel när bilden skulle laddas upp. Var god försök igen!",i.error))},error:function(e,n,r){$(a.previewImgSelector).prev().hide(),$(a.previewImgSelector).attr("src",t),l("Det uppstod ett fel när bilden skulle tas bort: "+r.toString(),"",i.error)}})},s=function(){$(a.deleteLinkSelector).on("click",function(){!function(e){var t=$(a.messages.confirmationDialogSelector);if(0===t.length)return;$(".modal-header-title",t).html(a.delConfirmationMess);var n=$(".success-confirm-inform.yes",t);$(".success-confirm-inform.no",t).html(a.noDelBtnText),n.html(a.yesDelBtnText),n.click(function(){e()}),t.fadeIn()}(o)})};function l(e,t,n){var i=$(a.messages.informationDialogSelector),r=i.find("span.popup-type");n?(r.removeClass("hidden"),r.addClass(GroCommon.getModalIconClass(n))):r.addClass("hidden"),i.find("#dialogTitle").html(e),i.find("#dialogContent").html(t),i.hasClass("hidden")?i.removeClass("hidden"):i.fadeIn()}return{initDataForRequest:function(e){n=e},initUploadFile:function(e){e||$.extend(a,e),t=$(a.previewImgSelector).attr("src"),$(a.linkSelector).on("click",function(e){$(".popup-sub, .list-action-item").hide(),e.preventDefault(),$(a.fileSelector).trigger("click")}),$(a.fileSelector).change(function(){var e=this.files[0].type,n=["image/jpeg","image/png","image/jpg"];if(e!==n[0]&&e!==n[1]&&e!==n[2])return $(a.previewImgSelector).attr("src",t),!1;var i=new FileReader;i.onload=function(e){$(a.previewImgSelector).attr("src",e.target.result),$(a.uploadBtnSelector).parent().show()},i.readAsDataURL(this.files[0])}),$(a.uploadBtnSelector).on("click",function(){var e=r(),n=$(a.fileSelector).get(0).files;if(n.length>0){if(n[0].size>4096e3)return void l("","Filen är för stor. Maximal filstorlek 4MB.",i.error);e.append("UploadedImage",n[0])}$(a.previewImgSelector).prev().show(),$(a.uploadBtnSelector).parent().hide(),$.ajax({url:a.handleUrl,type:"POST",data:e,contentType:!1,cache:!1,processData:!1,success:function(e){$(a.previewImgSelector).prev().hide(),e.success?($(a.uploadBtnSelector).parent().hide(),$(a.deleteLinkSelector).show(),t=$(a.previewImgSelector).attr("src"),a.isNeedToUpdateHeader&&$(".lm__user-avatar-wrapper .header_user_avatar").attr("src",t),MachineDetailPage.autoFitImages()):($(a.previewImgSelector).attr("src",t),l(a.messages.uploadingErrorTitle,a.messages.uploadingErrorMessage,i.error))},error:function(e,n,r){$(a.previewImgSelector).prev().hide(),$(a.previewImgSelector).attr("src",t);var o="Det uppstod ett fel när bilden skulle laddas upp: "+r.toString();l(this.settings.uploadingErrorTitle,o,i.error)}})}),$(a.cancelUploadBtnSelector).on("click",function(){$(a.fileSelector).val(""),$(a.uploadBtnSelector).parent().hide(),$(a.previewImgSelector).attr("src",t)})},initDeleteFile:function(e){e||$.extend(a,e),s()}}};function setDropdown(e,t){e.find(".showcase > a").unbind("click").click(function(){var e=$(this).next();return $(".dropdown").not(e).hide(),"none"==e.css("display")?e.show():e.hide(),!1}),e.find(".showcase .dropdown li a").click(function(){var a=$(this).parent().attr("data-value"),n=$(this).text(),i=$(this).parents(".showcase").find(">input[type=hidden]"),r=i.val();return $(".dropdown li").removeClass("selected"),$(this).parent().addClass("selected"),$(this).parents(".showcase").find(">a").html("type-2"===t?a:n),$(this).parents(".showcase").find(">a").html(n),$(this).parents(".showcase").attr("data-value",a),i.val(a),r!==a&&e.data("triggerChange")&&e.trigger("change",{data:a,dataText:n}),$(this).parents(".dropdown").hide(),"Annan"===$(this).parent().data("value")&&($(this).parents(".model-block").find('input[type="text"]').show(),$(this).parents("ul.lm__form-dropdown.model-dropdown").hide()),!1})}$(function(){ImagePlaceHolder()}),$(function(){$("input[type=button].submit").click(function(){$(this).attr("disabled","disabled");var e=$(this).closest("form");e&&$(e).submit()}),$("form").keyup(function(e){if(13===e.which){var t=$(e.target).closest("form");if(t){var a=function(e){var t=$("button.submit.trigger-on-enter",$(e));if(t.length>0)return t;var a=$("button[type=submit].trigger-on-enter",$(e));if(a.length>0)return a;var n=$("input[type=submit].trigger-on-enter",$(e));if(n.length>0)return n;return}(t);void 0!==a&&$(a).click()}}}),$(".lm__modal__wrapper .mask").on("click",function(){$(this).closest(".lm__modal__wrapper").addClass("hidden")})}),window.gro=window.gro||{},gro.modules=gro.modules||{},gro.modules.url=function(){var e={},t={};return e.init=function(){},t.addUrlParam=function(e,t,a){var n=t+"="+a,i="?"+n;if(e){var r=-1!==e.indexOf(t);i=e.replace(new RegExp("([?&])"+t+"[^&]*"),"$1"+n),r||i!==e||(i+="&"+n)}if(history.pushState){var o=window.location.origin+window.location.pathname+i;window.history.pushState({path:o},"",o)}},t.getUrlParam=function(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var n=t[a].split("=");if(n[0]===e)return n[1]}return!1},$(function(){e.init()}),t}(),function(e){e(document).trigger("enhance.tablesaw"),e(".tablesaw").length>0&&(e(".tablesaw-bar").hide(),e(".tablesaw").each(function(){var t=e(this),a=t.find("thead tr th"),n=t.prev();a.length>2?n.removeAttr("style"):t.css("min-width","inherit")}))}(jQuery),$(function(){var e=function(){var e=$(".lm_toggle-menu"),t=$(".lm__main-navigation > ul > li").has("ul"),a=($(".lm__main-navigation > ul li ul li").has(".lm__child-sub-navigation"),e.next()),n=$(".lm__settings > a"),i=$(".lm__sub-navigation"),r=$(".lm__user-avatar-wrapper"),o=function(){a.removeAttr("style"),t.find("ul").slideUp("slow",function(){$(this).prev().removeClass("minus-sign").addClass("plus-sign"),$(this).closest("li").removeClass("open"),$(this).removeAttr("style")}),e.removeClass("active"),$(".humb").removeClass("open"),n.parent().find(".lm_sub-settings").slideUp(function(){n.parent().removeClass("active")}),$(".lm__navigation-wrapper.showed-menu").removeClass("showed-menu"),r.find(".lm__user-avatar").next().slideUp(),$(".user-info-wrapper > a").next().slideUp()},s=function(){var e=$(window).height()-50;$(".lm_sub-settings").height()>e?$(".lm_sub-settings").css({height:$(window).height()-50+"px"}):$(".lm_sub-settings").css("height","auto")},l=function(){$(window).width()>=1083?t.find(">a").addClass("hide-icon"):t.find(">a").removeClass("hide-icon")};return{init:function(){var a;t.each(function(){var e=$(this);e.has(".lm__sub-navigation")&&e.find(">a").addClass("plus-sign")}),l(),o(),""===$(".lm__settings > a").text()&&$(".lm__settings > a").css({padding:"0 25px"}),$(document).on("click",function(e){o()}).on("touchstart",function(e){var t=$(e.target);"lm__user-info"===t.attr("class")||$(t).parents(".user-info-wrapper").length>0||$(".user-info-wrapper > a").next().slideUp()}),n.off("click").on("click",function(a){a.stopPropagation(),o();var n=$(this).next();return t.find(".lm_sub-settings").slideUp(),"none"===n.css("display")?(n.slideDown("fast",function(){$(this).is(":visible")&&$(this).css("display","inline-block")}),$(this).parent().addClass("active")):n.slideUp("fast",function(){$(this).parent().removeClass("active")}),e.removeClass("active"),$(".humb").removeClass("open"),i.slideUp("slow",function(){$(this).removeAttr("style")}),!1}),e.off("click").on("click",function(e){e.stopPropagation();var t=$(this),a=t.next();return"none"===a.css("display")?(a.slideDown("fast"),t.addClass("active").find(".humb").addClass("open")):(a.slideUp("fast"),t.removeClass("active").find(".humb").removeClass("open")),n.parent().removeClass("active").find(">a").next().slideUp(),!1}),t.each(function(){$(this).find("> a").off("click").on("click",function(){var e=$(this);return t.not(e.parent()).find("ul").slideUp(function(){$(this).prev().removeClass("minus-sign").addClass("plus-sign"),$(this).closest("li").removeClass("open")}),n.parent().removeClass("active").find(".lm_sub-settings").slideUp(),"none"!==$(this).css("display")&&(e.removeClass("plus-sign").addClass("minus-sign"),$(this).closest("li").addClass("open")),e.next().slideToggle(function(){"none"===$(this).css("display")&&(e.removeClass("minus-sign").addClass("plus-sign"),$(this).closest("li").removeClass("open"))}),$(window).width()<1083&&e.next().find(".lm__child-sub-navigation").slideToggle(),!1})}),r.find(".lm__user-avatar").click(function(){o();var e=$(this).next();return $(this).toggleClass("active"),"none"===e.css("display")?e.slideDown():e.slideUp(),!1}),(a=$(".user-info-wrapper > a")).click(function(){return o(),"none"===$(this).next().css("display")?(a.addClass("active"),$(this).next().slideDown()):(a.removeClass("active"),$(this).next().slideUp()),!1}),s(),function(){if($(".js-page-identifier-header").length){var e=$(".js-page-identifier-header").data("logout-url");document.getElementById("logoutRedirect").value=location.origin+e}}(),$(window).on("resize orientationchange",function(){$(window).width()>=1083&&$(".lm__main-navigation > ul").removeAttr("style"),s(),l()})}}},t=function(){var e=$(".lm__category-nav > ul > li").has("ul");return{init:function(){e.each(function(){$(this).find("ul li.active").length>0||$(this).hasClass("active")?$(this).addClass("open").find("ul").slideDown():$(this).removeClass("open")})}}},a=function(){return{init:function(){($("#totalUnread").length||$("#totalStarred").length)&&$.ajax({dataType:"json",url:"/api/user/get-inbox-statistics",type:"post",cache:!1,success:function(e){e&&e.totalUnRead>0?($("#totalUnread").hasClass("lm__messages-count")||$("#totalUnread").addClass("lm__messages-count"),$("#totalUnread").html(e.totalUnRead)):($("#totalUnread").hasClass("lm__messages-count")&&$("#totalUnread").removeClass("lm__messages-count"),$("#totalUnread").html("")),e&&e.totalStarred>0?($("#totalStarred").hasClass("lm__messages-stat-count")||$("#totalStarred").addClass("lm__messages-stat-count"),$("#totalStarred").html(e.totalStarred)):($("#totalStarred").hasClass("lm__messages-stat-count")&&$("#totalStarred").removeClass("lm__messages-stat-count"),$("#totalStarred").html(""))}})}}},n=function(){return{init:function(){var e;(e=$(".user-id__wrapper.lm__radio"))&&e.on("click",function(){var e=$(this).attr("data-customer-no");if(e!==$("a.lm__user-info").attr("data-active-No")){var t=$(this).attr("data-customer-name");$(".lm__user-info .lm__user-id").html(e),$("a.lm__user-info").attr("data-active-No",e),$(".lm__user-info .lm__user-summary").html(t),$("#newCustomerNumber").val(e),$("#customerNumberForm").submit()}})}}};function i(){var e=$(".lm__contents").width(),t=$(".sticky-header"),a=$(".internal-page > .wrapper >.layout > .layout__item:first-child").width(),n=$(".internal-navigation");t.hasClass("fixed")?t.css({width:e+"px"}):t.removeAttr("style"),n.css({width:a})}$(document).ready(function(){null!=$(".lm__navigation-wrapper")&&null!=$(".lm__navigation-wrapper")&&$(".lm__navigation-wrapper").length>0&&($(".lm__navigation-wrapper").length>0&&$(window).scroll(function(){$(this).scrollTop()>$(".lm__navigation-wrapper").offset().top&&$(".lm__navigation").addClass("fixed"),$(this).scrollTop()<=$(".lm__navigation-wrapper").offset().top&&$(".lm__navigation").removeClass("fixed")}),(new e).init(),(new t).init(),(new a).init(),$("#customer_list_selection")&&$("#customer_list_selection").on("change",function(e){$(e.target).parents("form").submit()}),(new n).init(),("ontouchstart"in window||navigator.maxTouchPoints)&&function(){try{for(var e=/:hover/,t=0;t<document.styleSheets.length;t++){var a=document.styleSheets[t];if(a.cssRules)for(var n=a.cssRules.length-1;n>=0;n--){var i=a.cssRules[n];i.type===CSSRule.STYLE_RULE&&e.test(i.selectorText)&&a.deleteRule(n)}}}catch(e){}}());$(".lm__header.internal-page").length&&($(window).scroll(function(){$(this).scrollTop()>$(".lm__header.internal-page").offset().top&&$(".sticky-header").addClass("fixed").css({width:$(".lm__contents").width()+"px"}),$(this).scrollTop()<=$(".lm__header.internal-page").offset().top&&$(".sticky-header").removeClass("fixed").removeAttr("style")}),$(window).resize(function(){i()}),i()),GroCommon&&GroCommon.handleExternalLink()})}),$(document).ready(function(){$("#header-internal-search .dropdown li a").click(function(){var e=$(this).attr("data-value");$("#searchOption").val(e)}),$("button#internal-search").click(function(){var e=$("#input-key-search").val();""!==e.trim()&&($("#searchKey").val(e),$("#internalSearchForm").submit())}),$("header.internal-page a.close-btn").click(function(){$(this).closest("#customer-popup").hasClass("open")&&$.ajax({dataType:"json",url:"/internal-portal/close-customer-session",type:"get",cache:!1,success:function(e){e&&location.reload()}})})}),function(e){e.fn.circliful=function(t,a){var n=e.extend({startdegree:0,fgcolor:"#556b2f",bgcolor:"#eee",fill:!1,width:15,dimension:200,fontsize:15,percent:50,animationstep:1,iconsize:"20px",iconcolor:"#999",border:"default",complete:null,bordersize:10},t);return this.each(function(){var a,i,r,o=["fgcolor","bgcolor","fill","width","dimension","fontsize","animationstep","endPercent","icon","iconcolor","iconsize","border","startdegree","bordersize"],s={},l="",d=0,c=e(this),u=!1;if(c.addClass("circliful"),r=c,e.each(o,function(t,a){null!=r.data(a)?s[a]=r.data(a):s[a]=e(n).attr(a),"fill"==a&&null!=r.data("fill")&&(u=!0)}),null!=c.data("text")&&(a=c.data("text"),null!=c.data("icon")&&(l=e("<i></i>").addClass("fa "+e(this).data("icon")).css({color:s.iconcolor,"font-size":s.iconsize})),null!=c.data("type")&&"half"==(_=e(this).data("type"))?j(c,"circle-text-half",s.dimension/1.45):j(c,"circle-text",s.dimension)),null!=e(this).data("total")&&null!=e(this).data("part")){var p=e(this).data("total")/100;percent=(e(this).data("part")/p/100).toFixed(3),d=(e(this).data("part")/p).toFixed(3)}else null!=e(this).data("percent")?(percent=e(this).data("percent")/100,d=e(this).data("percent")):percent=n.percent/100;null!=e(this).data("info")&&(i=e(this).data("info"),null!=e(this).data("type")?(_=e(this).data("type"),S(c,"half"==_?.9:1.25)):S(c,1.25)),e(this).width(s.dimension+"px");var m=e("<canvas></canvas>").attr({width:s.dimension,height:s.dimension}).appendTo(e(this)).get(0),h=m.getContext("2d"),f=(e(m).parent(),m.width/2),g=m.height/2,v=(s.percent,Math.PI,m.width/2.5),$=2.3*Math.PI,b=0,w=0===s.animationstep?d:0,y=Math.max(s.animationstep,0),C=2*Math.PI,k=Math.PI/2,_="",D=!0,T=s.startdegree/180*Math.PI;function j(t,n,i){e("<span></span>").appendTo(t).addClass(n).text(a).prepend(l).css({"line-height":i+"px","font-size":s.fontsize+"px",color:parseInt(a)>0?s.fgcolor:s.bgcolor})}function S(t,a){e("<span></span>").appendTo(t).addClass("circle-info-half").css("line-height",s.dimension*a+"px").text(i)}null!=e(this).data("type")&&"half"==(_=e(this).data("type"))&&($=2*Math.PI,b=3.13,C=Math.PI,k=Math.PI/.996),function a(n){h.clearRect(0,0,m.width,m.height),h.beginPath(),h.arc(f,g,v,b,$,!1),h.lineWidth=s.bordersize+1,h.strokeStyle=s.bgcolor,h.stroke(),u&&(h.fillStyle=s.fill,h.fill()),h.beginPath(),h.arc(f,g,v,-k+T,C*n-k+T,!1),"outline"==s.border?h.lineWidth=s.width+13:"inline"==s.border&&(h.lineWidth=s.width-13),h.strokeStyle=s.fgcolor,h.stroke(),w<d&&(w+=y,requestAnimationFrame(function(){a(Math.min(w,d)/100)},c)),w==d&&D&&void 0!==t&&e.isFunction(t.complete)&&(t.complete(),D=!1)}(w/100)})},e(document).ready(function(){e(".circle-progress").circliful()})}(jQuery),$(function(){var e=$(".lm__modal-alert"),t=e.find(".lm__modal-dialog"),a=function(){var e=$(".lm__modal-alert"),a=e.find(".modal-close"),n=e.find(".loader-wrapper"),i=e.find(".success-confirm"),r=function(){return e.fadeOut(function(){t.find(".modal-header-title").closest(".modal-injected-content").remove()}),n.fadeIn(),!1};return{init:function(){return e.bind("click",r),t.bind("click",function(e){return e.preventDefault(),!1}),a.bind("click",r),i.bind("click",r),!0}}};function n(t){var a=e.find(".loader-wrapper");$(".modal-content-wrapper").prepend(t),a.fadeOut()}function i(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var n=t[a].split("=");if(n[0]===e)return n[1]}return""}$(document).ready(function(){if($(document).trigger("enhance.tablesaw"),(new a).init(),$(".seedDiv").length,$(".my-agreements-overview").length){var t=i("tab"),r=$("#CurrentPageId").val();if("seed"===t){var o=i("toggle"),s=o?o.replace(/^\D+/g,""):"";if(s){var l="seed-child-agreements-"+s,d="totalquantity-"+s;$.ajax({type:"POST",url:"/api/seedagreement/getconnectedseedagreements",cache:!1,data:{agreementNumber:s,pageId:r,acceptedQuantity:""},success:function(e){0!==e.length&&(0!==e.ModelString.length&&$("#"+l).html(e.ModelString),$("#"+d).html("-"))},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}var c=$("#SeedAgreementsCommaSeparatedList").val();if(0!==c.length)for(var u=c.split(","),p=0;p<u.length;p++){u[p]=u[p].replace(/^\s*/,"").replace(/\s*$/,"");var m=u[p],h=$("#AcceptedQuantity-"+m).val();$.ajax({type:"POST",url:"/api/seedagreement/getconnectedseedagreements",cache:!1,data:{agreementNumber:m,pageId:r,acceptedQuantity:h},success:function(e){},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}}"grain"!==t&&$.ajax({type:"POST",url:"/api/myagreements/grain",cache:!1,data:{pageId:r},success:function(e){0!==e.length&&0!==e.ModelString.length&&$("#grainDiv").html(e.ModelString)},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}}),"seed"!==t&&$.ajax({type:"POST",url:"/api/myagreements/seed",cache:!1,data:{pageId:r},success:function(e){if(0!==e.length&&(0!==e.ModelString.length&&$("#seedDiv").html(e.ModelString),e.AgreementsCommaseparatedList))for(var t=e.AgreementsCommaseparatedList.split(","),a=$("#CurrentPageId").val(),n=0;n<t.length;n++){t[n]=t[n].replace(/^\s*/,"").replace(/\s*$/,"");var i=t[n],r=$("#AcceptedQuantity-"+i).val();$.ajax({type:"POST",url:"/api/seedagreement/getconnectedseedagreements",cache:!1,data:{agreementNumber:i,pageId:a,acceptedQuantity:r},success:function(e){},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}}),"forage"!==t&&$.ajax({type:"POST",url:"/api/myagreements/forage",cache:!1,data:{pageId:r},success:function(e){0!==e.length&&0!==e.ModelString.length&&$("#foragediv").html(e.ModelString)},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}}),"feed"!==t&&$.ajax({type:"POST",url:"/api/myagreements/feed",cache:!1,data:{pageId:r},success:function(e){0!==e.length&&0!==e.ModelString.length&&$("#feedagreements").html(e.ModelString)},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}}),"merchandise"!==t&&$.ajax({type:"POST",url:"/api/myagreements/merchandise",cache:!1,data:{pageId:r},success:function(e){0!==e.length&&0!==e.ModelString.length&&$("#tradingagreements").html(e.ModelString)},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}$(document).on("click",".showAnalyze",function(){var t="/api/agreement/farmsample/"+$(this).attr("data-id").toString();return $.ajax({dataType:"html",url:t,success:function(e){n(e)},error:function(t){console.log(t.responseText),e.fadeOut()}}),e.fadeIn(),!1}),$(".showPriceHedging").on("click",function(){var t="/api/agreement/price-hedging/"+$(this).attr("data-id").toString();return $.ajax({dataType:"html",url:t,success:function(e){n(e)},error:function(t){console.log(t.responseText),e.fadeOut()}}),e.fadeIn(),!1}),$(".showWeighInMoreInfo").on("click",function(){var t="/api/weigh-in/more-info/"+$(this).attr("data-id").toString()+"/"+$("#isInternal").val();return t+="?date="+encodeURIComponent($(this).attr("data-date"))+"&sort="+encodeURIComponent($(this).attr("data-sort")),$.ajax({dataType:"html",url:t,success:function(e){n(e)},error:function(){e.fadeOut()}}),e.fadeIn(),!1}),$(".showWeighInAnalyze").on("click",function(){var t="/api/weigh-in/analyze/"+$(this).attr("data-id").toString()+"/"+$("#isInternal").val();return $.ajax({dataType:"html",url:t,success:function(e){e.indexOf("<html>")>0?window.location.href="/":n(e)},error:function(){e.fadeOut()}}),e.fadeIn(),!1}),$(".js-load-weigh-in-analysis").on("click",function(){var e=$(this),t="/api/weigh-in/analyze/"+$(this).attr("data-id").toString()+"/"+$("#isInternal").val();$.ajax({dataType:"html",url:t,success:function(t){if(t.indexOf("<html>")>0)window.location.href="/";else{var a=e.next(".collapse__target"),n=a.find(".loader-wrapper");a.find(".collapse__target-content").html(t),n.fadeOut()}},error:function(){}})}),$(document).on("change",".js-show-harvest-year",function(){var e=$("#CurrentPageId").val(),t=$("#ForageAgreementNumber").val(),a=$("#SelectedHarvestYear").val();$.ajax({type:"GET",url:"/api/forageagreement/getharvestyeardata",cache:!1,data:{selectedvalue:a,pageId:e,agreementNumber:t},success:function(e){$("#harvestyear").html(e)},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}),$(document).on("change",".seedagreements-dropdown",function(){var e=$("#SelectedHarvestYear").val(),t=$("#CurrentPageId").val();$.ajax({type:"POST",url:"/api/seedagreement/getseedagreements",cache:!1,data:{selectedvalue:e,pageId:t},success:function(e){0!==e.length&&0!==e.ModelString.length&&$("#seedagreements").html(e.ModelString)},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}),$(".my-agreements__provnr-link").bind("click",function(){var e=$(this).attr("id");$(".my-agreements__sample-list-item a.is-active").removeClass("is-active"),$(this).addClass("is-active"),$.ajax({type:"POST",url:"/api/forageagreement/getanalysisresults",cache:!1,data:{provnr:e},success:function(e){0!==e.length&&(0!==e.ModelString.length&&$("#analysisresultsdiv").html(e.ModelString),0!==e.ProvNr.length&&$("#certnrheading").html(e.ProvNr))},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}),$(document).on("click",".seedagreeements",function(){var e=$(this).hasClass("has-loaded"),t=this;if(e)$(t).removeClass("has-loaded");else{var a=$(this).attr("id"),n=$("#CurrentPageId").val(),i=$("#AcceptedQuantity-"+a).val(),r="seed-child-agreements-"+a,o="totalquantity-"+a;$.ajax({type:"POST",url:"/api/seedagreement/getconnectedseedagreements",cache:!1,data:{agreementNumber:a,pageId:n,acceptedQuantity:i},success:function(e){0!==e.length&&(0!==e.ModelString.length&&$("#"+r).html(e.ModelString),$("#"+o).html("-"),$(t).addClass("has-loaded"))},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}}),$(document).on("click",".feedagreements",function(){var e=$(this).hasClass("has-loaded"),t=this;if(e)$(t).removeClass("has-loaded");else{var a=$(this).attr("id"),n=$("#CurrentPageId").val(),i=$(t).find(".js-unit").val(),r="feedagreementarticles-"+a;$.ajax({type:"POST",url:"/api/feedagreement/getfeedagreementarticles",cache:!1,data:{agreementNumber:a,pageId:n,unit:i},success:function(e){e&&0!==e.length&&0!==e.ModelString.length&&($("#"+r).html(e.ModelString),$(t).addClass("has-loaded"))},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}}),$(document).on("click",".tradingagreements",function(){var e=$(this).hasClass("has-loaded"),t=this;if(e)$(t).removeClass("has-loaded");else{var a=$(this).attr("id"),n=$(t).find(".js-unit").val(),i="tradingagreementarticles-"+a,r=$("#"+("agreementtype-"+a)).val();$.ajax({type:"POST",url:"/api/tradingagreement/gettradingagreementarticles",cache:!1,data:{agreementNumber:a,agreementType:r},success:function(e){if(e&&0!==e.length&&0!==e.ModelString.length){var a=e.ModelString.replace(/{{:unit}}/g,n);$("#"+i).html(a),$(t).addClass("has-loaded")}},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}}),$(document).on("change",".feedagreements-dropdown",function(){var e=$("#agreementtype").val(),t=$("#CurrentPageId").val();$.ajax({type:"POST",url:"/api/feedagreement/getfeedagreementscurrentorinactive",cache:!1,data:{selectedvalue:e,pageId:t},success:function(e){0!==e.length&&0!==e.ModelString.length&&$("#feedagreements").html(e.ModelString)},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}),$(document).on("change",".tradingagreements-dropdown",function(){var e=$("#tradingagreementtype").val(),t=$("#CurrentPageId").val();$.ajax({type:"POST",url:"/api/tradingagreements/gettradingagreementscurrentorinactive",cache:!1,data:{selectedvalue:e,pageId:t},success:function(e){0!==e.length&&0!==e.ModelString.length&&$("#tradingagreements").html(e.ModelString)},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})})})}),$(document).ready(function(){var e=document.getElementById("lm__chart-dygraphs"),t=document.getElementById("lm__chart-status");window.Dygraph&&e&&t&&(g2=new Dygraph(document.getElementById("lm__chart-dygraphs"),e.dataset.rowdata,{labelsDiv:document.getElementById("lm__chart-status"),labelsKMB:!1,colors:["#006927","#F59C00","#76B843","#F54A00","#565656"],width:"100%",height:540,title:e.dataset.title,axisLineColor:"white",ylabel:"kr/ton"})),document.getElementById("selectMonthPeriod")&&$("#selectMonthPeriod > li > ul > li > a").click(function(){var e=$(this).parent().attr("data-value"),t=$("#CurrentPageId").val(),a=[];$("input[name=type]:checked").each(function(){a.push($(this).attr("id"))}),$.ajax({type:"POST",url:"/api/pricegraphpage/filterpricegraph",cache:!1,data:{idArray:a,pageId:t,selectedPeriod:e},success:function(t){if(0!==t.length)if(0!==t.ModelString.length&&0!==t.ColorCodes.length){$("#pricegraphdiv").html(t.ModelString);var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name","SelectedPeriod"),a.setAttribute("value",e),a.setAttribute("id","SelectedPeriod"),$("#selectedperioddiv").html(a);var n=document.getElementById("lm__chart-dygraphs"),i=document.getElementById("lm__chart-status");window.Dygraph&&n&&i&&(g2=new Dygraph(document.getElementById("lm__chart-dygraphs"),n.dataset.rowdata,{labelsDiv:document.getElementById("lm__chart-status"),labelsKMB:!1,colors:t.ColorCodes,width:"100%",height:540,title:n.dataset.title,axisLineColor:"white",ylabel:"kr/ton"}))}else g2=new Dygraph(document.getElementById("lm__chart-dygraphs"),"X\n",{labelsDiv:document.getElementById("lm__chart-status"),labelsKMB:!1,width:"100%",height:540,title:document.getElementById("lm__chart-dygraphs").dataset.title,axisLineColor:"white"})},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}),$(document).on("change",".pricegraph-checkbox input",function(){var e=[],t=$("#CurrentPageId").val(),a=$("#SelectedPeriod").val();$("input[name=type]:checked").each(function(){e.push($(this).attr("id"))}),$.ajax({type:"POST",url:"/api/pricegraphpage/filterpricegraph",cache:!1,data:{idArray:e,pageId:t,selectedPeriod:a},success:function(e){if(0!==e.length)if(0!==e.ModelString.length&&0!==e.ColorCodes.length){$("#pricegraphdiv").html(e.ModelString);var t=document.getElementById("lm__chart-dygraphs"),a=document.getElementById("lm__chart-status");window.Dygraph&&t&&a&&(g2=new Dygraph(document.getElementById("lm__chart-dygraphs"),t.dataset.rowdata,{labelsDiv:document.getElementById("lm__chart-status"),labelsKMB:!1,colors:e.ColorCodes,width:"100%",height:540,title:t.dataset.title,axisLineColor:"white",ylabel:"kr/ton"}))}else g2=new Dygraph(document.getElementById("lm__chart-dygraphs"),"X\n",{labelsDiv:document.getElementById("lm__chart-status"),labelsKMB:!1,width:"100%",height:540,title:document.getElementById("lm__chart-dygraphs").dataset.title,axisLineColor:"white",ylabel:"kr/ton"})},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})})}),$(function(){var e;$.fn.datepicker&&$(".datepicker").length&&($.datepicker.setDefaults({monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],monthNames:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayNamesMin:["Sö","Må","Ti","On","To","Fr","Lö"],firstDay:0,showOtherMonths:!0,selectOtherMonths:!0,dateFormat:"yy-mm-dd"}),$(".datepicker").datepicker({defaultDate:new Date,onSelect:function(e){$(this).data("previous")},monthNames:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayNamesMin:["Sö","Må","Ti","On","To","Fr","Lö"],firstDay:1}).datepicker("setDate",new Date).on("change",function(){var e=$(this),t=!/Invalid|NaN/.test(new Date(e.val()).toString());/^\d\d\d\d-(0?[1-9]|1[0-2])-(0?[1-9]|[12][0-9]|3[01])$/gi.test(e.val())&&t?e.next().hide():e.next().show()})),e=$(".lm__form-dropdown"),$(document).on("click touchstart",function(e){var t=$(e.target);"dropdown"==t.attr("class")||$(t).parents(".lm__form-dropdown").length>0||$(".dropdown").hide()}),e.each(function(){$(this).find(".showcase > a").click(function(){var e=$(this).next();return $(".dropdown").not(e).hide(),"none"==e.css("display")?e.show():e.hide(),!1}),setDropdown($(this),"type-2"),setDropdown($(this),"type-3")})}),$(function(){$("#calculate_delivery_fee").length&&(jQuery.validator&&$("#calculateForm").validate({ignore:[],errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{LorryType:{required:!0},DeliveryAdress:{required:!0},Quantity:{required:!0,number:!0,min:1},DeliveryDate:{required:!0,swedishDate:!0},Artikel_Frakt:{required:!0}},messages:{LorryType:{required:"Du måste välja leveranssätt"},DeliveryAdress:{required:"Du måste välja en leveransadress"},Quantity:{required:"Du måste ange en kvantitet större än 0",number:"Ange ett numeriskt värde",min:"Du måste ange en kvantitet större än 1"},DeliveryDate:{required:"Du måste ange ett giltigt datum",swedishDate:"Du måste ange ett giltigt datum"},Artikel_Frakt:{required:"Du måste välja en artikel"}},highlight:function(e,t,a){$("ul.errors-list").show(),$("ul.errors-list").parent().show(),$("li#p_"+$(e).attr("id")).show(),e=this.settings._getIndicatorElement(e),$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$("li#p_"+$(e).attr("id")).hide(),!1===$("ul.errors-list").find('li[id^="p"]').is(":visible")&&($("ul.errors-list").hide(),$("ul.errors-list").parent().hide()),e=this.settings._getIndicatorElement(e),$(e).removeClass(this.settings.errorElementClass).removeClass(t)},_getIndicatorElement:function(e){return"hidden"==$(e).attr("type")&&$(e).parents("ul.lm__form-dropdown")?$(e).parents("ul.lm__form-dropdown").find("li.showcase > a").get(0):e}}),$("#calculate_delivery_fee").bind("click",function(e){if($("#calculateForm").valid()){$(".calculate_result .calculate_fee")&&$(".calculate_result .calculate_fee").html("..."),$("#loaderCalculation").show();var t={supplier:$(".calculate_supplier").val(),lorryType:$("#LorryType").val(),deliveryAddressId:$("#DeliveryAdress").val(),quantity:$(".calculate_quantity").val(),deliveryDate:$(".calculate_deliveryDate").val(),itemId:$("#Artikel_Frakt").val(),isInternal:$("#isInternal").val()};$.ajax({type:"post",data:t,dataType:"html",url:"/api/deliveryfee/caluculate",success:function(e){e.indexOf("<html>")>0?window.location.href="/":$(".calculate_result").html(e)},complete:function(e){$("#loaderCalculation").hide()},error:function(){$(".calculate_result").html("")}})}}),$("#calculateForm").find(".showcase .dropdown li a").click(function(){var e=$(this).parents(".showcase").find("input.form-element").attr("id");$("#calculateForm").validate().element("#"+e)}))}),$(function(){var e,t=(e=$(".deliveryNote a.showPdf"),{init:function(){e.click(function(){var e=$(this).attr("cdata-orderNumber"),t=$(this).attr("cdata-activePdf"),a=$(this).attr("cdata-fabricID"),n=$(this).attr("cdata-rowNumber");$(this).attr("cdata-system"),"True"===t&&function(e,t,a){GroCommon.blockUI();var n="/api/delivery-note/get-deliverynote-pdf?orderNumber="+e+"&fabricId="+t+"&rowNumber="+a;window.open(decodeURIComponent(n))}(e,a,n)})}});$(document).ready(function(){t.init()})}),window.farmday=window.farmday||{},farmday.modules=farmday.modules||{},farmday.modules.messages=function(){var e={init:function(){$(".js-page-identifier-messages-administer").length&&($(".js-page-identifier-messages-administer").data("debug")?$.getScript("/Static/dist/scripts/administerMessage.js"):$.getScript("/Static/dist/scripts/administerMessage.production.js")),$(".js-page-identifier-messages").length&&($(".js-page-identifier-messages").data("debug")?$.getScript("/Static/dist/scripts/userMessages.js"):$.getScript("/Static/dist/scripts/userMessages.production.js")),$(".js-page-identifier-messages-settings").length&&($(".js-page-identifier-messages-settings").data("debug")?$.getScript("/Static/dist/scripts/userSettings.js"):$.getScript("/Static/dist/scripts/userSettings.production.js"))}};$(function(){e.init()})}(),$(function(){var e=function(){var e=$(".lm__sok-grobarhet"),t=e.find(".lm__info"),a=e.find(".lm__modal-alert"),n=$(".lm__message-closable .close-btn, .lm__modal-alert .button-confirm .success-confirm-inform");$(".lm__information-modal__wrapper");return{init:function(){return t.click(function(){a.fadeIn()}),n.click(function(){$(this).parents(".lm__modal-alert, .lm__message-closable").fadeOut()}),$(".lm__information-modal__close-btn").click(function(){return $(this).parents(".lm__information-modal__wrapper").addClass("hidden"),$(this).parents(".lm__modal-alert").fadeOut(),!1}),!1}}},t=function(){var e=$(".lm__modal__wrapper"),t=e.find(".lm__wide-modal__close-btn"),a=e.find(".lm__btn-close"),n=function(e){e.click(function(){return $(this).parents(".lm__modal__wrapper").addClass("hidden"),$("#ui-datepicker-div").css({zIndex:9}),!1})};return{init:function(){return n(t),n(a),!1}}};$(document).ready(function(){(new e).init(),(new t).init()})}),$(function(){$("form").on("change",".file-upload-field",function(){$(this).parent(".file-upload-wrapper").attr("data-text",$(this).val().replace(/.*(\/|\\)/,""))}),$("#attachments").length&&$("#attachments").filer({showThumbs:!0,addMore:!0,allowDuplicates:!1})}),$(function(){$(document).ready(function(){})}),$(function(){$(".lm__list-type a").on("click",function(){var e=$(this).attr("data-layout");$(".lm__list-type a").removeClass("active"),$(this).addClass("active"),$(".list-maskin").removeClass("list-type").removeClass("grid-type").addClass(e).show()}),$(".lm__list-type a.active").click(),$("#checkRegisterBtn").click(function(){$(".lm__modal-alert").show()}),(new function(){var e=$("#toggle-view a"),t=$(".machine-list");$(".machine-item");return{init:function(){e.each(function(){var e=$(this);e.hasClass("active")&&e.css({backgroundColor:"#fff"})}),e.on("click",function(a){a.preventDefault();var n=$(this),i=n.data("target");return t.addClass("list"==i?"list-view":""),t.removeClass("grid"==i?"list-view":""),e.removeClass("active").removeAttr("style"),n.addClass("active").css({backgroundColor:"#fff"}),!1})}}}).init()}),jQuery.validator&&(jQuery.validator.addMethod("subItemRequired",function(e,t,a){return a},""),jQuery.validator.addMethod("regex",function(e,t,a){return this.optional(t)||a.test(e)},"Please enter a valid value.")),jQuery(function(){MyAccountPage.init(),HandinSignInInformationPage.init(),CompanyInformation.init(),BusinessProfile.init(),DeliveryAddress.init()});var MyAccountPage=MyAccountPage||function(){return{init:function(){$(document).on("click",function(){$(".popup-sub").fadeOut()}),$(".lm__avatar .lm__avatar__upload-btn").click(function(){var e=$(this).parent();return e.has(".popup-sub")&&e.find(".popup-sub").fadeToggle(),!1});var e=new UploadImageModule({fileSelector:"#user-avatar__file",previewImgSelector:"#user-avatar",uploadBtnSelector:"#user-uploadBtn",cancelUploadBtnSelector:"#user-cancelUpload",linkSelector:"#user-link",handleUrl:"/api/profile/user-upload-avatar",isNeedToUpdateHeader:!0,deleteLinkSelector:"#user-deleteBtn",handleDeleteUrl:"/api/profile/user-delete-avatar",messages:{confirmationDialogSelector:"#dialog-user-confirmation"}});e.initUploadFile(),e.initDeleteFile();var t=new UploadImageModule({fileSelector:"#company-avatar__file",previewImgSelector:"#company-avatar",uploadBtnSelector:"#company-uploadBtn",cancelUploadBtnSelector:"#company-cancelUpload",linkSelector:"#company-link",handleUrl:"/api/profile/company-upload-avatar",deleteLinkSelector:"#company-deleteBtn",handleDeleteUrl:"/api/profile/company-delete-avatar",messages:{confirmationDialogSelector:"#dialog-company-confirmation"}});t.initUploadFile(),t.initDeleteFile()}}}(),HandinSignInInformationPage=HandinSignInInformationPage||function(){var e=!1,t=!1;return{init:function(){var a=$("#hiddenSocialNumber").val();a&&""!==a&&($("#hiddenSocialNumber, #SocialSecurityNumber").val("************"),$(".lm__block .lm__checkbox").show()),$("#SocialSecurityNumber").change(function(){e=!0}),window.onload=function(){window.addEventListener("beforeunload",function(a){if(!t&&e){var n="It looks like you have been editing something. If you leave before saving, your changes will be lost.";return(a||window.event).returnValue=n,n}})}},validateForm:function(){var e=$("#SocialSecurityNumber").removeClass("error").val();if($("#error-message").hide(),null==e||""===e)return $("#SocialSecurityNumber").addClass("error"),$("#error-message").show().html("Personnummer måste fyllas i"),$(".lm__block .lm__checkbox").hide(),!1;if(!/^([0-9]{12})$|^([0-9]{10})$/.test(e))return $("#SocialSecurityNumber").addClass("error"),$("#error-message").show().html("Du måste ange 12 siffror (ÅÅÅÅMMDDNNNN)"),$(".lm__block .lm__checkbox").hide(),!1;t=!0}}}(),CompanyInformation=CompanyInformation||{init:function(){$(document).ready(function(){$().validate&&$("#editCompanyInformationFrom").validate({errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{CompanyName:"required",Address:"required",ZipCode:{required:!0,zipCode:!0},City:"required",PhoneMobile:{required:!0,mobileSE:!0},PhoneWork:{phoneSE:!0},Email:{required:!0,regex:/^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i}},messages:{CompanyName:"Du måste ange Företag/namn",Address:"Du måste ange Gatuadress",ZipCode:{required:"Du måste ange Postnummer",zipCode:window.validationMessage.zipCode.valid},City:{required:"Du måste ange Ort"},PhoneMobile:{required:window.validationMessage.mobileSE.required,mobileSE:window.validationMessage.mobileSE.valid},PhoneWork:{phoneSE:window.validationMessage.phoneSE.valid},Email:{required:"Du måste ange E-post",email:"Ange en giltig e-postadress"}},highlight:function(e,t,a){$("div.errors-list").hide(),$("ul.errors-list").show(),$("li#p_"+$(e).attr("id")).show(),$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$(e).removeClass(this.settings.errorElementClass).removeClass(t),$("li#p_"+$(e).attr("id")).hide(),!1===$("ul.errors-list").find('li[id^="p"]').is(":visible")&&$("ul.errors-list").hide()}})})}},BusinessProfile=BusinessProfile||{init:function(){$(document).ready(function(){$().validate&&$("#editBusinessProfileForm").validate({errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{"BusinessProfile.Name":"required"},messages:{"BusinessProfile.Name":"Du måste ange Typ av verksamhet"},highlight:function(e,t,a){$("div.errors-list").hide(),$("ul.errors-list").show(),$("li#p_"+$(e).attr("id")).show(),$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$(e).removeClass(this.settings.errorElementClass).removeClass(t),$("li#p_"+$(e).attr("id")).hide(),!1===$("ul.errors-list").find('li[id^="p"]').is(":visible")&&$("ul.errors-list").hide()}})})}},DeliveryAddress=function(){var e=function(){var e=$("#del-delivery-address");e.length>0&&e.click(function(e){e.preventDefault();var t="/api/handle-delivery-address/delete/"+$("#addressNumber").val().toString()+"/"+$("#handler-delivery-page-id").val().toString();$.ajax({dataType:"html",url:t,cache:!1,success:function(e){e&&""!==e.toString().trim()&&(window.location=e)}})})};function t(){$("#btn-add-silo").click(function(e){var t,n,i,r,o,s,l=$("div.silos-box").length,d=$(".silo-container"),c=(t=l,n=$("#SilosFirstValue").val().toString(),i=$("#SilosSecondValue").val().toString(),r=$("#SilosThirdValue").val().toString(),o=" <span>Silo nr*</span> <input type='text' name='Silos["+t+"].Number' class='silos silo-number' /><span>Framkomlighet* </span>",s=" <ul class='lm__form-dropdown type-3'><li class='showcase' data-value='10M'><a href='#' id='selected-silor"+t+"'>"+(n||"10 meter")+"</a><ul class='dropdown'><li data-value='10M' class='selected'><a href='#'>"+(n||"10 meter")+"</a></li><li data-value='18M'><a href='#'>"+(i||"18 meter")+"</a></li><li data-value='24M'><a href='#'>"+(r||"24 meter")+"</a></li></ul><input type='hidden' class='form-element silo-accessibility' name='Silos["+t+"].Accessibility' value='10M' /></li></ul>",$("<div class='author-inform-form__column author-inform-form__column-full silos-box gray-background'> </div>").append("<a href='#' class='silos-box__delete-btn'></a>",o,s));d.append(c),setDropdown($(".lm__form-dropdown"),"type-3"),a(),e.preventDefault()})}function a(){$(".silos-box__delete-btn").click(function(e){e.preventDefault(),$(this).closest("div.silos-box").remove(),$("input.silo-number").each(function(e,t){$(this).attr("name","Silos["+e+"].Number")}),$("input.silo-accessibility").each(function(e,t){$(this).attr("name","Silos["+e+"].Accessibility")})})}function n(e){var t=$("#has-"+e+"-indicator");t&&t.length>0&&("true"===t.val().toString().toLowerCase()&&$("#modal-"+e+".lm__information-modal__wrapper").removeClass("hidden"))}return{init:function(){var i;n("added"),n("updated"),n("deleted"),$(".js-page-identifier-profile-page").length&&$("#edit-profile-form").validate({errorElement:"div",errorClass:"error",rules:{FirstName:{required:!0},LastName:{required:!0},Mobilephone:{required:!0,mobileSE:!0},Telephone:{phoneSE:!0},Email:{required:!0,regex:/^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i},Zip:{zipCode:!0,regex:/^(\d\d\d \d\d|\d\d\d\d\d)$/i}},messages:{FirstName:window.validationMessage.firstName.required,LastName:window.validationMessage.lastName.required,Mobilephone:{required:window.validationMessage.mobileSE.required,mobileSE:window.validationMessage.mobileSE.valid},Telephone:{phoneSE:window.validationMessage.phoneSE.valid},Email:{required:window.validationMessage.email.required,email:window.validationMessage.email.valid},Zip:{zipCode:window.validationMessage.zipCode.valid,regex:window.validationMessage.zipCode.valid}},highlight:function(e,t){$(e).addClass(t)}}),$("#editDeliveryAddress")&&0!=$("#editDeliveryAddress").length&&(function(){var e=$("#editDeliveryAddress .lm__form-dropdown .showcase").attr("data-value");if(e){var t=$(".lm__form-dropdown .dropdown li");t.removeClass("selected"),t.each(function(){$(this).attr("data-value")==e&&$(this).addClass("selected")})}}(),t(),a(),e(),(i=$("input.notification-receiver-handler"))&&i.length>0&&i.click(function(){$(this).val($(this).is(":checked"))}),function(){if($(".js-page-identifier-user-agreement").length){var e=$(".js-page-identifier-user-agreement").data("url");document.getElementById("logoutRedirect").value=location.origin+e}}())}}}();$(function(){MachineDetailPage.init(),MachineAddPage.Init(),MachineBookingService.Init()}),function(e){e.fn.imgLoad=function(t){return this.each(function(){t&&(this.complete||e(this).height()>0?t.apply(this):e(this).on("load",function(){t.apply(this)}))})}}(jQuery);var MachineDetailPage=MachineDetailPage||function(){var e=!1,t=function(){$(".machine-item__thumbnail-wrapper img").each(function(){$(this).imgLoad(function(){var e=$(this),t=$(this).width(),a=$(this).height();a<t?t/a>e.parent().width()/e.parent().height()?$(this).removeClass("horizontal-img").addClass("vertical-img"):$(this).removeClass("vertical-img").addClass("horizontal-img"):a/t>e.parent().height()/e.parent().width()?$(this).removeClass("vertical-img").addClass("horizontal-img"):$(this).removeClass("horizontal-img").addClass("vertical-img")})})};return{init:function(){var a;$(".avatar-icon").on("click",function(e){e.preventDefault(),$(this).parents(".lm__block-metadata").find(".list-action-item").toggle()}),(a=$("#inno").val())?$.ajax({url:"https://api.trackunit.com/public/GetUnit",type:"GET",cache:!1,data:{token:"11df2ae9bba646ceb8be959f23445b23",format:"json",referenceNumber:a},dataType:"jsonp",success:function(e){if(e&&e.list&&e.list.length>0){var t=e.list[0],a=((parseFloat(t.preRun1)+parseFloat(t.run1))/3600).toFixed(0);$("#total_hours").show().find(".total-text").html(a+" h")}else $("#generic_banner").show()},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}}):$("#generic_banner").show(),function(){var e=$("#serialNumber").val();if(e){var t=$("#datavaxtApiUrl").val();$.ajax({url:t,type:"GET",cache:!1,data:{vin:e},dataType:"json",success:function(e){if(e&&e.engineHours>0){console.log(e);var t=e.engineHours.toFixed(0);$("#total_hours").show().find(".total-text").html(t+" h")}else $("#generic_banner").show()},error:function(e){console.log("Something went wrong with the AJAX request!"),console.log(e.responseText)}})}else $("#generic_banner").show()}(),$(".remove-machine-button").click(function(){$(".delete-machine-alert").show()}),$("#agree-remove-machine").click(function(){$("#form-remove-machine").submit()}),$("#disagree-remove-machine").click(function(){$(".lm__modal-alert").hide()}),"True"===$("#deleteFailed").val()&&alert("Radera maskin misslyckades. Kontrollera igen!"),t(),$(window).on("resize orientationchange",function(){e||(e=!0,setTimeout(function(){t(),e=!1},100))}),$(window).trigger("resize");var n=new UploadImageModule({fileSelector:"#machine-file",previewImgSelector:"#machine-picture",uploadBtnSelector:"#machine-uploadBtn",cancelUploadBtnSelector:"#machine-cancelUpload",linkSelector:"#machine-link",handleUrl:"/api/machine/machine-upload-avatar",isNeedToUpdateHeader:!1,errorMessage:"Det uppstod ett fel när bilden skulle laddas upp. Var gör försök igen!",deleteLinkSelector:"#machine-deleteBtn",handleDeleteUrl:"/api/machine/machine-delete-avatar"});n.initDataForRequest([{key:"machineId",value:$("#machineId").val()}]),n.initUploadFile(),n.initDeleteFile()},autoFitImages:t}}(),MachineAddPage=MachineAddPage||function(){var e="#drop-machine-brand",t="#drop-machine-model";function a(){var e=$("#registration").val().toUpperCase();e&&""!==e.trim()&&(e=e.trim(),$(".loader-wrapper").show(),$(".loader-wrapper").parent().addClass("disabled"),$.ajax({url:"/api/add-machine/check-register-number?registerNumber="+e,type:"GET",dataType:"json",success:function(e){i(),null!=e.id&&""!=e.id?($("#serial-number").val(e.serialNumber),$("#drop-machine-category > .dropdown > li").each(function(){if($(this).attr("data-value")==e.category.Key)return $("#drop-machine-category > .dropdown > li").removeClass("selected"),$(this).addClass("selected"),$(this).parents(".showcase").attr("data-value",e.category.Key),$(this).parents(".showcase").find(">a").html(e.category.Name),$(this).parents(".showcase").find(">input").val(e.category.Key),!1}),$("#drop-machine-brand > .dropdown > li").each(function(){if($(this).attr("data-value")==e.brand.Key)return $("#drop-machine-brand > .dropdown > li").removeClass("selected"),$(this).addClass("selected"),$(this).parents(".showcase").attr("data-value",e.brand.Key),$(this).parents(".showcase").find(">a").html(e.brand.Name),$(this).parents(".showcase").find(">input").val(e.brand.Key),n(e.brand.Key,e.model.Name),!1})):$(".lm__modal-alert").show()},error:function(e,t,a){i(),alert(a.toString())}}))}function n(a,n){var i="/api/add-machine/get-machine-models?brandId="+(null==a?$(e).attr("data-value"):a);null!=n&&(i+="&modelName="+n),$.ajax({url:i,type:"GET",dataType:"html",success:function(e){e&&$(".model-dd-container").html(e),setDropdown($(t).parent(),"type-3")}})}function i(){$(".loader-wrapper").hide(),$(".loader-wrapper").parent().removeClass("disabled")}var r=function(){$("#form-adding-machine").submit(function(){return function(){var a=$("#drop-machine-category"),n=$(e),i=$(t),r=n.parent().parent().find(">input"),o=i.parent().parent().find(">input"),s=[];""==a.attr("data-value")||null==a.attr("data-value")?(s.push("Typ"),a.parent().parent().find(".error-item").show()):a.parent().parent().find(".error-item").hide(),""==n.attr("data-value")||null==n.attr("data-value")?(s.push("Märke"),n.parent().parent().find(".error-item").show()):"Annan"==n.attr("data-value")&&""==r.val()?(s.push("Märke"),n.parent().parent().find(".error-item").show()):n.parent().parent().find(".error-item").hide(),""==i.attr("data-value")||null==i.attr("data-value")?(s.push("Modell"),i.parent().parent().find(".error-item").show()):"Annan"==i.attr("data-value")&&""==o.val()?(s.push("Modell"),i.parent().parent().find(".error-item").show()):i.parent().parent().find(".error-item").hide();var l=$("#machine-add-error-list");return s.length>0?(l.show(),l.html(""),l.append($("<li></li>").addClass("errors-list__header").append("Du måste ange")),$.each(s,function(e,t){l.append($("<li></li>").append(t))}),!1):(l.hide(),!0)}()})};return{Init:function(){$("#drop-machine-brand .dropdown li a").each(function(e,a){var i=$(a);i.click(function(){if("Annan"===i.parent().data("value")){i.parents(".branch-block").find('input[type="text"]').show(),i.parents("ul.lm__form-dropdown.branch-dropdown").hide();var e=$(t);e.parents(".model-block").find('input[type="text"]').show(),e.attr("data-value","Annan"),e.find('>input[type="hidden"]').val("Annan"),e.parents("ul.lm__form-dropdown.model-dropdown").hide()}else n(i.attr("data-value"))})}),$("#drop-machine-category .dropdown li a").each(function(e,t){var a=$(t);a.click(function(){"Other"===a.parents(".showcase").data("value")&&(a.parents(".category-block").find('input[type="text"]').show(),a.parents("ul.lm__form-dropdown").hide(),a.parents(".showcase").find("input[name=machineCategory").val(""))})}),$("#machine-registration-button").click(function(){a()}),r()}}}(),MachineBookingService=MachineBookingService||function(){var e=null;function t(){var t=$("#book-service-category").attr("data-value");$.ajax({url:"/api/book-service/get-machine-by-category?categoryKey="+t,type:"GET",dataType:"json",success:function(t){$("#book-service-loading").hide(),$.each(t,function(t,n){if(n.length>6){$("#book-machine-list-2").show(),$("#book-machine-list-1").hide();var i=$("#book-machine-list-2 > .address-sections > select");i.html(""),$.each(n,function(e,t){i.append($("<option></option>").attr("value",t.id).append(t.modelName))}),e=n}else if(n.length>0&&n.length<=6){$("#book-machine-list-2").hide(),$("#book-machine-list-1").show();var r=$("#book-machine-list-1 > .address-sections");r.html(""),r.append($("<h3></h3>").addClass("lm__bold-title").append("Mina maskiner")),$.each(n,function(e,t){r.append($("<p></p>").append($("<a></a>").addClass("lm__link").attr("href","#").append(t.modelName),$("<input></input>").attr("type","hidden").val(t.id)))}),o=n,$(r).find("p > a").click(function(e){if(null!=o&&o.length>0){var t=$(this).parent().find('input[type="hidden"]').val();a(o,t)}e.preventDefault()})}else $("#book-machine-list-2").hide(),$("#book-machine-list-1").hide();var o})}})}function a(e,t){var a,n,i,r=(a=e,n=t,i=null,$.each(a,function(e,t){t.id.toString()==n.toString()&&(i=t)}),i),o=$("#book-service-detail-machine").parent();null!=r?(o.show(),$("#book-service-detail-machine").html(""),$("#book-service-detail-machine").append($("<h2></h2>").addClass("heading-title-2").append("Vald maskin")),$("#book-service-detail-machine").append($("<h3></h3>").addClass("lm__bold-title").append(r.modelName)),$("#book-service-detail-machine").append($("<p></p>").append($("<span></span>").addClass("lm__bold-title").append("Serienr"),r.serialNumber)),$("#book-service-detail-machine").append($("<p></p>").append($("<span></span>").addClass("lm__bold-title").append("Regnr"),r.registerNumber)),o.find("p > input[name=BrandAndModel]").val(r.modelName),o.find("p > input[name=SerialNumber]").val(r.serialNumber),o.find("p > input[name=RegisterNumber]").val(r.registerNumber)):(o.hide(),o.find("p > input[name=BrandAndModel]").val(""),o.find("p > input[name=SerialNumber]").val(""),o.find("p > input[name=RegisterNumber]").val(""))}var n=function(){var e;""!=(e=$("#booking-service-send-faild").val())&&null!=e&&alert(e)};return{Init:function(){$(".maskin-type .showcase .dropdown li a").click(function(){$("#book-service-detail-machine").parent().hide(),$("#book-machine-list-1").hide(),$("#book-machine-list-2").hide(),$("#book-service-loading").show(),t()}),$("#book-machine-list-2 > .address-sections > select").change(function(){null!=e&&e.length>0&&a(e,$(this).val())}),n()}}}();if($(function(){var e=function(){var e=$(".lm__accordion-wrapper .lm__accordion-link"),t=$(".lm__accordion-wrapper .lm__accordion-content");return{init:function(){return e.each(function(){$(this).click(function(){$(this).hasClass("active")?$(this).next().slideUp("fast",function(){$(this).prev().removeClass("active")}):(t.slideUp("fast",function(){$(this).prev().removeClass("active")}),$(this).next().slideDown("fast",function(){$(this).prev().addClass("active")}))})}),!1}}};$(document).ready(function(){(new e).init()})}),$(function(){$(document).ready(function(){(new function(){$(".choose-user-type .lm__radio input[name='user-type']"),$(".user-type__sub-types"),$(".sub-type .lm__checkbox input[type='checkbox']");return{init:function(){return!1}}}).init()})}),$(function(){var e=function(){var e=$(".customer-id-block .lm__block-box .parent-checkbox .lm__checkbox input"),t=(e.parents(".lm__block-box").find(".sub-checkbox .lm__checkbox input"),$(".link-to-open-popup")),a=$(".lm__information-modal__wrapper .mask");return{init:function(){return e&&e.change(function(){var e=$(this),t=e.parents(".lm__block-box").find(".sub-checkbox"),a=t.find(".lm__radio input");return t&&a&&(e.is(":checked")?(a.parent().removeClass("sub-hidden"),$(a[0]).prop("checked",!0)):(a.parent().addClass("sub-hidden"),a.prop("checked",!1))),!1}),t&&a&&(t.click(function(e){e.preventDefault();var t=$(this).parent().next();return t&&t.removeClass("hidden"),!1}),a.click(function(){$(this).parent().addClass("hidden")})),!1}}};$(document).ready(function(){(new e).init()})}),$(function(){(new function(){return{init:function(){0===$("#term-of-use-no").length&&0===$("#term-of-use-yes").length||$("#term-of-use-no").click(function(){var e=$(".lm__main-content").find("#dialog-first-reject");e.fadeIn(),$(".back-to-term",e).click(function(){e.fadeOut()}),$(".reject",e).click(function(){var t=$(".lm__main-content").find("#dialog-reconfirm-reject");t.fadeIn(),e.fadeOut(),$(".back-to-term",t).click(function(){t.fadeOut()}),$(".reject",t).click(function(){t.fadeOut(),$("#rejectForm").submit()})})})}}}).init()}),jQuery.validator){function isValidate(e){var t="True"!==$(e).val();return t||$(e).val("False"),t}jQuery.validator.addMethod("CustomerNumberNotMatch",function(e,t,a){return isValidate(a)},"Kundnumret du har angett finns inte registrerat hos Lantmännen för det organisationsnummer du har angett."),jQuery.validator.addMethod("CustomerNumberNotExist",function(e,t,a){return isValidate(a)},"Kundnumret finns inte registrerat hos Lantmännen."),jQuery.validator.addMethod("CustomerNumberActivated",function(e,t,a){return isValidate(a)},"Kundnumret och organisationsnumret  du har angett är redan aktiverat för ett konto i LM2."),jQuery.validator.addMethod("OrganisationNumberNotMatch",function(e,t,a){return isValidate(a)},"Organisationsnumret du har angett stämmer inte överens med kundnumret du har angett."),jQuery.validator.addMethod("OrganisationNumberActivated",function(e,t,a){return isValidate(a)},"Organisationsnumret och kundnumret du har angett är redan aktiverat för ett konto i LM2.")}jQuery(function(){ActiveFarmdayCustomer.init(),ActiveFarmdayCustomer.initEvent(),ActiveFarmdayCustomer.initValidateTermOfUseForm()});var ActiveFarmdayCustomer=ActiveFarmdayCustomer||{init:function(){$().validate&&$("#verifyCustomer").validate({errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{CustomerNumber:{required:!0,CustomerNumberNotMatch:"#CustomerNumberNotMatch",CustomerNumberNotExist:"#CustomerNumberNotExist",CustomerNumberActivated:"#CustomerNumberActivated"},OrganisationNumber:{required:!0,regex:/^\d{6}[-]{0,1}\d{4}$/,OrganisationNumberNotMatch:"#OrganisationNumberNotMatch",OrganisationNumberActivated:"#OrganisationNumberActivated"}},messages:{CustomerNumber:{required:"Du måste ange Kundnumret"},OrganisationNumber:{required:"Du måste ange Organisationsnumret",regex:"Organisationsnumret du har angett är av fel typ."}},highlight:function(e,t,a){$("div.errors-list").hide(),$("ul.errors-list").show(),$("li#p_"+$(e).attr("id")).show(),$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$(e).removeClass(this.settings.errorElementClass).removeClass(t),$("li#p_"+$(e).attr("id")).hide(),!1===$("ul.errors-list").find('li[id^="p"]').is(":visible")&&$("ul.errors-list").hide()},submitHandler:function(e){$("#loader").show(),$("#loader").parent().addClass("disabled"),e.submit()}}),$().validate&&("True"===$("#CustomerNumberNotMatch").val()||"True"===$("#CustomerNumberNotExist").val()||"True"===$("#CustomerNumberActivated").val()||"True"===$("#OrganisationNumberNotMatch").val()||"True"===$("#OrganisationNumberActivated").val())&&$("#verifyCustomer").valid()},initEvent:function(){var e,t;$("#expandTermOfUse").click(function(){$(this).toggleClass("expanded").next().toggle()}),$(document).on("change","#acceptTerm",function(){$(this).is(":checked")?($(".success-icon").show().parent().next().html('Du har godkänt <a href="javascript:void(0)" class="lm__link">användningsvillkoren</a> för LM<sup>2</sup>.'),$("#submitBtn").removeClass("disabled-btn"),$("#expandTermOfUse").toggleClass("expanded").next().toggle()):($(".success-icon").hide().parent().next().html('Du måste läsa och godkänna <a href="javascript:void(0)" class="lm__link">användningsvillkoren</a> för att registrera ett LM<sup>2</sup>-konto'),$("#submitBtn").addClass("disabled-btn"))}),$(".js-page-identifier-actication-non-private").length&&(e="closed",t=!1,$("#activation-form").validate({errorElement:"div",errorClass:"error",rules:{FirstName:"required",LastName:"required",Email:{required:!0,regex:/^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i},Telephone:{phoneSE:!0},Mobilephone:{required:!0,mobileSE:!0}},messages:{FirstName:window.validationMessage.firstName.required,LastName:window.validationMessage.lastName.required,Telephone:{phoneSE:window.validationMessage.phoneSE.valid},Mobilephone:{required:window.validationMessage.mobileSE.required,mobileSE:window.validationMessage.mobileSE.valid},Email:{required:window.validationMessage.email.required,email:window.validationMessage.email.valid}},showErrors:function(e,a){if(t){console.log(e),console.log(a),t=!1;var n=$("#errors-list");a.length>0&&(n.css("display","block"),$("#errors-list .error-list-item").each(function(t,a){var n=e[$(a).data("for")]?"block":"none";$(a).css("display",n)}))}this.defaultShowErrors()},invalidHandler:function(e,a){t=!0}}),$("#errors-list").css("display","block"),$("#jsEmailError").css("display","block"),$("#accordion-control").click(function(){"closed"===e?($("#accordion-content").removeClass("hidden"),$("#accordion-control").addClass("expanded"),e="open"):"open"===e&&($("#accordion-content").addClass("hidden"),$("#accordion-control").removeClass("expanded"),e="closed")}),$("#termsCheckbox").change(function(){$(".success-icon").removeClass("hidden"),$(".meddelanden-accordion").addClass("hidden"),e="agreed",$("input[type=submit]").removeClass("disabled-btn"),$("#term-header-accepted").css("display","block"),$("#term-header").css("display","none")}),$("#cancel-button").click(function(){$("#cancel-dialog").css("display","block")}),$("#cancel-accept").click(function(){var e=$(".js-page-identifier-actication-non-private").data("cancel-url");window.location.href=e})),$(".js-page-identifier-actication-private").length&&(e="closed",t=!1,$("#activation-form").validate({errorElement:"div",errorClass:"error",rules:{FirstName:"required",LastName:"required",Telephone:{phoneSE:!0},Mobilephone:{required:!0,mobileSE:!0},Email:{required:!0,regex:/^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i}},messages:{FirstName:window.validationMessage.firstName.required,LastName:window.validationMessage.lastName.required,Telephone:{phoneSE:window.validationMessage.phoneSE.valid},Mobilephone:{required:window.validationMessage.mobileSE.required,mobileSE:window.validationMessage.mobileSE.valid},Email:{required:window.validationMessage.email.required,email:window.validationMessage.email.valid}},invalidHandler:function(e,a){t=!0},highlight:function(e,t){$(e).addClass(t)},showErrors:function(e,a){if(t){console.log(e),console.log(a),t=!1;var n=$("#errors-list");a.length>0&&(n.css("display","block"),$("#errors-list .error-list-item").each(function(t,a){var n=e[$(a).data("for")]?"block":"none";$(a).css("display",n)}))}this.defaultShowErrors()}}),$("#errors-list").css("display","block"),$("#jsEmailError").css("display","block"),$("#accordion-control").click(function(){"closed"===e?($("#accordion-content").removeClass("hidden"),$("#accordion-control").addClass("expanded"),e="open"):"open"===e&&($("#accordion-content").addClass("hidden"),$("#accordion-control").removeClass("expanded"),e="closed")}),$("#termsCheckbox").change(function(){$(".success-icon").removeClass("hidden"),$(".meddelanden-accordion").addClass("hidden"),e="agreed",$("input[type=submit]").removeClass("disabled-btn"),$("#term-header-accepted").css("display","block"),$("#term-header").css("display","none")}),$("#cancel-button").click(function(){$("#cancel-dialog").css("display","block")}),$("#cancel-accept").click(function(){var e=$(".js-page-identifier-actication-non-private").data("cancel-url");window.location.href=e})),$(".js-page-identifier-registration-non-private").length&&($(".js-page-identifier-registration-non-private").data("debug")?$.getScript("/Static/dist/scripts/nonPrivateFirmRegistration.js"):$.getScript("/Static/dist/scripts/nonPrivateFirmRegistration.production.js")),$(".js-page-identifier-registration-private").length&&($(".js-page-identifier-registration-private").data("debug")?$.getScript("/Static/dist/scripts/privateFirmRegistration.js"):$.getScript("/Static/dist/scripts/privateFirmRegistration.production.js"))},initValidateTermOfUseForm:function(){$().validate&&$("#registerCustomer").validate({errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{ContractApplication:{required:!0},CopyOfIDDocuments:{required:!0},RegistrationCertificate:{required:!0},FirstName:{required:!0},SurName:{required:!0},Telephone:{regex:/^\+?(\d[\d-. ]+)?(\([\d-. ]+\))?[\d-. ]+\d$/},Mobile:{required:!0,regex:/^\+?(\d[\d-. ]+)?(\([\d-. ]+\))?[\d-. ]+\d$/},PersonNumber:{required:!0,regex:/^[0-9]{12}$/}},messages:{ContractApplication:{required:"Du måste bifoga ansökan om avtal för e-tjänster"},CopyOfIDDocuments:{required:"Du måste bifoga Kopia på ID-handlingar"},RegistrationCertificate:{required:"Du måste bifoga Registreringsbevis för ditt företag"},FirstName:{required:"Förnamn är obligatorisk"},SurName:{required:"Efternamn är obligatoriskt"},Telephone:{regex:"Ange en giltig telefonnummer"},Mobile:{required:"Mobilnr är obligatoriskt",regex:"Ange ett giltigt mobilnummer"},PersonNumber:{required:"Personnr är obligatoriskt",regex:"Personnr måste bestå av 12 siffror"}},highlight:function(e,t,a){$("div.errors-list").hide(),$("ul.errors-list").show(),$("li#p_"+$(e).attr("id")).show(),"file"===$(e).attr("type")?$(e).parent().addClass(this.settings.errorElementClass).removeClass(t):$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){"file"===$(e).attr("type")?$(e).parent().removeClass(this.settings.errorElementClass).removeClass(t):$(e).removeClass(this.settings.errorElementClass).removeClass(t),$("li#p_"+$(e).attr("id")).hide(),!1===$("ul.errors-list").find('li[id^="p"]').is(":visible")&&$("ul.errors-list").hide()},errorPlacement:function(e,t){"file"===t.attr("type")?t.parent().after(e):t.after(e)}})}};jQuery.validator&&null==jQuery.validator.regex&&jQuery.validator.addMethod("regex",function(e,t,a){return this.optional(t)||a.test(e)},"Please enter a valid value.");var ContactForm=ContactForm||function(){var e;return{init:function(){0!==$("#ContactForm").length&&$(document).ready(function(){var t={subject:"required",message:"required"},a={subject:"Du måste ange Ämne",message:"Du måste ange Meddelande"};"true"!==$("#loginFlag").val().toString().toLowerCase&&(t.name="required",t.email={required:!0,email:!0},t.customerNumber={required:!0,regex:/^(\d+)/},a.name="Du måste ange Ditt namn",a.email={required:"Du måste ange E-post",email:"Ange en giltig e-postadress"},a.customerNumber={required:"Du måste ange Kundnummer",regex:"Ange en giltig Kundnummer"}),$().validate&&(e=$("#ContactForm").validate({ignore:[],errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:t,messages:a,highlight:function(e,t,a){$("ul.errors-list").show(),$("li#li_"+$(e).attr("id")).show(),$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$(e).removeClass(this.settings.errorElementClass).removeClass(t),$("li#li_"+$(e).attr("id")).hide(),!1===$("ul.errors-list").find('li[id^="li"]').is(":visible")&&$("ul.errors-list").hide()}}),$("input[type=reset]").click(function(){e&&(e.resetForm(),$("ul.errors-list").hide(),$(".error").each(function(){$(this).removeClass("error")}))}))})}}}();$(function(){ContactForm.init()}),$(function(){$.fn.slick&&$(".lm__carousel-block .lm__carousel__content").slick({dots:!0,infinite:!1,speed:300,slidesToShow:3,slidesToScroll:3,responsive:[{breakpoint:1100,settings:{slidesToShow:1,slidesToScroll:1,variableWidth:!0,centerMode:!0,centerPadding:"40px",infinite:!0}},{breakpoint:640,settings:{slidesToShow:1,slidesToScroll:1,dots:!1,arrows:!1,variableWidth:!0,centerMode:!0,centerPadding:"40px"}}]});var e=new function(){var e=$(".lm__carousel-block").find(".lm__carousel__item a").not(".callendar"),t=$("#upcoming-detail"),a=$(".lm__block.agreement");return{showInformation:function(){e.on("click",function(e){e.preventDefault();var a,n,i,r=$(this),o=(n=(a=r).parent(),i=a.closest("section").attr("data-isFromCustomer"),{orderNo:n.attr("data-orderNo"),orderLine:n.attr("data-orderLine"),itemName:n.attr("data-itemName"),orderQuantity:n.attr("data-orderQuantity"),warehouse:n.attr("data-warehouse"),container:n.attr("data-container"),planedDeliveryDate:n.attr("data-planedDate"),isFromCustomer:i});return $.ajax({type:"post",data:o,dataType:"html",url:"/api/upcomming-deliveries/get-detail",success:function(e){t.html(e),(t=$("#upcoming-detail")).fadeIn()}}),!1})},toggleSidebar:function(){a.length&&a.each(function(){var e=$(this).find(".lm__news-item");e.each(function(){var t=$(this),a=t.find(">a");t.hasClass("open")&&t.find(".detail-information").slideDown("fast"),a.on("click",function(){var t=$(this),a=t.parent(),n=a.hasClass("open"),i=t.next();return e.removeClass("open").find(".detail-information").slideUp("fast"),n?(a.removeClass("open"),i.slideUp("fast")):(a.addClass("open"),i.slideDown("fast")),!1})})})}}};e.showInformation(),e.toggleSidebar()}),$(function(){$.fn.datepicker&&($(".datepicker-blank-default").datepicker({onSelect:function(e){if($(this).is("#selectedDate")&&$(this).data("previous")!==e){var t=new TimeBookingPage;t.searchItems("",$("#resourceDrp").attr("data-value")),t.searchAvalibleSlotAction()}var a=$("#error-fromDate");if($(this).is("#fromDateTxt")){var n=$("#toDateTxt").val();1===validateDateValue(e,n)?a.show():-1===validateDateValue(e,n)?($("#toDateTxt").val(e),a.hide()):a.hide()}if($(this).is("#toDateTxt")){var i=$("#fromDateTxt").val();1===validateDateValue(i,e)?a.show():a.hide()}},monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNamesMin:["Sö","Må","Ti","On","To","Fr","Lö"],firstDay:1,dateFormat:"yy-mm-dd",beforeShow:function(){if(setTimeout(function(){$(".ui-datepicker").css("z-index",5)},0),$(this).is("#toDateTxt")){var e=$("#fromDateTxt").val(),t=$("#toDateTxt").val();$(this).datepicker("option","minDate",new Date(e)),$("#toDateTxt").val(t)}$(this).is("#selectedDate")&&$(this).datepicker("option","minDate",new Date)}}).on("change",function(){var e=$(this),t=!/Invalid|NaN/.test(new Date(e.val()).toString());/^\d\d\d\d-(0?[1-9]|1[0-2])-(0?[1-9]|[12][0-9]|3[01])$/gi.test(e.val())&&t?e.next().hide():e.next().show()}),$(".datepicker-blank-dialog").datepicker({onSelect:function(e){if($(this).is("#selectedDate")&&$(this).data("previous")!==e){var t=new TimeBookingPage;t.searchItems("",$("#resourceDrp").attr("data-value")),t.searchAvalibleSlotAction()}var a=$("#error-fromDate");if($(this).is("#fromDateTxt")){var n=$("#toDateTxt").val();1===validateDateValue(e,n)?a.show():-1===validateDateValue(e,n)?($("#toDateTxt").val(e),a.hide()):a.hide()}if($(this).is("#toDateTxt")){var i=$("#fromDateTxt").val();1===validateDateValue(i,e)?a.show():a.hide()}},monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNamesMin:["Sö","Må","Ti","On","To","Fr","Lö"],firstDay:1,dateFormat:"yy-mm-dd",beforeShow:function(){if(setTimeout(function(){},0),$(this).is("#toDateTxt")){var e=$("#fromDateTxt").val(),t=$("#toDateTxt").val();$(this).datepicker("option","minDate",new Date(e)),$("#toDateTxt").val(t)}$(this).is("#selectedDate")&&$(this).datepicker("option","minDate",new Date)}}).on("change",function(){var e=$(this),t=!/Invalid|NaN/.test(new Date(e.val()).toString());/^\d\d\d\d-(0?[1-9]|1[0-2])-(0?[1-9]|[12][0-9]|3[01])$/gi.test(e.val())&&t?e.next().hide():e.next().show()})),$(".expand-info").click(function(){$($(this).parent().parent()).next().slideToggle(100),$(this).hasClass("expand-icon-plus")?($(this).removeClass("expand-icon-plus"),$(this).addClass("expand-icon-minus")):($(this).removeClass("expand-icon-minus"),$(this).addClass("expand-icon-plus"))}),TransportTypeChangeEvent(),$(".showDialog").click(function(e){getAnnoncements($(this)),e.preventDefault()}),$(".table-transport > tbody > tr > td > a").click(function(e){submitForm($(this).html(),$(this).attr("data-value")),e.preventDefault()}),$(".search-customerNr").click(function(e){submitForm($(this).attr("data-customerNr"),$(this).attr("data-value")),e.preventDefault()}),$(document).on("click",".datepicker-container",function(){console.dir("parent clicked"),$(this).find("input").focus()})});var validateDateValue=function(e,t){var a=new Date(e),n=new Date(t);return n.getTime()-a.getTime()>6048e5?1:n.getTime()-a.getTime()<0?-1:0},setToDateByFromDate=function(e,t){var a=new Date(e),n=new Date(t);a.getTime(),n.getTime()};function submitForm(e,t){var a=e,n=t;$("input[name= 'SearchText']").val(a),$("#search-transport-type > ul > li").each(function(){$(this).attr("data-value")===n&&$("input[name= 'Category']").val(n)}),$("#form-search-transport").submit()}function getAnnoncements(e){var t=$(e).parents(".lm__collapse-row").prev().find("td > a").html(),a=$(".tblAnnoncements tbody"),n=$(".lm__information-modal__wrapper");$.ajax({type:"POST",url:"/api/search-transport/get-annoncements",contentType:"application/json; charset=utf-8",data:"{'orderRowId':'"+t+"'}",success:function(e){a.html(""),e.trim()?(a.html(e),$(".tblAnnoncements thead").show()):(a.html("<p>Aviseringsinformation saknas</p>"),$(".tblAnnoncements thead").hide()),n.removeClass("hidden")},error:function(){a.html(""),n.removeClass("hidden")}})}var TransportTypeChangeEvent=function(){$("#search-transport-type > ul > li > a").click(function(){var e=$(this).parent().attr("data-value"),t="Ange "+e.toLowerCase();$("input[name='Category']").val(e),$("input[name= 'SearchText']").attr("placeholder",t);var a=$("input[name= 'FromDate']"),n=$("input[name= 'ToDate']");"Kundnummer"===e||"Lastbil"===e?(a.prop("disabled",!1),n.prop("disabled",!1),a.parent().hasClass("disabled")&&a.parent().removeClass("disabled"),n.parent().hasClass("disabled")&&n.parent().removeClass("disabled")):(a.prop("disabled",!0),n.prop("disabled",!0),a.val(""),n.val(""),a.parent().addClass("disabled"),n.parent().addClass("disabled"))})};window.validation={phoneSE:function(e){return(e=e.replace(/\s+/g,"")).match(/^(\+46)\d{6,}$/)},mobileSE:function(e){return(e=e.replace(/\s+/g,"")).match(/^(\+46)\d{9}$/)},zipCode:function(e){return(e=e.replace(/\s+/g,"")).match(/^(\d{5}$)/)},personNumber:function(e){return(e=e.replace(/\s+/g,"")).match(/^\d{12}$/)},swedishDate:function(e){return e.match(/^(\d{4})(\/|-)(\d{1,2})(\/|-)(\d{1,2})$/)&&"Invalid Date"!=new Date(e)}},window.validationMessage={firstName:{required:"Du måste ange Förnamn"},lastName:{required:"Du måste ange Efternamn"},phoneSE:{valid:"Ange Telefonnr enligt formatet +46812345"},mobileSE:{required:"Du måste ange Mobilnr",valid:"Ange Mobilnr enligt formatet +46701234567"},zipCode:{required:"Postnumret ska bestå av 5 siffror",valid:"Postnumret ska bestå av 5 siffror"},email:{required:"Du måste ange E-post",valid:"Ange en giltig e-postadress"},personNumber:{valid:"Personnumret ska bestå av 12 siffror"},swedishDate:{required:"Du måste ange ett giltigt datum",valid:"Du måste ange ett giltigt datum"}},$(function(){jQuery.validator&&($.validator.addMethod("phoneSE",function(e,t){return this.optional(t)||window.validation.phoneSE(e)},window.validationMessage.phoneSE.valid),$.validator.addMethod("mobileSE",function(e,t){return window.validation.mobileSE(e)},window.validationMessage.mobileSE.valid),$.validator.addMethod("zipCode",function(e,t){return this.optional(t)||window.validation.zipCode(e)},window.validationMessage.zipCode.valid),$.validator.addMethod("personNumber",function(e,t){return this.optional(t)||window.validation.personNumber(e)},window.validationMessage.personNumber.valid),$.validator.addMethod("swedishDate",function(e,t){return window.validation.swedishDate(e)},window.validationMessage.swedishDate.valid))}),jQuery(function(){DeliveryAssuranceModule.init()});var DeliveryAssuranceModule=DeliveryAssuranceModule||function(){var e,t,a,n,i,r,o=!1,s=0,l=0,d=GroCommon.modalInfoClass,c=!0,u=function(e,t){var a=$(t).val();$(e).prev().find("li").each(function(e,t){$(t).attr("data-value")===a&&$(t).find("a").trigger("click")})},p=function(e,t){$("#confirmDelete").removeClass("hidden"),$("#btnYes").unbind().click(function(){$("#confirmDelete").addClass("hidden"),e()}),$("#btnNo").unbind().click(function(){$("#confirmDelete").addClass("hidden"),t()})},m=function(e,t,a){var n=$("#informationDialog");a&&n.find("span.popup-type").addClass(GroCommon.getModalIconClass(a)),n.find("#dialogTitle").html(e),n.find("#dialogContent").html(t),n.removeClass("hidden")},h=function(e,t){$.ajax({dataType:"json",type:"post",url:"/api/delivery-assurance/get-warehouse",data:{action:$("#Action").val(),customerNumber:$("#dialog_CustomerNumber").val(),itemName:t,deliveryDateStr:$(e).val(),isInternal:s},cache:!1,success:function(e){o=!1,e.warehouses&&($(".warehouseDropdown").html(""),$.each(e.warehouses,function(e,t){$(".warehouseDropdown").append('<li data-value="'+t.Key+'"><a href="javascript:void(0)">'+t.Value+"</a></li>")}),setDropdown($(".warehouseDropdown").parents("ul.lm__form-dropdown"),"type-3"),$("#warehouseList").find(".showcase .dropdown li a").click(function(){var e=$(this).parents(".showcase").find("input.form-element").attr("id");$("#deliveryAssuranceForm").validate().element("#"+e)})),$(".depaAvtalsDropDown").html(""),e.depaAvtals&&e.depaAvtals.length>1?($('input[name="DeliveryType"]:radio').each(function(e,t){"Depa"===$(t).val()&&$(t).prop("disabled",!1)}),r=1,$.each(e.depaAvtals,function(e,t){$(".depaAvtalsDropDown").append('<li data-value="'+t.Key+'"><a href="javascript:void(0)">'+t.Value+"</a></li>")}),setDropdown($(".depaAvtalsDropDown").parents("ul.lm__form-dropdown"),"type-3"),$("#depaAvtal").find(".showcase .dropdown li a").click(function(){var e=$(this).parents(".showcase").find("input.form-element").attr("id");$("#deliveryAssuranceForm").validate().element("#"+e)})):($('input[name="DeliveryType"]:radio').each(function(e,t){"Depa"===$(t).val()&&""!=$("#Article").val()&&($(t).prop("disabled",!0),$("#depaAvtal").addClass("hidden"))}),r=0)},error:function(e,t,a){a.message&&"Unexpected token < in JSON at position 0"===a.message?window.location.href="/":m("",a.toString(),d.error)},complete:function(e){}})},f=function(){$("#Transportation_Farm").change(function(){$(this).is(":checked")&&($(".js-transportation-terms-and-conditions:radio").prop("checked",!1),$("#lorryType").removeClass("hidden"),"1"!=s&&$("#warehouseList").addClass("hidden"),$("#deliveryAssuranceForm").validate().element("#Warehouse"),$("#deliveryAssuranceForm").validate().element("#DeliveryDate"))}),$(".js-transportation-terms-and-conditions:radio").change(function(){$(this).is(":checked")&&($("#Transportation_Farm").prop("checked",!1),$("#a_LorryType").html("Välj transportsätt"),$("#LorryType").val(""),$("#lorryType").addClass("hidden"),"1"!=s&&$("#warehouseList").removeClass("hidden"),$("#deliveryAssuranceForm").validate().element("#Transportation_Farm"),$("#deliveryAssuranceForm").validate().element("#DeliveryDate"),$("#deliveryAssuranceForm").validate().element("#Warehouse"))}),$('input[name="DeliveryType"]:radio').change(function(){var e=$('input[name="DeliveryType"]:checked').val();"Depa"===e?$("#depaAvtal").removeClass("hidden"):"Spon"===e&&$("#depaAvtal").addClass("hidden")}),$('input[name="createNew"]:checkbox').change(function(){$("#noOfNew").val(""),$(this).is(":checked")?$("#noOfNew").parent().show():($("#noOfNew").parent().hide(),$("#createPdf").prop("disabled",!1))}),$("#approveTerm").change(function(){$(this).is(":checked")?$("#btnSubmitDelivery").addClass("reverse-state").removeClass("disabled"):$("#btnSubmitDelivery").addClass("disabled").removeClass("reverse-state")}),$(".cbxApproveDelAss").change(function(){$(".cbxApproveDelAss").is(":checked")?$("#btnApprove").addClass("reverse-state").removeClass("disabled"):$("#btnApprove").addClass("disabled").removeClass("reverse-state")}),$(".cbxToPrintDeliveried").change(function(){$(".cbxToPrintDeliveried").is(":checked")?$("#btnToPrintDeliveried").removeClass("disabled"):$("#btnToPrintDeliveried").addClass("disabled")}),$(".cbxToPrintConfirmed").change(function(){$(".cbxToPrintConfirmed").is(":checked")?$("#btnToPrintConfirmed").removeClass("disabled"):$("#btnToPrintConfirmed").addClass("disabled")}),$("#noOfNew").blur(function(){var e=parseInt($(this).val());if(!isNaN(e)&&e>0){var t=$("#createPdf");t.prop("checked",!1),t.prop("disabled",!0)}}),$("#openCalculateFee").click(function(){$("#dialog_Quantity").val($("#Quantity").val()),$("#dialog_DeliveryDate").val($("#DeliveryDate").val()),u("#dialog_LorryType","#LorryType"),u("#dialog_DeliveryAddress","#DeliveryAddress"),u("#dialog_Article","#Article"),$("#calculateFormDialog").validate().resetForm(),$("#calculateFeeDialog").removeClass("hidden"),$("#calculateFeeDialog input#dialog_Quantity").removeClass("error"),$("#calculateResult").html(""),$("#ui-datepicker-div").css({zIndex:9999})}),$("#calculateFree").click(function(){if($("#calculateFormDialog").valid()){var e={supplier:$("#dialog_CustomerNumber").val(),lorryType:$("#dialog_LorryType").val(),deliveryAddressId:$("#dialog_DeliveryAddress").val(),quantity:$("#dialog_Quantity").val(),deliveryDate:$("#dialog_DeliveryDate").val(),itemId:$("#dialog_Article").val(),isInternal:$("#IsInternal").val()};$("#calculateFeeDialog").find(".loader-wrapper").show(),$.ajax({url:"/api/deliveryfee/caluculate",type:"POST",data:{supplier:e.supplier,lorryType:e.lorryType,deliveryAddressId:e.deliveryAddressId,quantity:e.quantity,deliveryDate:e.deliveryDate,itemId:e.itemId,isInternal:"1"==e.isInternal?"true":"false"},success:function(e){$("#calculateResult").html(e)},complete:function(e){$("#calculateFeeDialog").find(".loader-wrapper").hide()}})}}),$("#clearBtn").click(function(){$("#a_deliveryAddress").html("Välj leveransadress"),$("#DeliveryAddress").val(""),$("#DeliveryDate").val(""),$("#a_article").html("Välj artikel"),$("#Article").val(""),$("#Quantity").val(""),$("#a_HarvestYear").html(""),$("#HarvestYear").val(""),$("#a_Warehouse").html("Välj mottagningsplats"),$("#Warehouse").val(""),$(".warehouseDropdown").html(""),$("#a_LorryType").html("Välj transportsätt"),$("#LorryType").val(""),$('input[name="DeliveryType"]').prop("checked",!1),$("input[name='Torkat']").prop("checked",!1),$("input[name='Red']").prop("checked",!1),$("input[name='Straforkortat']").prop("checked",!1),$("input[name='Glyfosat']").prop("checked",!1),$("input[name='Slam']").prop("checked",!1),$(".js-transportation-terms-and-conditions").prop("checked",!1),$("#Transportation_Farm").prop("checked",!1),$("textarea[name='OtherInfo']").val(""),$("#deliveryAssuranceForm").validate().resetForm(),$("#depaAvtal").addClass("hidden"),$("#lorryType").addClass("hidden"),"1"!=s&&$("#warehouseList").addClass("hidden")}),$("#deliveryAssuranceForm").find(".showcase .dropdown li a").click(function(){var e=$(this).parents(".showcase").find("input.form-element").attr("id");$("#deliveryAssuranceForm").validate().element("#"+e)}),$("#calculateFormDialog").find(".showcase .dropdown li a").click(function(){var e=$(this).parents(".showcase").find("input.form-element").attr("id");$("#calculateFormDialog").validate().element("#"+e)})};return{init:function(){$.fn.datepicker&&$(".delivery-datepicker").length&&$(".delivery-datepicker").datepicker({defaultDate:new Date,dateFormat:"yy-mm-dd",onSelect:function(e){$(this).data("previous")!==e&&$("#deliveryAssuranceForm").validate().element("#DeliveryDate")&&h(this,$("#Article").val())},monthNames:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayNamesMin:["Sö","Må","Ti","On","To","Fr","Lö"],firstDay:1}).on("change",function(){var e=$(this),t=!/Invalid|NaN/.test(new Date(e.val()).toString()),a=/^\d\d\d\d-(0?[1-9]|1[0-2])-(0?[1-9]|[12][0-9]|3[01])$/gi.test(e.val());$("#deliveryAssuranceForm").validate().element("#DeliveryDate"),a&&t&&h(this,$("#Article").val())}),function(){var o=parseInt($("#preDaysDelivery").val()),d=parseInt($("#postDaysDelivery").val());if(!isNaN(o)&&!isNaN(d)){e=GroCommon.dateFromISO($("#reqDate").val()),(t=GroCommon.dateFromISO($("#reqDate").val())).setHours(0,0,0,0),t.setDate(e.getDate()+o),(a=GroCommon.dateFromISO($("#reqDate").val())).setHours(23,59,59,999),a.setDate(e.getDate()+d),n=GroCommon.dateFromISO($("#harvestPeriodStart").val()),i=GroCommon.dateFromISO($("#harvestPeriodEnd").val()),s=$("#IsInternal").val(),l=$("#EnabledWarehouse").val();var c=parseInt($("#numberOfDepaAvtal").val());isNaN(o)||(c>1?(r=1,$('input[name="DeliveryType"]:radio').each(function(e,t){"Depa"===$(t).val()&&$("#depaAvtal").removeClass("hidden")})):(1===$("#Article").size()&&""!=$("#Article").val()&&h("#DeliveryDate",$("#Article").val()),r=0)),$("#deliveryAssuranceForm .dropdown li.selected, #calculateFeeDialog .dropdown li.selected").each(function(e,t){var a=$(t).find("a").html();$(t).parent("ul").prev("a").html(a)})}}(),f(),jQuery.validator&&(jQuery.validator.addMethod("dateHigherThanToday",function(e,t){var a=new Date;if("1"===$("#Transportation_Farm:checked").val()){if(!t)return!1;var n=GroCommon.dateFromISO(t.value);n.setHours(0,0,0,0);var i=a.getHours();if(a.setHours(0,0,0,0),n<a)return!1;if(n.getFullYear()===a.getFullYear()&&n.getMonth()===a.getMonth()&&n.getDate()===a.getDate()&&i>9)return!1}return!0},"Leveransdatum kan inte vara dagens datum eller tidigare."),t&&e&&jQuery.validator.addMethod("dateHarvest206",function(t,a){if(this.optional(a))return!0;var n=GroCommon.dateFromISO(a.value);return(new Date).setDate((new Date).getDate()+1)<=n&&n<=e},$.validator.format("Vänligen ange ett datum mellan {0} och {1}.",t?t.toShortDateString():"",e?e.toShortDateString():"")),n&&i&&jQuery.validator.addMethod("dateHarvestRange",function(e,t){if(this.optional(t))return!0;var a=GroCommon.dateFromISO(t.value);return a>=n&&a<=i},$.validator.format("Vänligen ange ett datum inom skördeperioden, dvs {0}/{1} - {2}/{3}.",n.getDate().toString(),(n.getMonth()+1).toString(),i.getDate().toString(),(i.getMonth()+1).toString())),t&&a&&jQuery.validator.addMethod("daterange",function(e,n){if(this.optional(n))return!0;var i=GroCommon.dateFromISO(n.value);return t<=i&&i<=a},$.validator.format("Vänligen ange ett datum mellan {0} och {1}.",t?t.toShortDateString():"",a?a.toShortDateString():""))),$().validate&&$("#deliveryAssuranceForm").length&&$("#deliveryAssuranceForm").validate({ignore:[],errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{Quantity:{required:!0,max:39,min:1},Torkat:{required:!0},Red:{required:!0},Straforkortat:{required:!0},Glyfosat:{required:!0},Slam:{required:!0},HarvestYear:{required:!0},DeliveryType:{required:!0},DeliveryAddress:{required:!0},Transportation:{required:!0},DeliveryDate:{required:!0,date:!0},DepaAvtal:{required:function(e){return"Depa"===$('input[name="DeliveryType"]:checked').val()}},Article:{required:!0},Warehouse:{required:function(e){return"1"==l&&!$("#warehouseList").hasClass("hidden")&&!$("#Transportation_Farm").is(":checked")}},LorryType:{required:function(e){return 1===$("#Transportation_Farm:checked").length}}},messages:{Quantity:{required:"Du måste ange Kvantitet (ton)",max:"Vänligen ange ett värde mellan 1 och 39",min:"Vänligen ange ett värde mellan 1 och 39"},Torkat:{required:"Du måste ange Varmluftstorkat"},Red:{required:"Du måste ange RED"},Straforkortat:{required:"Du måste ange Stråförkortning"},Glyfosat:{required:"Du måste ange Glyfosat"},Slam:{required:"Du måste ange Slammat"},HarvestYear:{required:"Du måste ange Skördeår"},DeliveryType:{required:"Du måste ange Överleverans"},DeliveryAddress:{required:"Du måste ange Leveransadress"},DeliveryDate:{required:"Du måste ange Leveransdatum",date:"Var vänlig ange ett giltigt datum"},DepaAvtal:{required:"Inget depåavtal valt. Om vald leveranstyp är Depåavtal behöver ett depåavtal också väljas från listan."},Article:{required:"Du måste ange Artikel"},Transportation:{required:"Du måste ange Transportsätt"},Warehouse:{required:"Du måste ange Mottagningsplats"},LorryType:{required:"Du måste ange Leveranssätt"}},highlight:function(e,t,a){$("li#p_"+$(e).attr("name")).show(),$("ul.errors-list li").filter(function(){return"list-item"===$(this).css("display")}).length>=3&&$("ul.errors-list").show(),$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$(e).removeClass(this.settings.errorElementClass).removeClass(t),$("li#p_"+$(e).attr("name")).hide();var n=$("ul.errors-list li").filter(function(){return"list-item"===$(this).css("display")}).length;(!1===$("ul.errors-list").find('li[id^="p"]').is(":visible")||n<3)&&$("ul.errors-list").hide()},errorPlacement:function(e,t){"radio"===$(t).attr("type")?t.parent("div.lm__radio").parent().before(e):t.after(e)},submitHandler:function(e){$("#loader").show(),$("#loader").parent().addClass("disabled"),sponIsSelected=1==$('input[name="DeliveryType"][value="Spon"]:radio:checked').size(),1===r&&sponIsSelected&&!o?($("#confirmDuplicateAgreementBtn").one("click",function(e){$("#confirmDuplicationModal").addClass("hidden"),o=!0}),$("#confirmDuplicationModal").removeClass("hidden")):e.submit()}}),$().validate&&$("#deliveryAssuranceFormStep2").length&&$("#deliveryAssuranceFormStep2").validate({ignore:[],errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{noOfNew:{required:function(e){return"1"===$('input[name="createNew"]:checked').val()},digits:!0}},messages:{noOfNew:{required:"Du måste ange en siffra",digits:"Ange endast siffror"}},highlight:function(e,t,a){$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$(e).removeClass(this.settings.errorElementClass).removeClass(t)}}),$().validate&&$("#calculateFormDialog").length&&$("#calculateFormDialog").validate({ignore:[],errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{dialog_LorryType:"required",dialog_DeliveryAddress:{required:!0},dialog_Quantity:{required:!0,number:!0,min:1},dialog_DeliveryDate:{required:!0,swedishDate:!0},dialog_Article:{required:!0}},messages:{dialog_LorryType:{required:"Du måste välja leveranssätt"},dialog_DeliveryAddress:{required:"Du måste välja en leveransadress"},dialog_Quantity:{required:"Du måste ange en kvantitet större än 0",number:"Ange ett numeriskt värde",min:"Du måste ange en kvantitet större än 1"},dialog_DeliveryDate:{required:"Du måste ange ett giltigt datum",swedishDate:"Du måste ange ett giltigt datum"},dialog_Article:{required:"Du måste välja en artikel"}},highlight:function(e,t,a){$(e).addClass(this.settings.errorElementClass).removeClass(t),$(e.previousElementSibling).hasClass("dropdown")&&!c&&$(e).siblings("a").addClass("error"),c=!1},unhighlight:function(e,t,a){$(e).removeClass(this.settings.errorElementClass).removeClass(t),$(e.previousElementSibling).hasClass("dropdown")&&$(e).siblings("a").removeClass("error")}})},deleteDeliveryAssurance:function(e,t,a,n){p(function(){var i=$(e).parents(".deliveryTableContainer").addClass("disabled").find(".loader-wrapper");i.show(),$.ajax({dataType:"json",type:"post",url:"/api/delivery-assurance/delete",data:{ioNumber:a,lineNumber:n},cache:!1,success:function(a){if(a.success){var n=parseInt($(t).val());!isNaN(n)&&n>=1&&(n-=1,$(t).val(n)),$(e).parents("tr").remove()}else m("",a.message,d.error)},error:function(e,t,a){m("",a.toString(),d.error)},complete:function(e){i.hide().parents(".deliveryTableContainer").removeClass("disabled")}})},function(){})},showChangeNotAvailableDiglog:function(){$("#changeNotAvailable").removeClass("hidden")},printMultiLines:function(e){var t="",a="",n=0;if($("."+e).each(function(){if($(this).is(":checked")){n++;var e=$(this).val();if(e){var i=e.split(";");null!=i&&(t+=i[0]+"|",a+=i[1]+"|")}}}),0!==n){""!==t&&(t=t.slice(0,-1)),""!==a&&(a=a.slice(0,-1));var i="/api/pdfhandler/generatemultipdf?a={ioNumber}&l={lineNumber}&resync=true";i=(i=i.replace("{ioNumber}",t)).replace("{lineNumber}",a),window.open(i,"_blank")}else alert("Du måste först välja rader")},getWarehouseList:h,confirmDialog:p}}(),VerticalTable=VerticalTable||function(){var e,t;function a(a){var n,i,r,o,s=a.querySelectorAll(".responsive-table th"),l=1,d=a.querySelectorAll(".responsive-table td");if(d.length>0)for(e=0;e<d.length;e+=1){if(l>s.length&&(l=1),t=d[e],1===l){var c=document.createElement("div");c.className="table-expand-info expand-icon-plus responsive-header",t.parentNode.insertBefore(c,t)}r=(n=a.querySelector(".responsive-table th:nth-of-type("+l+")")).className,i=n.textContent,r.indexOf("action-control")>=0||r.indexOf("header-desktop-only")>=0||((o=document.createElement("td")).className="responsive-header "+r,o.innerHTML=i,t.parentNode.insertBefore(o,t)),l+=1}$(".responsive-table .collapsed-row").addClass("hidden")}var n=!1;function i(){var a=window.innerWidth,i=document.getElementsByClassName("responsive-table"),r=$(".responsive-table .collapsed-row");if(a<=768){if(!n){for(e=0;e<i.length;e+=1)(t=i[e]).classList.add("mobile"),r.addClass("hidden"),$(".table-expand-info").removeClass("expand-icon-minus"),$(".table-expand-info").addClass("expand-icon-plus");n=!0}}else{for(e=0;e<i.length;e+=1)(t=i[e]).classList.remove("mobile"),r.removeClass("hidden"),$(".table-expand-info").removeClass("expand-icon-plus"),$(".table-expand-info").addClass("expand-icon-minus");n=!1}}return{init:function(){var e=document.querySelectorAll("table.responsive-table");if(e.length>0)for(var t=0;t<e.length;t++)a(e[t]);i(),$(window).on("resize",function(){i()})}}}();$(function(){VerticalTable.init()}),$(document).ready(function(e){$(".table-expand-info").click(function(){var e=$($(this).parent()).find(".collapsed-row");$(this).hasClass("expand-icon-plus")?($(this).removeClass("expand-icon-plus"),$(this).addClass("expand-icon-minus"),e.removeClass("hidden")):($(this).removeClass("expand-icon-minus"),$(this).addClass("expand-icon-plus"),e.addClass("hidden"))}),$(".table-expand-info").next().click(function(){var e=window.innerWidth,t=$($(this).parent()),a=t.find(".table-expand-info")[0],n=t.find(".collapsed-row");e<=768&&($(a).hasClass("expand-icon-plus")?($(a).removeClass("expand-icon-plus"),$(a).addClass("expand-icon-minus"),n.removeClass("hidden")):($(a).removeClass("expand-icon-minus"),$(a).addClass("expand-icon-plus"),n.addClass("hidden")))})}),$(function(){PurchaseAgreement.init(),PriceAlertPage.init(),DryingAgreement.init(),GrainPricePage.init(),PoolAndDepaAgreement.init()});var PurchaseAgreement=PurchaseAgreement||function(){var e="#agreementForm",t=function(){var e,t=parseInt($("#CommitQuantity").val()),a=parseInt($("#UpperPrice").val()),n=parseInt($("#LowerPrice").val()),i=parseInt($("#Price").val()),r=$("#AgreementType").val(),o="1"==$("#CanSecurePrice").val();e=o&&$("#SecurePrice").is(":checked")?""!=$("#AgreementAvtal").val()&&($('input[name="DeliveryMode"]:checked').length>0||0===$('input[name="DeliveryMode"]:radio').length)&&($('input[name="WatchType"]:checked').length>0||0===$('input[name="WatchType"]:radio').length)&&""!=$("#AgreementPeriod").val()&&(!isNaN(t)&&t>=12||0===$("#CommitQuantity").length)&&!isNaN(i):""!=$("#AgreementAvtal").val()&&($('input[name="DeliveryMode"]:checked').length>0||0===$('input[name="DeliveryMode"]:radio').length)&&($('input[name="TargetAction"]:checked').length>0||0===$('input[name="TargetAction"]:radio').length)&&""!=$("#AgreementPeriod").val()&&""!=$("#PriceWatchEndDate").val()&&(!isNaN(t)&&t>=12||0===$("#CommitQuantity").length)&&!isNaN(a)&&a>=500&&!isNaN(n)&&n<=a&&n>=500,"PrissakringDepaavtal"==r&&o&&(e=""!=$("#AgreementPeriod").val()&&!isNaN(i)&&""!=$("AgreementAvtal")),e?($("#move-to-step2").removeClass("disabled"),$("#move-to-step2").parent().removeClass("disabled")):$("#move-to-step2").addClass("disabled")},a=function(a){var n=$(a).parents(".showcase").find("input.form-element").attr("id");$(e).validate().element("#"+n),t()},n=function(e,n,r,o,s,l){if(e){$("#agreement-loader").show(),$("#AgreementId").val(e),$("#product-item-name").html(s),$("#grain-type").html(o),$("#GrainType").val(o);var d=1==Number.parseInt($("#IsInternal").val());$.ajax({dataType:"json",type:"get",url:"/api/agreement/get-grain-price-periods/"+r+"/"+n+"/"+o+"/"+d,cache:!1,success:function(e){$("#agreementForm #AgreementPeriod").val(""),$("#agreementForm .periodDropdown .dropdown").html(""),$("#agreementForm .periodDropdown > .showcase > a").html("Leveransperiod"),e.length>0?($.each(e,function(e,t){var a=d?"data-price="+t.Price:"data-price=''",n="data-value="+t.PriceTypeId+";"+t.PricePeriod;$(".periodDropdown .dropdown").append("<li "+a+" "+n+"><a href='javascript:void(0)'>"+t.DisplayLabel+"</a></li>")}),setDropdown($(".periodDropdown"),"type-3"),$("#agreementForm .periodDropdown").find(".showcase .dropdown li a").click(function(){a(this),GroCommon.disableOrEnableElement("#agreementForm .agreement-element",$(this));var e=i($(".periodDropdown .dropdown"),$(this).parent().attr("data-value"));if($("#period-detail").html(e),d){$("#Price").val("");var n=$(".periodDropdown .dropdown .selected").attr("data-price");$("#Price").val(n)}t()}),$("#price-periods").find(".error-item").addClass("hidden"),$("#price-periods").removeClass("disabled"),t()):($("#price-periods").find(".error-item").removeClass("hidden"),$("#price-periods").addClass("disabled"))},error:function(e,t,a){},complete:function(e){$("#agreement-loader").hide()}})}},i=function(e,t){var a;return e.find("li").each(function(e,n){if($(n).attr("data-value")===t)return a=$(n).find("a").html(),!1}),a},r=function(e,t,n){e=$("input[name='PriceArea']").val();var r=1==Number.parseInt($("#IsInternal").val());$.ajax({dataType:"json",type:"get",url:"/api/agreement/get-grain-price-periods/"+e+"/"+t+"/"+n+"/"+r,cache:!1,success:function(e){Number.parseInt($("#IsInternal").val());$("#agreementForm #AgreementPeriod").val(""),$("#agreementForm .periodDropdown .dropdown").html(""),$("#agreementForm .periodDropdown > .showcase > a").html("Leveransperiod"),r&&$("#price-detail").html(""),$("#period-detail").html(""),e.length>0&&($.each(e,function(e,t){var a=r?"data-price="+t.Price:"data-price=''",n="data-value="+t.PriceTypeId+";"+t.PricePeriod;$(".periodDropdown .dropdown").append("<li "+a+" "+n+"><a href='javascript:void(0)'>"+t.DisplayLabel+"</a></li>")}),setDropdown($(".periodDropdown"),"type-3"),$("#agreementForm .periodDropdown").find(".showcase .dropdown li a").click(function(){a(this),GroCommon.disableOrEnableElement("#agreementForm .agreement-element",$(this));var e=i($(".periodDropdown .dropdown"),$(this).parent().attr("data-value"));if($("#period-detail").html(e),r){var t=$(".periodDropdown .dropdown .selected").attr("data-price");$("#price-detail").html(t)}""!=$("#AgreementPeriod").val()&&$(".agreement-detail").removeClass("hidden")}))},error:function(e,t,a){},complete:function(e){$("#agreement-loader").hide()}})},o=function(){$("#UpperPrice").blur(function(){$(e).validate().element("#LowerPrice"),t()}),$("#approveAgreementTerm").change(function(){$(this).is(":checked")?$("#agreementSaveBtn").addClass("reverse-state").removeClass("disabled"):$("#agreementSaveBtn").addClass("disabled").removeClass("reverse-state")}),$("#agreementForm .showcase .dropdown a.agreement-item").each(function(e,t){$(t).click(function(){var e=$(t),a=e.attr("data-agreementid"),i=e.attr("data-productItemId"),r=e.attr("data-priceAreaId"),o=e.attr("data-grainType"),s=e.attr("data-productItemName");n(a,i,r,o,s),$("#area-sort-overview").removeClass("hidden")})}),$('#agreementForm input[name="WatchType"]:radio').change(function(){var e=$("div[data-secure-price]"),a="SecurePrice"==$(this).attr("id")?"on":"off";if(e.attr("data-secure-price",a),"on"==a){var n=$("#price-detail").html();$("#Price").val(n),$("#Price").parent(".agreement-element").removeClass("disabled")}else $("#Price").val(""),GroCommon.disableOrEnableElement("#agreementForm .agreement-element",$(this));t()}),$("#agreementForm .agreement-element input").each(function(e,a){$(a).focusout(function(){"SportAndForwardAvtal"==$("#AgreementType").val()&&"LowerPrice"==$(this).attr("id")?$("#CommitQuantity").parents(".agreement-element").removeClass("disabled"):GroCommon.disableOrEnableElement("#agreementForm .agreement-element",$(a)),t()})}),$('#agreementForm input[name="TargetAction"]:radio').change(function(){GroCommon.disableOrEnableElement("#agreementForm .agreement-element",$(this)),t()}),$('#agreementForm input[name="DeliveryMode"]:radio').change(function(){GroCommon.disableOrEnableElement("#agreementForm .agreement-element",$(this)),t()}),$("#agreementForm .agreement-element:last input[type=text]").keyup(function(){t()}),$("#move-to-step2").click(function(){var t,a,n,r,o;$().validate&&($(e).valid()&&($("#span_Avtal").html(i($(".avtalDropdown .dropdown"),$("#AgreementAvtal").val())),$("#span_Groda").html($("#product-item-name").html()),$("#span_Sort").html($("#grain-type").html()),$("#span_Leveransperiod").html(i($(".periodDropdown .dropdown"),$("#AgreementPeriod").val())+" "+(t=$("#AgreementPeriod").val(),a=t.indexOf(";"),n=t.substring(a+1,a+9),r=parseInt(n.substring(0,4)),o=parseInt(n.substring(4)),isNaN(r)||isNaN(o)?"":o<701?r-1:r)),$("#span_UpperPrice").html($("#UpperPrice").val()),$("#span_UnderPrice").html($("#LowerPrice").val()),$("#span_Price").html($("#Price").val()),$("#span_Quantity").html($("#CommitQuantity").val()),$("#span_TransportType").html($('input[name="DeliveryMode"]:checked').prop("id")),$("#span_Prissakra").html($('input[name="TargetAction"]:checked').prop("id")),$("#span_AgreementDate").html($("#PriceWatchEndDate").val()),$("#pStep1").addClass("hidden"),$("#pStep2").removeClass("hidden")))}),$("#move-to-step1").click(function(){$("#pStep2").addClass("hidden"),$("#pStep1").removeClass("hidden")}),$(e).find(".showcase .dropdown li a").click(function(){a(this),GroCommon.disableOrEnableElement("#agreementForm .agreement-element",$(this))}),$("#agreementForm .periodDropdown .dropdown a").click(function(){$(".agreement-detail").removeClass("hidden"),$("#lable_Period").html(i($(".periodDropdown .dropdown"),$(this).parent().attr("data-value")))}),$("a#agrement-info").click(function(){$("#agreement-introduce").removeClass("hidden")})};return{init:function(){var a,n;$("#CommitQuantity, #UpperPrice, #LowerPrice").val(""),$.validator&&($.validator.addMethod("exact_date",function(e,t){var a=!0,n=e.split("-");if(3==n.length){var i=new Date(e);a=i.getFullYear()==n[0]&&i.getMonth()==parseInt(n[1])-1&&i.getDate()==n[2]}return this.optional(t)||a},"Var vänlig ange ett giltigt datum"),$.validator.addMethod("lowerPriceMustLessUpperPrice",function(e,t){var a=parseInt($("#UpperPrice").val()),n=parseInt($("#LowerPrice").val());return this.optional(t)||!isNaN(a)&&!isNaN(n)&&a>=n},"Undre pris måste vara lägre än Övre pris"),$.validator.addMethod("atLeastOnePriceMustBeInput",function(e,t){var a=parseInt($("#UpperPrice").val()),n=parseInt($("#LowerPrice").val());return isNaN(n)&&(n=0),this.optional(t)||!isNaN(a)&&!isNaN(n)&&(0!==a||0!==n)},"Något pris kanske ska anges?"),$.validator.addMethod("optinalLowerPriceMustBeGreatMinValue",function(e,t){var a=parseInt($("#PriceLow").val()),n=parseInt($("#LowerPrice").val());return"PrissakringDepaavtal"===$("#AgreementType").val()?this.optional(t)||!isNaN(a)&&!isNaN(n)&&!(n>=0&&n<a):this.optional(t)||!isNaN(a)&&!isNaN(n)&&!(n>0&&n<a)},"Undre pris understiger. Pris anges i kr/ton"),$.validator.addMethod("agreementDateMin",function(e,t){var a=new Date,n=GroCommon.dateFromISO(t.value);return n.setHours(n.getHours()+23),this.optional(t)||n>=a},"Du kan inte ange datum som är lägre än dagens datum"),$.validator.addMethod("agreementDateMax",function(e,t){new Date;var a=new Date;a.setDate((new Date).getDate()+60);var n=GroCommon.dateFromISO(t.value);return n.setHours(n.getHours()+23),this.optional(t)||n<=a},"Uppdraget får ej vara giltigt i mer än 60 dagar")),a=GroCommon.parseInt($("#PriceLow").val()),n=GroCommon.parseInt($("#CommitQuantityMin").val()),$().validate&&$(e).validate({ignore:[],errorElementClass:"error",errorClass:"error-item",errorElement:"span",onkeyup:!1,rules:{UpperPrice:{required:function(){return"1"!=$("#CanSecurePrice").val()},digits:!0,atLeastOnePriceMustBeInput:!0,min:a},LowerPrice:{required:function(e){return"PrissakringDepaavtal"===$("#AgreementType").val()},digits:!0,lowerPriceMustLessUpperPrice:!0,optinalLowerPriceMustBeGreatMinValue:!0},CommitQuantity:{required:!0,digits:!0,min:n},DeliveryMode:{required:!0},PriceWatchEndDate:{date:!0,exact_date:!0,agreementDateMin:!0,agreementDateMax:!0},TargetAction:{required:function(){return"1"!=$("#CanSecurePrice").val()}}},messages:{UpperPrice:{required:"Du måste ange en siffra",digits:"Ange endast siffror",atLeastOnePriceMustBeInput:"Något pris kanske ska anges?",min:"Övre pris understiger "+a+" kr. Pris anges i kr/ton"},LowerPrice:{required:"Du måste ange en siffra",digits:"Ange endast siffror",lowerPriceMustLessUpperPrice:"Undre pris måste vara lägre än Övre pris",optinalLowerPriceMustBeGreatMinValue:"Undre pris understiger "+a+" kr. Pris anges i kr/ton."},CommitQuantity:{required:"Kvantitet ton måste anges",digits:"Kvantitet ton anges numeriskt",min:"Du kan inte ange kvantitet som är mindre än "+n},DeliveryMode:{required:"Leveranssätt måste väljas"},PriceWatchEndDate:{date:"Var vänlig ange ett giltigt datum"},TargetAction:{required:"Du måste ange Resultat av prisbevakning"}},highlight:function(e,t,a){$("li#p_"+$(e).attr("name")).show(),$("ul.errors-list li").filter(function(){return"list-item"===$(this).css("display")}).length>=3&&$("ul.errors-list").show(),$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$(e).removeClass(this.settings.errorElementClass).removeClass(t),$("li#p_"+$(e).attr("name")).hide();var n=$("ul.errors-list li").filter(function(){return"list-item"===$(this).css("display")}).length;(!1===$("ul.errors-list").find('li[id^="p"]').is(":visible")||n<3)&&$("ul.errors-list").hide()},errorPlacement:function(e,t){"radio"===$(t).attr("type")?t.parent("div.lm__radio").parent().before(e):t.after(e)},submitHandler:function(e){$("#approveAgreementTerm").is(":checked")&&e.submit()}}),o(),$.fn.datepicker&&$("#PriceWatchEndDate").datepicker({defaultDate:new Date,onSelect:function(a){$(this).data("previous")!==a&&($(e).validate().element("#PriceWatchEndDate"),t())},monthNames:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayNamesMin:["Sö","Må","Ti","On","To","Fr","Lö"],firstDay:1,showOtherMonths:!0,selectOtherMonths:!0,dateFormat:"yy-mm-dd",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",5)},0)}}).on("change",function(){$(e).validate().element("#PriceWatchEndDate"),t()}),$(".agreement-element")},getProtectAgreement:n,getGrainTypesForSpotAgreement:function(e,n){$("#agreement-loader").show(),$("#product-item-name").html(i($(".productDropdown .dropdown"),n)),$.ajax({dataType:"json",type:"get",url:"/api/agreement/get-grain-type-spot-agreement",data:{priceAreaId:e,productItemId:n},cache:!1,success:function(o){$("#agreementForm .grainTypeDropdown .dropdown").html(""),$("#agreementForm .grainTypeDropdown > .showcase > a").html("Välj sort"),$("#agreementForm #GrainType").val(""),$("#grain-type").html(""),o.length>0&&($.each(o,function(e,t){$(".grainTypeDropdown .dropdown").append('<li data-value="'+t.GrainName+'"><a href="javascript:void(0)">'+t.GrainName+"</a></li>")}),setDropdown($(".grainTypeDropdown"),"type-3"),$("#agreementForm .grainTypeDropdown").find(".showcase .dropdown li a").click(function(){a(this),GroCommon.disableOrEnableElement("#agreementForm .agreement-element",$(this));var t=i($(".grainTypeDropdown .dropdown"),$(this).parent().attr("data-value"));$("#grain-type").html(t),r(e,n,t)}),$("#agreementForm .grainTypeDropdown").parent().parent().removeClass("disabled")),$("#agreementForm .periodDropdown").parent().parent().addClass("disabled"),$(".agreement-detail").addClass("hidden"),t()},error:function(e,t,a){},complete:function(e){$("#agreement-loader").hide()}})}}}(),PriceAlertPage=PriceAlertPage||function(){var e=function(){$(".priceAlertDelete").on("click",function(e){var t=$(this);DeliveryAssuranceModule.confirmDialog(function(){var e,a,n=t.attr("data-value"),i=t.parents("tr");e=i,a="{'id':'"+n+"'}",$.ajax({type:"POST",url:"/api/price-alert/DeletePriceWatch",dataType:"json",contentType:"application/json; charset=utf-8",data:a,success:function(t){t.isRemoved?$(e).remove():alert("Error")},error:function(e){}})},function(){}),e.preventDefault()})};return{init:function(){e()}}}(),GrainPricePage=GrainPricePage||function(){var e=function(){$("#price-area-list .dropdown li a").on("click",function(e){var t,a,n,i=$(this).parent().attr("data-value");t=i,a=$("#price-period-result"),n="{'priceAreaId':'"+t+"'}",$("#loader").show(),$.ajax({type:"POST",url:"/api/price-grain/GetPricePeriodbyArea",contentType:"application/json; charset=utf-8",data:n,success:function(e){null==e.resultPricePeriods?a.html(e):a.html("<div>Inga spannmålspriser finns för område</div>"),$("#loader").hide()},error:function(){a.empty(),alert("Error"),$("#loader").hide()}}),e.preventDefault()})};return{init:function(){e()}}}(),DryingAgreement=DryingAgreement||{init:function(){$("#approveDryingAgreementTerm").change(function(){$(this).is(":checked")?($("#approveDryingAgreementTermInStep2").prop("checked",!0),$("#dryingBtnMoveToStep2, #dryingBtnMoveToStep3").removeClass("disabled")):($("#approveDryingAgreementTermInStep2").prop("checked",!1),$("#dryingBtnMoveToStep2, #dryingBtnMoveToStep3").addClass("disabled"))}),$("#dryingBtnMoveToStep2").click(function(){$("#dryingStep1").addClass("hidden"),$("#dryingStep2").removeClass("hidden")}),$("#dryingBtnBackToStep1").click(function(){$("#dryingStep2").addClass("hidden"),$("#dryingStep1").removeClass("hidden")}),$("#generateDryingPdf").length>0&&$("#generateDryingPdf")[0].click()}},PoolAndDepaAgreement=PoolAndDepaAgreement||function(){var e=function(e){var t=$(e).parents(".showcase").find("input.form-element").attr("id");$("#newPurchasingAgreementForm").validate().element("#"+t),a()},t=function(e,t){var a;return e.find("li").each(function(e,n){if($(n).attr("data-value")===t)return a=$(n).find("a").html(),!1}),a},a=function(){var e=parseInt($("#CommitQuantity").val());""!=$("#ProductItemId").val()&&""!=$("#GrainType").val()&&$('input[name="DeliveryMode"]:checked').length>0&&""!=$("#AgreementPeriod").val()&&!isNaN(e)&&e>=12?$("#btnMoveToStep2").removeClass("disabled"):$("#btnMoveToStep2").addClass("disabled")},n=function(){$('#newPurchasingAgreementForm input[name="DeliveryMode"]:radio').change(function(){GroCommon.disableOrEnableElement("#newPurchasingAgreementForm .agreement-element",$(this)),a()}),$("#newPurchasingAgreementForm .periodDropdown .dropdown a").click(function(){GroCommon.disableOrEnableElement("#newPurchasingAgreementForm .agreement-element",$(this))}),$("#newPurchasingAgreementForm .agreement-element:last input[type=text]").keyup(function(){a()}),$("#approvePoolAgreementTerm").change(function(){$(this).is(":checked")?$("#agreementSaveBtn").addClass("reverse-state").removeClass("disabled"):$("#agreementSaveBtn").addClass("disabled").removeClass("reverse-state")}),$("#btnMoveToStep2").click(function(){var e,a,n,i,r;$().validate&&($("#newPurchasingAgreementForm").valid()&&($("#span_Groda").html(t($(".productDropdown .dropdown"),$("#ProductItemId").val())),$("#span_Sort").html(t($(".grainTypeDropdown .dropdown"),$("#GrainType").val())),$("#span_Period").html(t($(".periodDropdown .dropdown"),$("#AgreementPeriod").val())+" "+(e=$("#AgreementPeriod").val(),a=e.indexOf(";"),n=e.substring(a+1,a+9),i=parseInt(n.substring(0,4)),r=parseInt(n.substring(4)),isNaN(i)||isNaN(r)?"":r<701?i-1:i)),$("#span_Quantity").html($("#CommitQuantity").val()),$("#span_TransportType").html($('input[name="DeliveryMode"]:checked').prop("id")),$("#pStep1").addClass("hidden"),$("#pStep2").removeClass("hidden")))}),$("#btnBackToStep1").click(function(){$("#pStep2").addClass("hidden"),$("#pStep1").removeClass("hidden")}),$("#newPurchasingAgreementForm").find(".showcase .dropdown li a").click(function(){e(this)}),$("#newPurchasingAgreementForm #CommitQuantity").blur(function(){a()})};return{init:function(){n(),$().validate&&$("#newPurchasingAgreementForm").validate({ignore:[],errorElementClass:"error",errorClass:"error-item",errorElement:"span",onkeyup:!1,rules:{CommitQuantity:{required:!0,digits:!0,min:12},DeliveryMode:{required:!0},ProductItemId:{required:!0},GrainType:{required:!0},AgreementPeriod:{required:!0}},messages:{CommitQuantity:{required:"Kvantitet ton måste anges",digits:"Kvantitet ton anges numeriskt",min:"Angiven kvantitet måste vara 12 ton eller mer"},DeliveryMode:{required:"Transportsätt måste väljas"},ProductItemId:{required:"Gröda måste väljas"},GrainType:{required:"Sort måste väljas"},AgreementPeriod:{required:"Leveranssätt måste väljas"}},highlight:function(e,t,a){$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$(e).removeClass(this.settings.errorElementClass).removeClass(t)},errorPlacement:function(e,t){"radio"===$(t).attr("type")?t.parent("div.lm__radio").parent().before(e):t.after(e)},submitHandler:function(e){$("#approvePoolAgreementTerm").is(":checked")&&e.submit()}})},getGrainTypes:function(t,n,i){$("#agreement-loader").show(),$.ajax({dataType:"json",type:"get",url:"/api/agreement/get-grain-type",data:{priceAreaId:t,productItemId:n,agreementType:i},cache:!1,success:function(t){$(".grainTypeDropdown .dropdown").html(""),$(".grainTypeDropdown > .showcase > a").html("Välj sort"),$("#GrainType").val(""),t.length>0&&($.each(t,function(e,t){$(".grainTypeDropdown .dropdown").append('<li data-value="'+t.GrainName+'"><a href="javascript:void(0)" onclick="PoolAndDepaAgreement.enableDeliveryMode()">'+t.GrainName+"</a></li>")}),setDropdown($(".grainTypeDropdown"),"type-3"),$(".grainTypeDropdown").find(".showcase .dropdown li a").click(function(){e(this)}),$(".grainTypeDropdown").parent().parent().removeClass("disabled")),a()},error:function(e,t,a){},complete:function(e){$("#agreement-loader").hide()}})},enableDeliveryMode:function(){$(".div-DeliveryMode").removeClass("disabled")}}}();$(document).ready(function(){(new TimeBookingPage).init(),$(document).trigger("enhance.tablesaw")});var TimeBookingFunction=TimeBookingFunction||{blockUI:function(){$("#loader").show()},unBlockUI:function(){$("#loader").hide()},fillContentToModal:function(e,t,a,n,i){var r=$(e),o=r.find("span.popup-type");i?(o.removeClass("hidden"),o.addClass(GroCommon.getModalIconClass(i))):o.addClass("hidden"),r.find(".lm__wide-modal__title").html(t),r.find("p").append(a),r.find(".btn-ok").on("click",function(){r.addClass("hidden")}),n&&r.removeClass("hidden")},clearContentToModal:function(e){var t=$(e);t.find(".lm__wide-modal__title").html(""),t.find("p").html(""),t.find(".btn-ok").unbind("click")},fillContentToDeleteDialog:function(e,t){var a=$("#deleteDialog");a.find(".modal-header-title").html(e),a.find("p").append(t),a.find(".btn-cancel").on("click",function(){a.hide()}),a.find(".btn-ok").on("click",function(){a.hide()}),a.show()},clearContentToDeleteDialog:function(){var e=$("#deleteDialog");e.find(".lm__wide-modal__title").html(""),e.find("p").html(""),e.find(".btn-ok").unbind("click"),e.find(".btn-cancel").unbind("click")},copyValuesToEnableEdit:function(e,t){$("#dispalyMessageHeader").html("Ändra bokning genom att ändra uppgifter nedan och klicka Uppdatera bokning."),$("#myDisplayMessage").html(e.displayMessage),$("#IDLevnr").val(e.idLevnr),$("#IDReg").val(e.idReg),$("#IDOvrigt").val(e.idOvrigt),$("#IDEpost").val(e.idEpost),$("#IDMobil").val(e.idMobil),$("#saveAction").val("Update"),$("#ReservationID").val(e.reservationId),$("#SpeditorNo_ForUpdate").val(e.speditorNo),$("#CustomerNo_ForUpdate").val(e.customerNo),$("#CustomerName_ForUpdate").val(e.customerName),$("#newCustomerNo").val(e.customerNo),$("#newCustomerName").val(e.customerName);var a=$("#IDReminder");if("0"===e.idReminder||""===e.idReminder)a.attr("data-value",""),a.find('input[name="IDReminder"]').val(""),a.find(">a").html("Ingen påminnelse");else{a.attr("data-value",e.idReminder),a.find('input[name="IDReminder"]').val(e.idReminder);var n=a.find('ul > li[data-value="'+e.idReminder+'"]'),i=n.find("a").html();n.addClass("selected"),a.find(">a").html(i)}$("#TransportOrderNo_ForUpdate").val(e.transportOrderNo),$("#ContractNo_ForUpdate").val(e.contractNo),$("#ReminderEmail_ForUpdate").val(e.reminderEmail),$("#ReminderSMS_ForUpdate").val(e.reminderSms),$("#Owner").val(e.owner),$("#SaveTable").show(),0==t?($("#DateRegistered").val(e.dateRegistered),$("#saveBtn").hide(),$("#newCustomerNo").removeAttr("disabled"),$("input:checkbox").attr("checked",!1),$("#updateBtn").show()):($("#DateRegisteredList").val(e.dateRegistered),$("#CustomerName_ForUpdate").val()!=e.customerName&&alert("fel"),$("#updateListBtn").show(),$("html, body").animate({scrollTop:$("#updateListBtn").offset().top},1e3))},validateSaveTable:function(e,t,a,n){var i=!0;TimeBookingFunction.clearValidateSaveTable();var r=$("#IDReminder").attr("data-value");return""===e||/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)||(i=!1,$("#IDEpost").addClass("error"),$("#IDEpost-error").show()),""===t||/^\+?(\d[\d-. ]+)?(\([\d-. ]+\))?[\d-. ]+\d$/.test(t)||(i=!1,$("#IDMobil").addClass("error"),$("#IDMobil-error").show()),a||(i=!1,$("#IDReg").addClass("error"),$("#IDReg-error").show()),/^\d+$/.test(n)||(i=!1,$("#IDLevnr").addClass("error"),$("#IDLevnr-error").show()),r&&"0"!==r&&""===t&&""===e&&(i=!1,$("#IDEpost-IDMobil-error").show(),$("#IDEpost").addClass("error"),$("#IDMobil").addClass("error")),i},clearValidateSaveTable:function(){$("#IDEpost-error").hide(),$("#IDMobil-error").hide(),$("#IDLevnr-error").hide(),$("#IDReg-error").hide(),$("#IDEpost").removeClass("error"),$("#IDMobil").removeClass("error"),$("#IDReg").removeClass("error"),$("#IDLevnr").removeClass("error"),$("#IDEpost-IDMobil-error").hide()}},TimeBookingPage=function(){var dialogType=GroCommon.modalInfoClass,clearResultTable=function(){$("#resultTable").html("")},extractForDropdown=function(e,t){var a=[],n=t.length;if(0===n){var i=$("#"+e).closest("div").siblings("span").text();i=i.replace("*",""),$("#"+e+"> ul > li").remove(),$("#"+e).attr("data-value",""),$("#"+e).closest("div").addClass("disabled"),$("#"+e+"> a").html(i+" saknas")}else{$("#"+e).closest("div").removeClass("disabled");for(var r=0;r<n;r++)a[a.length]='<li data-value="'+t[r].Value+'"><a href="javascript:void(0)">'+t[r].Display+"</a></li>",1==t[r].IsSelected&&($("#"+e+"> a").html(t[r].Display),"resourceDrp"==e&&$("#"+e).attr("regNoMandatory",t[r].RegNoMandatory),$("#"+e).attr("data-value",t[r].Value))}return a.join("")},searchCustomer=function(){clearResultTable(),$("#agrementDriedUnDried").hide();var searchString=$("#seachFieldTxt").val(),resourceValue=$("#resourceDrp").attr("data-value");if(""!=jQuery.trim(searchString)){var searchType=$("#search-option").attr("data-value"),loadOrUnlodValue=$("input[name='loadOrUnlodRad']:checked").val(),customerSearcType=$("input[name='companySelected']:checked").val(),isInternal=$("#IsInternal").val();TimeBookingFunction.blockUI();var parameters="{'resourceGroupId':'"+resourceValue+"', 'searchString':'"+searchString+"', 'searchType':'"+searchType+"', 'loadOrUnlodValue':'"+loadOrUnlodValue+"', 'customerSearcType':'"+customerSearcType+"', 'isInternal':'"+isInternal+"'}";$.ajax({type:"POST",url:"/api/time-booking/CustomerSearch",dataType:"json",contentType:"application/json; charset=utf-8",data:parameters,success:function(e){TimeBookingFunction.unBlockUI(),searchCustomerSuccess(e.customerResult)},error:function(e){TimeBookingFunction.unBlockUI()}})}var searchCustomerSuccess=function(response){var dialogHtml;if(500==response.Status)return TimeBookingFunction.clearContentToModal("#dialogArea"),dialogHtml=response.ErrorMessage+"<br/><br/>",void TimeBookingFunction.fillContentToModal("#dialogArea","Fel uppstod",dialogHtml,!0,dialogType.error);var customers="string"==typeof response.Customers?eval("("+response.Customers+")"):response.Customers;if(setCustomerInfo(customers),"9"===$("#search-option").attr("data-value")&&response.Ios&&response.Ios.length>0&&(TimeBookingFunction.clearContentToModal("#dialogArea"),dialogHtml="<p>Inköpsordrar kopplade till kundnummer: "+response.Customers[0].CustomerNo+"</p>",dialogHtml+="<p>Klicka på någon av nedanstående inköpsordrar för att gå direkt till den</p><br/>",dialogHtml+='<table style="display: block; overflow-y: scroll; height: 300px;"><thead><tr><th>IONummer</th><th>Artikel</th><th>Kvantitet</th><th>Anläggning</th></tr></thead><tbody>',$.each(response.Ios,function(e,t){dialogHtml+='<tr><td><a href="?ion='+t.IONumber+'">'+t.IONumber+"</a></td><td>"+t.ItemName+"</td><td>"+t.Quantity/1e3+"</td><td>"+t.WarehouseName+"</td></tr>"}),dialogHtml+="</tbody></table>",TimeBookingFunction.fillContentToModal("#dialogArea","Välj inköpsorder nedan",dialogHtml,!0)),null!==response.BookingOrder){if(null!=response.BookingOrder.Quantity&&null!==response.BookingOrder.Quantity&&$("#quantityTxt").val(response.BookingOrder.Quantity/1e3),null!==response.BookingOrder.DeliveryDate&&($("#selectedDate").val(new Date(parseInt(response.BookingOrder.DeliveryDate.substr(6))).toShortDateString()),$("#selectedDate").val().length<10&&$("#selectedDate").val((new Date).toShortDateString())),"5"===$("#search-option").attr("data-value")?(response.BookingOrder.Status>40?unblockUI():40==response.BookingOrder.Status?unblockUI():0==response.BookingOrder.DeliveryAssuranceConfirmed&&(TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea","Redan bokad","Obs! Bokning ej tillåten på denna inköpsorder! Leveransförsäkran saknas",!0,dialogType.error)),getIOResource(response.BookingOrder.Warehouse),searchItems("",$("#resourceDrp").attr("data-value"))):"7"!==$("#search-option").attr("data-value")&&"8"!==$("#search-option").attr("data-value")&&"6"!==$("#search-option").attr("data-value")||(getIOResource(response.BookingOrder.Warehouse),searchItems("",$("#resourceDrp").attr("data-value"))),null!==response.BookingOrder.ItemNumber&&""!=response.BookingOrder.ItemNumber){var dried="torkad",$articlesDrp=$("#articlesDrp");$("#agrementDriedUnDried").val(response.BookingOrder.Torkat?"Torkad":"Otorkad");var driedUnDried=$("#agrementDriedUnDried").val();response.BookingOrder.Torkat||(dried="otorkad");var searchString=new String(response.BookingOrder.ItemNumber+"-"+dried+"-"+response.BookingOrder.Sort);searchString=searchString.toLowerCase(),$("#articlesDrp > ul li").each(function(){-1!=$(this).attr("data-value").toLowerCase().indexOf(searchString)&&($articlesDrp.attr("data-value",$(this).attr("data-value")),$articlesDrp.find(">a").html($(this).find(">a").html()))})}$("div").data("Linenumber",response.BookingOrder.Linenumber),$("#Linenumber").val(response.BookingOrder.Linenumber)}null!==response.RegNo&&$("#IDReg").val(response.RegNo),validateRequiredFieldsForSearch()?($("#searchAvailbleSlotsBtn").parent().removeClass("disabled-btn"),searchAvailableSlots(),5==$("#search-option").attr("data-value")?$("#IDLevnr_StartValue").val($("#seachFieldTxt").val()):$("#IDLevnr_StartValue").val("")):$("#searchAvailbleSlotsBtn").parent().addClass("disabled-btn")},getIOResource=function(warehouse){var resourceListLoadSuccess=function(response,warehouseId){var resource=$("#resourceDrp"),isInternal=$("#IsInternal");clearDropDown("resourceDrp","Välj anläggning"),clearDropDown("articlesDrp","Välj artikel");var resources="string"==typeof response?eval("("+response+")"):response;$(resource).find("> ul > li").append(extractForDropdown("resourceDrp",resources)),setDropdown($("#resourceDrp").parent(),"type3");for(var i=0;i<resources.length;i++)if(void 0!==warehouseId&&response[i].M3Id===warehouseId||void 0!==warehouseId&&response[i].Value===warehouseId){$(resource).attr("data-value",resources[i].Value),$(resource).find(">a").html(resources[i].Display);break}validateRequiredFieldsEvent(),searchItemEvent()};$.ajax({type:"POST",url:"/api/time-booking/LoadResourceGroupsOnIO",dataType:"json",contentType:"application/json; charset=utf-8",data:"{'warehouseId':'"+warehouse+"', 'isInternal':'"+isInternal+"'}",async:!1,success:function(e){resourceListLoadSuccess(e.Resource,warehouse)},error:function(){clearDropDown("resourceDrp","Välj anläggning"),clearDropDown("articlesDrp","Välj artikel"),clearDropDown("veichleTypeDrp","Välj fordon"),alert("Error")}})},setCustomerInfo=function(e){null!=e&&(1==e.length?($("#customerNo").val(e[0].CustomerNo),$("#customerName").val(e[0].Name),$("#IDEpost_StartValue").val(e[0].Email),$("#IDMobil_StartValue").val(e[0].MobileNo),$("#IDEpost").val(e[0].Email),$("#IDMobil").val(e[0].MobileNo),displayWarningAboutDemoCustomer(e[0].Name)):(TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea","Information saknas","Hittade ingen kund, avtal, transportorder eller sändningsorder med nr "+$("#seachFieldTxt").val()+".",!0,dialogType.info)))},displayWarningAboutDemoCustomer=function(e){((e=e.toLowerCase()).indexOf("testkund")>=0||e.indexOf("demokund")>=0)&&(TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea","Demokund","Obs! Du försöker boka på en test eller demokund vilket orsakar problem i vissa fall. Gör därför alltid bokningen i rätt kundnummer!",!0,dialogType.error))}},clearForm=function(){var e=$("#IDReminder");e.attr("data-value","0"),e.find(">a").html("Ingen påminnelse"),e.find('input[name="IDReminder"]').val("0"),$("#IDOvrigt").val(""),$("#IDLevnr").val($("#IDLevnr_StartValue").val()),$("#IDReg").val(""),$("#IDEpost").val($("#IDEpost_StartValue").val()),$("#IDMobil").val($("#IDMobil_StartValue").val()),$("#saveAction").val("New"),$("#updateBtn").hide(),$("#saveBtn").show(),$("#myDisplayMessage").html(""),$("#dispalyMessageHeader").html("&nbsp;"),$("#newCustomerNo").attr("disabled","disabled")},updateReservation=function(){var e=validateFieldsForReservation(!0);if(e.length>0){TimeBookingFunction.clearContentToModal("#dialogArea");var t=$("<p></p>").append("<ul>"+e.join("")+"</ul>");TimeBookingFunction.fillContentToModal("#dialogArea","Uppgifter saknas",t,!0,dialogType.success)}else{var a=$("#IDEpost").val(),n=$("#IDMobil").val(),i=$("#IDReg").val(),r=$("#IDLevnr").val();if(TimeBookingFunction.validateSaveTable(a,n,i,r)){var o=$("#form-time-booking");$.ajax({type:"POST",url:"/api/time-booking/UpdateReservation",data:o.serialize(),success:function(e){!function(e){for(var t=$("<p></p>"),a=0;a<e.length;a++)200==e[a].Status?t.append(e[a].Message):t.append(e[a].ErrorMessage),t.append("<br />");TimeBookingFunction.clearContentToModal("#dialogArea"),clearForm(),TimeBookingFunction.fillContentToModal("#dialogArea","Bokningen uppdaterad",t,!0,dialogType.success),searchAvailableSlots()}(e.updateReservations)},error:function(e){e.updateReservations,TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea","Uppdateringsfel","Fel uppstod när bokningen skulle uppdateras.",!0,dialogType.error),searchAvailableSlots()}})}}},deleteReservation=function(e,t,a,n,i,r){var o=function(e,t,a,n,i){clearForm();var r={};r.reservationId=e,r.owner=t,r.customerNo=a,r.dateRegistered=n,r.isInternal=i,$.ajax({type:"POST",url:"/api/time-booking/DeleteReservation",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(r),success:function(e){!function(e){for(var t=$("<p></p>"),a=0;a<e.length;a++)500==e[a].Status&&t.append('<span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>'),t.append(e[a].Message+"<br />");TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea","Borttagning",t,!0,dialogType.error),$("#dialogArea").find(".btn-ok").on("click",function(){searchAvailableSlots()})}(e.deleteReservations)},error:function(e){e.deleteReservations,TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea","Raderingsfel","Fel uppstod när bokningen skulle raderas.",!0,dialogType.error),searchAvailableSlots()}})},s=$("<p></p>").append("Vill du verkligen radera bokningen<br /> kl: "+t+"?");TimeBookingFunction.clearContentToDeleteDialog(),TimeBookingFunction.fillContentToDeleteDialog("Ta bort bokning?",s),$("#deleteDialog").find(".btn-ok").on("click",function(){o(e,a,n,i,r)})},searchItems=function(currentArticleItem,resource){var searchItemComplete=function(response){var vechicles="string"==typeof response.Vehicles?eval("("+response.Vehicles+")"):response.Vehicles,reservationStops="string"==typeof response.ReservationStops?eval("("+response.ReservationStops+")"):response.ReservationStops,articles="string"==typeof response.Items?eval("("+response.Items+")"):response.Items;clearDropDown("articlesDrp","Välj artikel"),$("#articlesDrp > ul").append(extractForDropdown("articlesDrp",articles)),$("#veichleTypeDrp > ul").append(extractForDropdown("veichleTypeDrp",vechicles)),setDropdown($("#articlesDrp").parent(),"type3"),setDropdown($("#veichleTypeDrp").parent(),"type3"),vechicles.length>0&&($("#veichleTypeDrp > a").html(vechicles[0].Display),$("#veichleTypeDrp").attr("data-value",vechicles[0].Value)),validateRequiredFieldsEvent(),buildReservationStops(reservationStops)},buildReservationStops=function(e){var t=0,a=[];for(t=0;t<e.length;t++)a[a.length]="<li>"+e[t].ResourceName+"</li>",a[a.length]="<li>"+e[t].FromDate+" "+e[t].FromTime+" - ",e[t].ToDate.length>0?a[a.length]=e[t].ToDate+" "+e[t].ToTime+"</li>":a[a.length]=" tillsvidare</li>",a[a.length]='<li style="font-style: italic">'+e[t].Message+"<br /></li>";$("#showReservationStopps").find("> ul").html(a.join("")),t>0?$("#showReservationStopps").show():$("#showReservationStopps").hide()},resourceValue=resource,selectedDateValue=$("#selectedDate").val();currentArticleItem||(currentArticleItem=$("#articlesDrp").attr("data-value"));var showOnlyUnloadingItems="2"==$("input:radio[name='loadOrUnlodRad']:checked").val();if(clearDropDown("articlesDrp","Välj artikel"),clearDropDown("veichleTypeDrp","Välj fordon"),$("#showReservationStopps").hide(),"0"!=resourceValue&&""!=resourceValue&&""!=selectedDateValue){TimeBookingFunction.blockUI();var parameters="{'resourceGroupId':'"+resourceValue+"', 'selectedDate':'"+selectedDateValue+"', 'currentArticleItem':'"+currentArticleItem+"', 'showOnlyUnloadingItems':'"+showOnlyUnloadingItems+"'}";$.ajax({type:"POST",url:"/api/time-booking/loadItemsOnresourceGroup",dataType:"json",contentType:"application/json; charset=utf-8",data:parameters,async:!1,success:function(e){searchItemComplete(e),TimeBookingFunction.unBlockUI()},error:function(){TimeBookingFunction.unBlockUI(),alert("Error")}})}},clearDropDown=function(e,t){$("#"+e+"> ul > li").remove(),""!=$.trim(t)&&($("#"+e).attr("data-value",""),$("#"+e+"> a").html(t))},validateRequiredFieldsForSearch=function(){var e=!1;return $(".searchSlotRequired").each(function(){$(this).is("input")&&(0==$.trim($(this).val()).length?(e=!0,$(this).is("#quantityTxt")&&($("#Quantity-error").hide(),$(this).removeClass("error"))):$(this).is("#quantityTxt")&&($.isNumeric($.trim($(this).val()))?($("#Quantity-error").hide(),$(this).removeClass("error")):(e=!0,$("#Quantity-error").show(),$(this).addClass("error")))),$(this).is("li")&&(0!=$(this).attr("data-value")&&""!=$(this).attr("data-value")||(e=!0))}),!e},searchAvailableSlots=function(){var e=function(e){e?($("#resultTable").show(),$(".resultCaption").show(),$("#resultTable-box").addClass("has-separator")):($("#resultTable").hide(),$(".resultCaption").hide(),$("#resultTable-box").removeClass("has-separator")),$("#SaveTable").hide(),$("#saveBtn").hide()};if(clearResultTable(),validateRequiredFieldsForSearch()){TimeBookingFunction.blockUI();var t=$("#resourceDrp").attr("data-value"),a=$("#selectedDate").val(),n=$("#agrementDriedUnDried").val(),i=$("#articlesDrp").attr("data-value"),r=$("#quantityTxt").val(),o=$("input[name='loadOrUnlodRad']:checked").val(),s=$("#veichleTypeDrp").attr("data-value"),l=$("#search-option").attr("data-value"),d=$("#customerNo").val(),c=$("#IsInternal").val();if(""!=t&&""!=a&&""!=r&&(""!=i||""!=argementValue)){var u="{'resourceGroupId':'"+t+"', 'selectedDate':'"+a+"', 'article':'"+i+"', 'qty':'"+r+"', 'loadunload':'"+o+"', 'veichleType':'"+s+"', 'driedUnDried':'"+n+"', 'customerNo':'"+d+"','searchType':'"+l+"', 'isInternal':'"+c+"'}";$.ajax({type:"POST",url:"/api/time-booking/SearchAvailbleSlots",contentType:"application/json; charset=utf-8",data:u,success:function(t){var a;a=t,clearResultTable(),$("#resultTable").append(a),""!==a?($(".tb-deleteBtn").unbind("click").bind("click",function(e){var t=$(this).parents(".tb-row"),a=t.find(".tb-reservationId").val(),n=t.find(".tb-fromDateTime").val(),i=t.find(".tb-owner").val(),r=t.find(".tb-customerNo").val(),o=t.find(".tb-dateRegistered").val(),s=$("#IsInternal").val();deleteReservation(a,n,i,r,o,s),e.preventDefault()}),$(".tb-editBtn").unbind("click").bind("click",function(e){var t=$(this).parents(".tb-row"),a={};a.idLevnr=t.find(".tb-idLevnr").val(),a.idReg=t.find(".tb-idReg").val(),a.idOvrigt=t.find(".tb-idOvrigt").val(),a.idReminder=t.find(".tb-idReminder").val(),a.idEpost=t.find(".tb-idEpost").val(),a.idMobil=t.find(".tb-idMobil").val(),a.reservationId=t.find(".tb-reservationId").val(),a.speditorNo=t.find(".tb-speditorNo").val(),a.customerNo=t.find(".tb-customerNo").val(),a.customerName=t.find(".tb-customerName").val(),a.transportOrderNo=t.find(".tb-transportOrderNo").val(),a.contractNo=t.find(".tb-contractNo").val(),a.reminderEmail=t.find(".tb-reminderEmail").val(),a.reminderSms=t.find(".tb-reminderSms").val(),a.fromDateTime=t.find(".tb-fromDateTime").val(),a.itemInfo=t.find(".tb-item").html(),a.quantity=t.find(".tb-quantity").html(),a.unit=t.find(".tb-unit").html(),a.owner=t.find(".tb-owner").val(),a.resourceName=t.find(".tb-resourceName").val(),a.dateRegistered=t.find(".tb-dateRegistered").val(),a.displayMessage="Tid: "+a.fromDateTime+", Kund: "+a.customerNo+" "+a.customerName+", Bokningsnr: "+a.reservationId+", Artikel: "+a.itemInfo+" "+a.quantity+" "+a.unit+"<br />Resurs: "+a.resourceName,TimeBookingFunction.copyValuesToEnableEdit(a,!1),e.preventDefault()}),$(document).trigger("enhance.tablesaw"),e(!0)):($(".tb-deleteBtn").unbind("click"),$(".tb-editBtn").unbind("click"),e(!1)),$(".bookingRows").change(function(){var e=!1;$(".bookingRows").each(function(){$(this).prop("checked")&&(e=!0)}),e?($("#SaveTable").show(),$("#saveBtn").removeClass("disabled-btn"),clearForm(),TimeBookingFunction.clearValidateSaveTable()):($("#SaveTable").hide(),$("#saveBtn").hide(),$("#saveBtn").addClass("disabled-btn"))}),TimeBookingFunction.unBlockUI()},error:function(){TimeBookingFunction.unBlockUI(),e(!1),alert("Error")}})}}},validateFieldsForReservation=function(e){var t=[];""==jQuery.trim($("#quantityTxt").val())&&(t[t.length]="<li>Kvantitet saknar värde.</li>");var a=parseInt(jQuery.trim($("#quantityTxt").val()),10);if((isNaN(a)||a<=0)&&(t[t.length]="<li>Kvantitet måste ha ett värde större än 0.</li>"),""==jQuery.trim($("#customerNo").val())&&(t[t.length]="<li>Ingen gilltigt kund har valts.</li>"),""==jQuery.trim($("#veichleTypeDrp").attr("data-value"))&&(t[t.length]="<li>Fordonstyp saknas.</li>"),""==jQuery.trim($("#selectedDate").val())&&(t[t.length]="<li>Datum saknas.</li>"),""==jQuery.trim($("#articlesDrp").attr("data-value"))&&(t[t.length]="<li>Artikel saknas.</li>"),""==jQuery.trim($("#resourceDrp").attr("data-value"))&&(t[t.length]="<li>Resurs saknas.</li>"),!e){var n=$("#resourceDrp").attr("data-value"),i=$("#selectedDate").val(),r=$("#agrementDriedUnDried").val(),o=$("#articlesDrp").attr("data-value"),s=$("#quantityTxt").val(),l=$("input[name='loadOrUnlodRad']:checked").val(),d=$("#veichleTypeDrp").attr("data-value"),c=$("#search-option").attr("data-value"),u=$("#customerNo").val(),p=$("#seachFieldTxt").val();if(""!=n&&""!=i&&""!=s&&(""!=o||""!=argementValue)){var m="{'resourceGroupId':'"+n+"', 'selectedDate':'"+i+"', 'article':'"+o+"', 'qty':'"+s+"', 'loadunload':'"+l+"', 'veichleType':'"+d+"', 'driedUnDried':'"+r+"', 'customerNo':'"+u+"','searchType':'"+c+"', 'iONumber':'"+p+"'}";$.ajax({type:"POST",url:"/api/time-booking/ExistBooking",dataType:"json",contentType:"application/json; charset=utf-8",data:m,async:!1,success:function(e){1==e.IsExistBooking&&(t[t.length]="<li>Det finns redan en bokning på inköpsordern. Radera befintlig bokning innan du kan skapa en ny!</li>")},error:function(){alert("ExistBooking")}})}}return t},makeReservation=function(){var e=function(e){var t=[],a="",n=0,i=0;t[t.length]="<h4>Bokningar:</h4>",t[t.length]="<p>";for(var r=0;r<e.length;r++)200==e[r].Status?(r>0&&(t[t.length]="<br /><br />"),t[t.length]=e[r].StartDate,t[t.length]=" kl: ",t[t.length]=e[r].StartTime,t[t.length]="<br />",t[t.length]=e[r].CustomerNo,t[t.length]=" ",t[t.length]=e[r].CustomerName,n++):(i++,t[t.length]=e[r].ErrorMessage);t[t.length]="<br />",t[t.length]="</p>",i>0&&0===n?a="Fel uppstod vid bokningen":i>0&&n>0?a="Alla bokningar gick inte igenom":0==i&&n>0&&(a="Bokningar sparade"),TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea",a,t.join(""),!0,dialogType.success),$("#saveBtn").addClass("disabled-btn"),clearForm(),searchAvailableSlots()},t=function(e){TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea","Bokningsfel","Fel uppstod när boking skulle registreras.",!0,dialogType.error)},a=validateFieldsForReservation(!1);if(a.length>0){TimeBookingFunction.clearContentToModal("#dialogArea");var n=$("<p></p>").append($("<ul></ul>").append(a.join("")));return TimeBookingFunction.fillContentToModal("#dialogArea","Uppgifter saknas",n,!0,dialogType.error),!1}!function(){var a=[],n={Agrement:""};n.SearchValue=$("#seachFieldTxt").val(),n.Qty=$("#quantityTxt").val(),n.VehicleAssortmentID=$("#veichleTypeDrp").attr("data-value"),n.ResourceId=$("#resourceDrp").attr("data-value"),n.Note=$("#IDOvrigt").val(),n.ReminderInMinutesBefore=$("#IDReminder").attr("data-value"),n.EmailAddress=$("#IDEpost").val(),n.CustomerName=$("#customerName").val(),n.CustomerNo=$("#customerNo").val(),n.Dried=$("#agrementDriedUnDried").val(),n.SearchType=$("#search-option").attr("data-value"),n.SelectedDate=$("#selectedDate").val(),n.Item=$("#articlesDrp").attr("data-value"),n.Leveransforsakransnummer=$("#IDLevnr").val(),n.LicensePlateNo=null!=$("#IDReg").val()?$("#IDReg").val():"",n.MobilePhone=$("#IDMobil").val(),n.IsInternal=$("#IsInternal").val();var i=$("div").data("Linenumber");null==i&&(i=0),n.LineNumber=i;var r="2"===$("input:radio[name='loadOrUnlodRad']:checked").val();if(TimeBookingFunction.validateSaveTable(n.EmailAddress,n.MobilePhone,n.LicensePlateNo,n.Leveransforsakransnummer))if($(".bookingRows").each(function(){if($(this).is(":checked")){var e={};e.FromTime=$(this).attr("fromtime"),e.ResourceId=$(this).attr("resursid"),1==r?(e.Loading="false",e.Unloading="true"):(e.Loading="true",e.Unloading="false"),a.push(e)}}),a.length>0){n.Reservations=a;var o={};o.reservationToMake=n,$.ajax({type:"POST",url:"/api/time-booking/MakeReservation",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(o),success:function(t){e(t.makeReservations)},error:function(e){t(e)}})}else{TimeBookingFunction.clearContentToModal("#dialogArea");var s=$("<p></p>").append("Inga tider valda");TimeBookingFunction.fillContentToModal("#dialogArea","Tider saknas",s,!0)}}()},searchAvalibleSlotAction=function(){clearForm(),$("#resultTable").hide(),$(".resultCaption").hide(),$("#resultTable-box").removeClass("has-separator"),$("#SaveTable").hide(),$("#saveBtn").hide(),searchAvailableSlots()},validateButtonSearchEvent=function(){$("#seachFieldTxt").unbind("keyup").keyup(function(){""!==$(this).val()?$("#searcFieldhBtn").removeClass("disabled-btn"):$("#searcFieldhBtn").addClass("disabled-btn")}),$("#seachFieldTxt").unbind("change").change(function(){""!==$(this).val()?$("#searcFieldhBtn").removeClass("disabled-btn"):$("#searcFieldhBtn").addClass("disabled-btn")})},makeReservationEvent=function(){$("#saveBtn").click(function(){makeReservation()})},updateReservationEvent=function(){$("#updateBtn").click(function(){updateReservation()})},validateRequiredFieldsEvent=function(){$("#form-time-booking").unbind("change").change(function(){validateRequiredFieldsForSearch()?$("#searchAvailbleSlotsBtn").parent().removeClass("disabled-btn"):$("#searchAvailbleSlotsBtn").parent().addClass("disabled-btn")}),$("#quantityTxt").unbind("keyup").keyup(function(){validateRequiredFieldsForSearch()?$("#searchAvailbleSlotsBtn").parent().removeClass("disabled-btn"):$("#searchAvailbleSlotsBtn").parent().addClass("disabled-btn")}),setDropdown($("#resourceDrp").parent(),"type3"),$(".searchSlotRequired .dropdown li a").on("click",function(){validateRequiredFieldsForSearch()?$("#searchAvailbleSlotsBtn").parent().removeClass("disabled-btn"):$("#searchAvailbleSlotsBtn").parent().addClass("disabled-btn")}),validateRequiredFieldsForSearch()?$("#searchAvailbleSlotsBtn").parent().removeClass("disabled-btn"):$("#searchAvailbleSlotsBtn").parent().addClass("disabled-btn")},searchItemEvent=function(){$("#resourceDrp .dropdown li a").on("click",function(){var e=$(this).parent().attr("data-value");searchItems("",e);var t=$(this).parent().attr("regNoMandatory");null!=t&&"true"==t.toLowerCase()?$("#IDReg").addClass("updateRequiered"):$("#IDReg").removeClass("updateRequiered")}),$("#articlesDrp .dropdown li a").on("click",function(){var e=$(this).parent().attr("data-value");if(null!=e&&""!=e){var t=e.split("-");if(3==t.length){t[0];var a=t[1];a.length>=2&&(a=a.substring(0,1).toUpperCase()+a.substring(1)),$("#agrementDriedUnDried").val(a)}}}),$("#loadRadio").unbind("change").change(function(){searchItems("",$("#resourceDrp").attr("data-value"))}),$("#unloadradio").unbind("change").change(function(){searchItems("",$("#resourceDrp").attr("data-value"))}),$("#selectedDate").change(function(){searchItems("",$("#resourceDrp").attr("data-value"))})},searchAvailableSlotsEvent=function(){$("#searchAvailbleSlotsBtn").on("click",function(){searchAvalibleSlotAction()})},searchCustomerEvent=function(){$("#searcFieldhBtn").click(function(){searchCustomer()})},bokaSearchTypeChangeEvent=function(){$("#search-option > ul > li > a").click(function(){var e=$(this).html();$("#seachFieldTxt").attr("placeholder","Ange "+e.toLowerCase())})},searchCustomerWhenLoadPageEvent=function(){""!=$("#seachFieldTxt").val()?($("#searcFieldhBtn").removeClass("disabled-btn"),searchCustomer()):$("#searcFieldhBtn").addClass("disabled-btn")},init=function(){searchItemEvent(),validateRequiredFieldsEvent(),searchAvailableSlotsEvent(),makeReservationEvent(),updateReservationEvent(),searchCustomerEvent(),bokaSearchTypeChangeEvent(),searchCustomerWhenLoadPageEvent(),validateButtonSearchEvent(),$("#IDLevnr")&&!$("#IDLevnr").val()&&$("#IDLevnr").val($("#seachFieldTxt").val())};return{init:init,searchItems:searchItems,searchAvalibleSlotAction:searchAvalibleSlotAction}};$(document).ready(function(){(new ListingBookingPage).init(),$(document).trigger("enhance.tablesaw")});var ListingBookingPage=function(){var e=GroCommon.modalInfoClass,t={},a=function(){TimeBookingFunction.blockUI(),$("#SaveTable").hide(),$("#updateListBtn").hide();var e={};e.ResourceGroupId=$("#bl-resourceDrp").attr("data-value"),e.FromDate=$("#fromDateTxt").val(),e.ToDate=$("#toDateTxt").val(),e.RegNo=$("#RegNo").val(),e.CustomerNo=$("#customerNo").val(),e.IsInternal=$("#isInternal").val(),e.ReferenceType="",e.ReferenceNumber="",e.PurchseOrderLine="";var a={};a.request=e,t=e,$.ajax({type:"POST",url:"/api/listing-booking/SearchBookings",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),success:function(e){n(e),TimeBookingFunction.unBlockUI()},error:function(e){alert("Error: "+e),$("#search-result-book-listing").hide(),TimeBookingFunction.unBlockUI()}});var n=function(e){$("#search-result-book-listing").html(e),null==e.resultSearchBookings?$("#search-result-book-listing").show():$("#search-result-book-listing").hide(),r(),o(),i(),$(document).trigger("enhance.tablesaw")}},n=function(){$(".fieldToClearWithClearForm").val(""),$("#SaveTable").hide(),$("#updateListBtn").hide(),$("#IDEpost").val($("#IDEpost_StartValue").val()),$("#IDMobil").val($("#IDMobil_StartValue").val()),$("#saveAction").val("New"),$("#saveAction").val("New"),$("#myDisplayMessage").html(""),$("#dispalyMessageHeader").html("&nbsp;")},i=function(){var e=$("#printLink");$(e).unbind("click"),$(e).click(function(){var e="/api/pdfhandler/time-booking-list?FromDate=";e+=t.FromDate,e+="&ToDate=",e+=t.ToDate,e+="&CustomerNo=",e+=t.CustomerNo,e+="&ResourceGroupId=",e+=t.ResourceGroupId,e+="&listingUrl=";var a=window.location.pathname;window.location.pathname.startsWith("/lm/")&&(a=window.location.pathname.substring(3)),e+=a,e+="&pdfUrlSegment=/bokalistingpdf",window.open(e)})},r=function(){var t=$(".boka-listing-deleteBtn");$(t).unbind("click"),$(t).click(function(t){!function(t){var i=$(t).parent().parent(),r=i.find("> #reservationId").html(),o=i.find("#from-date").val(),s=i.find("#from-time").val(),l=i.find("> #owner").html(),d=i.find("> #customer-number").html(),c=$("<p></p>");c.append('<span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>'),c.append("Vill du verkligen radera bokningen<br /> kl: "+s+"?"),TimeBookingFunction.clearContentToDeleteDialog(),TimeBookingFunction.fillContentToDeleteDialog("Ta bort bokning?",c),$("#deleteDialog").find(".btn-ok").on("click",function(){u(r,l,d,o,s)});var u=function(t,i,r,o,s){n();var l={};l.reservationId=t,l.owner=i,l.customerNo=r,l.dateRegistered=o+" "+s,$.ajax({type:"POST",url:"/api/time-booking/DeleteReservation",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(l),success:function(e){d(e.deleteReservations)},error:function(e){c()}});var d=function(t){for(var n=$("<p></p>"),i=0;i<t.length;i++)500==t[i].Status&&n.append('<span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>'),n.append(t[i].Message+"<br />");TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea","Borttagning",n,e.error),a(),$("#SaveTable").hide(),$("#updateListBtn").hide()},c=function(){$("#SaveTable").hide(),$("#updateListBtn").hide(),alert("Fel uppstod vid anropet till tjänsten.")}}}($(this)),t.preventDefault()})},o=function(){var e=$(".boka-listing-editBtn");$(e).unbind("click"),$(e).click(function(e){var t,a,n;t=$(this),a={},n=$(t).parent().parent(),a.resourceName=n.find("#resourceName").val(),a.itemName=n.find("#itemName").val(),a.weight=n.find(">#weight").html(),a.fromTime=n.find("#from-time").val(),a.itemNo=n.find(">#itemNo").html(),a.idLevnr=n.find(">#leveransforsakransnr").html(),a.idReg=n.find(">#licensePlateNo").html(),a.idOvrigt=n.find("#note").val(),a.idReminder=n.find("#reminderMinutesBefore").val(),a.idEpost=n.find("#emailAddress").val(),a.idMobil=n.find("#mobileNo").val(),a.reservationId=n.find(">#reservationId").html(),a.speditorNo=n.find("#speditorNo").val(),a.customerNo=n.find(">#customer-number").html(),a.customerName=n.find("#customer-name").val(),a.transportOrderNo=n.find("#transportOrderNo").val(),a.contractNo=n.find("#contractNo").val(),a.reminderEmail=n.find("#reminderEmail").val(),a.reminderSms=n.find("#reminderSms").val(),a.owner=n.find(">#owner").html(),a.dateRegistered=n.find("#dateRegistered").val(),a.displayMessage="Tid: "+a.fromTime+", Kund: "+a.customerNo+" "+a.customerName+", Bokningsnr: "+a.reservationId+", Artikel: "+a.itemNo+" "+a.itemName+a.weight+"<br />Resurs: "+a.resourceName,TimeBookingFunction.copyValuesToEnableEdit(a,!0),TimeBookingFunction.clearValidateSaveTable(),e.preventDefault()})},s=function(){$("#updateListBtn").unbind("click"),$("#updateListBtn").click(function(){!function(){var t=$("#IDEpost").val(),i=$("#IDMobil").val(),r=$("#IDReg").val(),o=$("#IDLevnr").val();if(TimeBookingFunction.validateSaveTable(t,i,r,o)){var s=$("#form-list-booking");$.ajax({type:"POST",url:"/api/time-booking/UpdateReservation",data:s.serialize(),success:function(e){l(e.updateReservations)},error:function(e){d(e.updateReservations)}})}var l=function(t){for(var i=$("<p></p>"),r=0;r<t.length;r++)200==t[r].Status?i.append(t[r].Message):i.append(t[r].ErrorMessage),i.append("<br />");TimeBookingFunction.clearContentToModal("#dialogArea"),TimeBookingFunction.fillContentToModal("#dialogArea","Bokningen uppdaterad",i,e.error),n(),$("#SaveTable").hide(),$("#updateListBtn").hide(),a()},d=function(){$("#SaveTable").hide(),alert("updateReservationError"),a()}}()})};return{init:function(){$("#search-booking-button").click(function(e){$("#RegNo").val(),$("#RegNo").removeClass("error"),$("#RegNo-error").hide(),a(),e.preventDefault()}),s()}}};jQuery(function(){CustomerCard.init()});var CustomerCard=CustomerCard||function(){var e="",t="",a={delError:"",updateError:""};function n(){$(".js-add-owner-loader").show()}function i(){$(".js-add-owner-loader").hide()}function r(){$("#js-add-owner-checkbox").change(function(){$(this).is(":checked")?$("#js-has-owner").val()||$(".js-add-owner").removeClass("hidden"):($(".js-add-owner").addClass("hidden"),$(".js-add-owner-modal").show())}),$(".js-add-owner-check-user").click(function(){var t,a=$(".js-add-owner-epost").val();a&&(t=a,n(),$.ajax({url:"/api/customer-card/check-owner",type:"POST",data:{username:t,customernumber:e},dataType:"json",success:function(e){i(),e?e.error?($(".js-add-owner-error").html(e.error),$(".js-add-owner-information").html(""),$(".js-add-owner-save").addClass("hidden")):($(".js-add-owner-information").html('<div class="existing-user js-add-owner-information"><h3 class="heading-title-3"> Användaren finns i LM2</h3><p> <strong>Namn:</strong> '+e.firstName+" "+e.lastName+"</p><p> <strong>Telefon:</strong> "+e.telephone+"</p><p> <strong>Mobil:</strong> "+e.mobile+"</p><p> <strong>E-post:</strong> "+e.email+"</p></div>"),$(".js-add-owner-save").removeClass("hidden"),$(".js-add-owner-error").html()):$(".js-add-owner-save").addClass("hidden")},error:function(){i(),$(".js-add-owner-error").html("Ett fel inträffade"),$(".js-add-owner-information").html(""),$(".js-add-owner-save").addClass("hidden")}}))}),$(".js-add-owner-inactivate").click(function(){alert("Not implemented yet")}),$(".js-add-owner-save").click(function(){var a,r=$(".js-add-owner-epost").val();r&&e&&t&&(a=r,n(),$.ajax({url:"/api/customer-card/add-owner",type:"POST",data:{username:a,customernumber:e,organizationnumber:t},dataType:"json",success:function(e){i(),e?e.error?$(".js-add-owner-error").html(e.error):($(".js-add-owner").addClass("hidden"),$("#js-activated-confirmation").removeClass("hidden"),setTimeout(function(){location.href=window.location},2e3)):$(".js-add-owner-error").html("Kunde inte lägga till ägare")},error:function(){i(),$(".js-add-owner-error").html("Ett fel inträffade")}}))}),$(".js-add-owner-cancel, .js-add-owner-close").click(function(){$(".js-add-owner").addClass("hidden"),$("#js-add-owner-checkbox").prop("checked",!1)}),$(".js-add-owner-epost").keydown(function(){$(".js-add-owner-information").html(""),$(".js-add-owner-save").addClass("hidden")})}function o(){$("a.user-profile").each(function(t,n){$(n).click(function(){var t=$(n).closest("li.showcase").attr("data-value"),i=$(n).attr("data-userName"),r=$(n).closest("td").find(".loader-wrapper"),o=$(n).closest("td").find(".confirm-panel .confirm-box");if(o.length>0){var d=$(o);d.show(),$("input[type=reset]",d).click(function(){d.hide()}),$("input[type=button]",d).click(function(){var n,o,c,u,p,m;s(r),n=i,o=t,c=e,u=function(){d.hide()},p=function(){a.updateError},m=function(){l(r),d.hide()},$.ajax({url:"/api/customer-card/change-profile?userName="+n+"&profileId="+o+"&customerNo="+c,type:"GET",dataType:"json",success:function(e){e?u():p()},error:function(e,t,a){p()},complete:function(){m()}})})}})}),$(".js-disconnect-user-from-customer").click(function(){var t=$(this).attr("data-userName"),n=$(this).attr("data-userId"),i=$(this).closest("tr"),r=$(i).find(".loader-wrapper"),o=$("#dg-del-user-confirmation");o.length>0&&(o.fadeIn(),$("button.yes").click(function(){var o,d,c,u,p,m;s(r),o=t,d=n,c=e,u=function(){$(i).remove()},p=function(){a.delError},m=function(){l(r)},$.ajax({url:"/api/customer-card/remove-user?userName="+o+"&userId="+d+"&customerNo="+c,type:"GET",dataType:"json",success:function(e){e?u():p()},error:function(e,t,a){p()},complete:function(){m()}})}))})}function s(e){null!=e&&$(e).show()}function l(e){null!=e&&$(e).hide()}return{init:function(){e=$("input#customer-no")?$("input#customer-no").val():"",t=$("input#org-no")?$("input#org-no").val():"",o(),r(),$(".js-page-identifier-customer-card-user-list").length&&($(".js-page-identifier-customer-card-user-list").data("debug")?$.getScript("/Static/dist/scripts/customerCardUserList.js"):$.getScript("/Static/dist/scripts/customerCardUserList.production.js"))}}}();window.gro=window.gro||{},gro.modules=gro.modules||{},gro.modules.internalNavigation=function(){var e={toggleNavigation:function(e,t){t=t;e.hasClass("expanded")?t||e.removeClass("expanded"):e.addClass("expanded")},init:function(){$(".js-internal-navigation-category").on("click",function(t){t.preventDefault();var a=this,n=$(a).next(".internal-navigation__list--sub-level"),i=$(a).parents(".internal-navigation");$(a).hasClass("is-expanded")?$(n).slideUp("fast",function(){$(a).removeClass("is-expanded"),$(n).removeClass("is-expanded").removeAttr("style")}):($(a).addClass("is-expanded"),$(n).slideDown("fast",function(){$(n).addClass("is-expanded").removeAttr("style")})),e.toggleNavigation(i,!0)}),$(".internal-navigation__toggle-btn").on("click",function(t){t.preventDefault();var a=$(this).parent().find(".internal-navigation__list--sub-level"),n=$(this).parents(".internal-navigation");e.toggleNavigation(n),$(a).slideUp(function(){$(this).prev().removeClass("is-expanded"),$(this).removeClass("is-expanded").removeAttr("style")})})}};$(function(){e.init()})}(),$(function(){var e=function(){var e=function(){var e=$(".cookie-information");(function(e){for(var t=e+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){for(var i=a[n];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return""})("_acceptCookies")||e.removeClass("is-hidden")};return $(".js-accept-cookies").on("click",function(){!function(e,t,a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var i="expires="+n.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"}("_acceptCookies","yes",365),$(".cookie-information").fadeOut("200",function(){$(this).addClass("is-hidden")})}),{init:function(){return e(),!1}}};$(document).ready(function(){(new e).init()})}),$(function(){var e=function(){var e=0,t=0,a=0,n=0,i=0,r=0,o=0,s=0,l=0,d=0,c=0,u=0,p=function(e,t){return $.ajax({dataType:"json",url:"/api/grainbalance/getcroplist",type:"get",data:{year:e,usersCrops:t},cache:!1})},m=function(e,t){$(".grain-balance__edit-crop").find(".loader-wrapper").removeClass("hidden"),$("#js-my-crop-type").empty(),e&&$(".js-harvest-year").val(e);var a=$(".js-harvest-year").val();$.when(p(a,!0)).done(function(e){$(".grain-balance__edit-crop").find(".loader-wrapper").addClass("hidden"),e.length>0&&($("#js-my-crop-type").append($('<option value="0">Alla grödor</option>')),$.each(e,function(e,a){var n=t&&a.CropId===t?"selected":"";0!=a.CropId&&$("#js-my-crop-type").append($('<option value="'+a.CropId+'" '+n+">"+a.CropName+"</option>"))}))})},h=function(){$(".grain-balance__edit-crop").find(".loader-wrapper").removeClass("hidden"),$("#js-crop-type-add").empty();var e=$("#crop-year").val();$.when(p(e,!0),p(e,!1)).done(function(e,t){$(".grain-balance__edit-crop").find(".loader-wrapper").addClass("hidden"),$.each(t[0],function(t,a){if("Alla grödor"===a.CropName)return!0;var n=!0;$.each(e[0],function(e,t){a.CropId===t.CropId&&(n=!1)}),!0===n&&$("#js-crop-type-add").append($("<option>",{value:a.CropId,text:a.CropName}))})})},f=function(i,r){var p=$(".js-harvest-year").val(),m=$(".js-cropid").val();i&&(m=i),$(".grain-balance__edit-crop").find(".loader-wrapper").removeClass("hidden"),$.when(b(m,p),v(m,p),w(m,p),y(m,p)).done(function(i,p,h,f){var v,b;u=f[0],C(m,i[0]),g(m,r,p[0]),v=m,(b=h[0])?($(".grain-balance__edit-data.areal  .grain-balance__label").html(b.Area.toFixed(2)+" ha"),$(".grain-balance__edit-data.areal  .grain-balance__input").val(b.Area),$(".grain-balance__edit-data.production-cost  .grain-balance__label").html(Math.round(b.ProductionCost)+" SEK/ton"),$(".grain-balance__edit-data.production-cost  .grain-balance__input").val(b.ProductionCost),$(".grain-balance__edit-data.expected-outcome  .grain-balance__label").html(b.HarvestForecast.toFixed(2)+" ton/ha"),$(".grain-balance__edit-data.expected-outcome  .grain-balance__input").val(b.HarvestForecast),$(".grain-balance__edit-data.own-consumption  .grain-balance__label").html(Math.round(b.HarvestForPrivateUse)+" ton"),$(".grain-balance__edit-data.own-consumption  .grain-balance__input").val(b.HarvestForPrivateUse),$(".grain-balance__input.id").val(b.Id),v&&0!=v?($(".grain-balance__edit-column").removeClass("hidden"),$("#js-grain-balance-result").removeClass("hidden")):($(".grain-balance__edit-column").addClass("hidden"),$("#js-grain-balance-result").addClass("hidden")),a=b.ProductionCost,n=b.Area*b.HarvestForecast,d=b.HarvestForPrivateUse):($(".grain-balance__edit-data.areal  .grain-balance__label").html("-"),$(".grain-balance__edit-data.areal  .grain-balance__input").val(""),$(".grain-balance__edit-data.production-cost  .grain-balance__label").html("-"),$(".grain-balance__edit-data.production-cost  .grain-balance__input").val(""),$(".grain-balance__edit-data.expected-outcome  .grain-balance__label").html("-"),$(".grain-balance__edit-data.expected-outcome  .grain-balance__input").val(""),$(".grain-balance__edit-data.own-consumption  .grain-balance__label").html("-"),$(".grain-balance__edit-data.own-consumption  .grain-balance__input").val(""),$(".grain-balance__edit-column").addClass("hidden"),a=0,n=0,d=0),function(){var i=e+l,r=n-d,p=(o=r-(c=t+s))>0?c+o:c,m=o>0?u*o:0;i=m>0?i+m:i;var h=p>0?i/p-a:0,f=p*h;$(".js-grain-balance-avg-result").text(Math.round(h)),$(".js-grain-balance-total-result").text(Math.round(f)),$(".js-grain-balance-total-tonage").text(Math.round(c)+" ton"),$(".js-grain-balance-total-forecast-tonage").text(Math.round(r)+" ton"),o>=0?($(".js-grain-balance-label-left-to-sell").text("Kvar att sälja"),$(".grain-balance__legend-icon--left-to-sell").css("background-color","#008834")):($(".js-grain-balance-label-left-to-sell").text("Överskrider förväntat utfall"),$(".grain-balance__legend-icon--left-to-sell").css("background-color","#f59c00")),$(".js-grain-balance-left-to-sell").text(Math.round(o)+" ton")}(),j(),$(".grain-balance__edit-crop").find(".loader-wrapper").addClass("hidden")})},g=function(e,t,a){if($(".js-grain-balance-agreements-other").html(""),a&&a.cropAgreements&&a.cropAgreements.length>0){$(".js-grain-balance-other-no-agreements").addClass("hidden"),s=a.totalQuantity,l=a.totalPrice,$.each(a.cropAgreements,function(e,t){t.index=e});var n=$.templates("#grain-balance-agreements-other-template");e&&0!=e&&$(".js-grain-balance-agreements-other").html(n.render(a)),t&&$("#js-order-other").trigger("click")}else s=0,l=0,$(".js-grain-balance-other-no-agreements").removeClass("hidden")},v=function(e,t){return $.ajax({dataType:"json",url:"/api/grainbalance/getothergreements",type:"get",data:{year:t,cropId:e},cache:!1,success:function(e){},error:function(){}})},b=function(e,t){return $.ajax({dataType:"json",url:"/api/grainbalance/getagreements",type:"get",data:{year:t,cropId:e},cache:!1,success:function(e){},error:function(){}})},w=function(e,t){return $.ajax({dataType:"json",url:"/api/grainbalance/getcropdata",type:"get",data:{year:t,cropId:e},cache:!1,success:function(e){},error:function(){}})},y=function(e,t){return $.ajax({dataType:"json",url:"/api/grainbalance/getcropprice",type:"get",data:{year:t,cropId:e},cache:!1,success:function(e){},error:function(){}})},C=function(a,n){$(".js-grain-balance-agreements-with-price").html(""),$(".js-grain-balance-agreements-no-price").html("");var o="Prissatta avtal",s="Ej prissatta avtal";if(n&&n.length>0){var l=$.templates("#grain-balance-agreements-lantmannen-template");i=0,r=0;var d=0,c=0;$.each(n,function(e,t){t.index=e});var u=$.grep(n,function(e){return 1===e.Group}),p=$.grep(n,function(e){return 2===e.Group});if($.each(u,function(e,t){i+=t.TotalQuantity,d+=t.TotalPrice}),u.length>0){$(".js-grain-balance-no-agreements-with-price").addClass("hidden");var m=i>0?Math.round(d/i):0;o=o+" ("+i+" ton, "+m+" SEK/ton)"}else $(".js-grain-balance-no-agreements-with-price").removeClass("hidden");if($.each(p,function(e,t){r+=t.TotalQuantity,c+=t.TotalPrice}),p.length>0){$(".js-grain-balance-no-agreements-with-no-price").addClass("hidden");var h=r>0?Math.round(c/r):0;s=s+" ("+r+" ton, "+h+" SEK/ton)"}else $(".js-grain-balance-no-agreements-with-no-price").removeClass("hidden");e=d+c,t=i+r,a&&0!=a&&($(".js-grain-balance-agreements-with-price").html(l.render(u)),$(".js-grain-balance-agreements-no-price").html(l.render(p)))}else $(".js-grain-balance-no-agreements-with-price").removeClass("hidden"),$(".js-grain-balance-no-agreements-with-no-price").removeClass("hidden"),e=0,t=0,i=0,r=0;a&&0!=a?$("#js-grain-balance-wrapper-order").removeClass("hidden"):$("#js-grain-balance-wrapper-order").addClass("hidden"),$(".js-add-owner-price-heading").text(o),$(".js-add-owner-noprice-heading").text(s)},k=function(e,t){var a="";e.forEach(function(e){"HarvestYear"===e.name&&(a=e.value)}),$.ajax({dataType:"json",url:"/api/grainbalance/savecropdata",type:"post",data:e,cache:!1,success:function(e){$(".js-grain-balance-agreements-with-price").html(""),e&&(t&&m(a,e),f(e,!1))},error:function(){}})},_=function(e){return e.forEach(function(e){"HarvestYear"===e.name&&e.value}),$.ajax({dataType:"json",url:"/api/grainbalance/saveotheragreement",type:"post",data:e,cache:!1,success:function(e){},error:function(){}})},D=function(e){$().validate&&$(e).validate({errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{Area:{required:!0,number:!0},ProductionCost:{required:!0,digits:!0},HarvestForecast:{required:!0,number:!0},HarvestForPrivateUse:{digits:!0}},messages:{Area:{required:"Du måste ange areal",number:"Ange ett numerisk värde"},ProductionCost:{required:"Du måste ange produktionskostnad ",digits:"Ange ett numerisk heltal"},HarvestForecast:{required:"Du måste ange förväntat utfall",number:"Ange ett numerisk värde"},HarvestForPrivateUse:{digits:"Ange ett numerisk heltal"},cropText:{required:"Du måste ange namn på gröda"}}})},T=function(e){$().validate&&$(e).validate({errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{Date:{required:!0,date:!0},Quantity:{required:!0,digits:!0},Price:{required:!0,digits:!0}},messages:{Date:{required:"Du måste ange Datum",date:"Ange ett datum"},Quantity:{required:"Du måste ange Kvantitet ",digits:"Ange ett numerisk heltal"},Price:{required:"Du måste ange Pris",digits:"Ange ett numerisk heltal"}}})};$(document).on("click",".js-grain-start",function(){$.ajax({dataType:"json",url:"/api/grainbalance/registerfirstvisit",type:"get",data:{},cache:!1,success:function(){$(".js-grain-balance-wrapper").removeClass("hidden"),$(".js-grain-balance-intro").addClass("hidden")},error:function(){}})}),$(document).on("click",".js-add-crop-submit",function(){var e=$(this).closest("form");if(e.valid()){var t=e.serializeArray(),a=$("#js-crop-type-add option:selected");t.push({name:"ItemNr",value:a.val()}),t.push({name:"Crop",value:a.text()}),k(t,!0),$("#grain-balance-add-crop").removeClass("is-active"),$("#grain-balance-edit-crop").addClass("is-active"),$(e).trigger("reset")}}),$(document).on("click",".js-edit-crop-submit",function(){var e=$(this).closest("form");if(e.valid()){var t=e.serializeArray(),a=$("#js-my-crop-type option:selected");t.push({name:"ItemNr",value:a.val()}),t.push({name:"Crop",value:a.text()});var n=$(".js-harvest-year option:selected");t.push({name:"HarvestYear",value:n.val()}),k(t,!1),e.removeClass("edit"),e.find(".grain-balance__crop-select").removeAttr("disabled")}}),$(document).on("click",".js-add-other-agreement",function(){var e=$(this).closest("form");if(e.valid()){var t=e.serializeArray(),a=$("#js-my-crop-type option:selected");t.push({name:"ItemNr",value:a.val()}),t.push({name:"Crop",value:a.text()});var n=$(".js-harvest-year option:selected");t.push({name:"HarvestYear",value:n.val()}),$.when(_(t)).done(function(t){S(),$(e).trigger("reset"),f(null,!0)})}}),$(document).on("submit",".js-edit-other",function(e){e.preventDefault();var t=$(this).closest("form");if(t.valid()){var a=t.serializeArray(),n=$("#js-my-crop-type option:selected");a.push({name:"ItemNr",value:n.val()}),a.push({name:"Crop",value:n.text()});var i=$(".js-harvest-year option:selected");a.push({name:"HarvestYear",value:i.val()}),$(this).removeClass("edit"),$.when(_(a)).done(function(e){f(null,!0)})}}),$(document).on("click",".js-delete-agreement",function(e){var t,a,n,i=$("#js-my-crop-type option:selected").val(),r=$(".js-harvest-year option:selected").val(),o=$(this).val();$(".grain-balance__edit-crop").find(".loader-wrapper").removeClass("hidden"),$.when((t=o,a=i,n=r,$.ajax({dataType:"json",url:"/api/grainbalance/deleteotheragreement",type:"post",data:{id:t,cropid:a,harvestYear:n},cache:!1,success:function(e){},error:function(){}}))).done(function(e){$(".grain-balance__edit-crop").find(".loader-wrapper").addClass("hidden"),f(null,!0)})}),$(document).on("change",".js-crop-type",function(){$(".js-crop-type-lm").is(":checked")&&($("#js-crop-type-add").removeClass("hidden"),$("#js-crop-type-text").addClass("hidden"),$("#js-crop-type-text").rules("remove","required")),$(".js-crop-type-other").is(":checked")&&($("#js-crop-type-add").addClass("hidden"),$("#js-crop-type-text").removeClass("hidden"),$("#js-crop-type-text").rules("add","required"))}),$(document).on("change","#crop-year",function(){h()});var j=function(){if($(".grain-balance__chart-area").length){Chart.plugins.register({afterDatasetsDraw:function(e,t){var a=e.ctx;e.data.datasets.forEach(function(t,n){var i=e.getDatasetMeta(n);i.hidden||i.data.forEach(function(n,i){a.font=Chart.helpers.fontString(14,"bold","clarendon-urw, serif");var r=t.data[i].toString();a.textAlign="center",a.textBaseline="middle",a.fillStyle="#444";var o=n.tooltipPosition();e.config.options.scales.xAxes[0].barThickness;"horizontal"===e.config.options.direction&&e.config.options.labels?r<0?a.fillText(r,o.x-7-10,o.y):r>0&&a.fillText(r,o.x+7+10,o.y):"vertical"===e.config.options.direction&&(r<0?a.fillText(r,o.x,o.y+r-7-10):r>=0&&a.fillText(r,o.x,o.y-7-10))})})}}),Chart.defaults.global.defaultFontFamily="akzidenz-grotesk-n4, akzidenz-grotesk, sans-serif",Chart.defaults.global.defaultFontColor="#909090",Chart.defaults.global.defaultFontSize="13",Chart.defaults.global.defaultFontStyle="normal";var e=$(".js-grain-balance-chart-expected-outcome-details"),t=(new Chart(e,{type:"bar",data:{labels:["Prissatta avtal","Ej prissatta avtal","Annan aktör","Egen förbrukning"],datasets:[{label:"Terminsavtal",backgroundColor:["#52a833","#adcd53","#006927","#76b843"],borderWidth:0,data:[i,r,s,d]}]},options:{direction:"vertical",labels:!0,responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1},events:!1,hover:{animationDuration:0},legend:{display:!1},layout:{padding:{left:0,right:0,top:30,bottom:0}},scales:{xAxes:[{barPercentage:.5,gridLines:{display:!1},ticks:{autoSkip:!1}}],yAxes:[{barPercentage:.5,ticks:{beginAtZero:!0,autoSkip:!1},gridLines:{color:"#efefef",zeroLineColor:"#efefef"},scaleLabel:{display:!0,labelString:"Ton"}}]}}}),$(".js-grain-balance-chart-expected-outcome"));new Chart(t,{type:"horizontalBar",data:{labels:["Förväntat utfall"],datasets:[{label:"Avtalad kvantitet",backgroundColor:["#dbe283"],borderWidth:0,data:[c]},{label:"Kvar att sälja",backgroundColor:[o>=0?"#008834":"#f59c00"],borderWidth:0,data:[o>0?o:0]}]},options:{direction:"horizontal",labels:!1,responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1},events:!1,hover:{animationDuration:0},legend:{display:!1},layout:{padding:{left:0,right:0,top:0,bottom:0}},scales:{xAxes:[{barThickness:30,stacked:!0,gridLines:{display:!1,color:"transparent"},scaleLabel:{display:!1},ticks:{display:!1}}],yAxes:[{barThickness:30,gridLines:{display:!1,color:"transparent"},ticks:{display:!1,beginAtZero:!0},stacked:!0}]}}})}};$(document).on("change",".js-harvest-year",function(){m(),f()}),$(document).on("change",".js-cropid",function(){f()}),$(document).on("click",".js-add-crop",function(){h(),$("#grain-balance-edit-crop").removeClass("is-active"),$("#grain-balance-add-crop").addClass("is-active")}),$(document).on("click",".js-close-add-crop",function(){$("#js-add-form").data("validator").resetForm(),$("#grain-balance-add-crop").removeClass("is-active"),$("#grain-balance-edit-crop").addClass("is-active")});var S=function(){$("#grain-balance-add-agreement").slideUp(150,function(){$(this).removeClass("is-active").removeAttr("style")})};return $(document).on("click",".js-add-agreement",function(){$("#grain-balance-add-agreement").hasClass("is-active")?S():$("#grain-balance-add-agreement").slideDown(200,function(){$(this).addClass("is-active").removeAttr("style")})}),$(document).on("click",".js-close-add-agreement",function(){$("#js-add-other").data("validator").resetForm(),S()}),$(document).on("click",".js-edit-crop",function(){var e=$(this).closest("form");e.addClass("edit"),e.find(".grain-balance__crop-select").attr("disabled","disabled")}),$(document).on("click",".js-edit-agreement",function(){$(this).closest("form").addClass("edit")}),$(document).on("click",".js-close-edit-crop",function(){var e=$(this).closest("form");e.removeClass("edit"),e.data("validator").resetForm(),e.find(".grain-balance__crop-select").removeAttr("disabled")}),$(document).on("click",".js-cancel-edit-agreement",function(){$(this).closest("form").removeClass("edit")}),$(document).on("submit",".grain-balance__edit-crop-form",function(e){e.preventDefault(),$(this).removeClass("edit")}),$(document).on("submit",".grain-balance__add-crop-form",function(e){e.preventDefault(),$("#grain-balance-add-crop").removeClass("is-active"),$("#grain-balance-edit-crop").addClass("is-active")}),$(".js-modal-orders-with-price").on("click",function(e){$("#modal-orders-with-price").fadeIn()}),$(".js-modal-orders-without-price").on("click",function(e){$("#modal-orders-without-price").fadeIn()}),{init:function(){return $(".js-grain-balance-agreements-with-price").length&&(D("#js-add-form"),D("#js-edit-form"),T(".js-edit-other"),T("#js-add-other"),$(".js-grain-balance-intro").length&&$.ajax({dataType:"json",url:"/api/grainbalance/isfirstvisit",type:"get",data:{},cache:!1,success:function(e){e?($(".js-grain-balance-intro").removeClass("hidden"),$(".js-grain-balance-wrapper").addClass("hidden")):($(".js-grain-balance-wrapper").removeClass("hidden"),$(".js-grain-balance-intro").addClass("hidden"))},error:function(){}}),m(),f()),!1}}};$(document).ready(function(){(new e).init()})}),jQuery(function(){UserCard.init()});var UserCard=UserCard||function(){return{init:function(){$(".js-delete-user").click(function(){var e=$("#delete-user-confirm");e.fadeIn(),$(".cancel",e).click(function(){e.fadeOut()}),$(".confirm",e).click(function(){e.fadeOut(),$("#delete-user-form").submit()})}),$(".js-disconnect-user").click(function(){var e=$(this).closest("form"),t=$("#disconnect-user-confirm");t.fadeIn(),$(".cancel",t).click(function(){t.fadeOut()}),$(".confirm",t).click(function(){e.submit(),t.fadeOut()})}),$(document).on("change",".js-row-checkbox",function(){var e=$(this).is(":checked"),t=$(this).closest(".js-role-row").find(".js-radio-container");e?t.removeClass("hidden"):t.addClass("hidden")}),$(".js-custom-profile").submit(function(e){e.preventDefault();var t=$(this).closest("form"),a=$(this).data("customerno"),n=$(this).data("username"),i=[],r=$(t).find(".js-role-row");$.each(r,function(e,t){var a=$(t).find(".js-row-checkbox:checked");if(a&&a.length>0){var n=$(t).find(".js-row-radio");if(n&&n.length>0){var r=$(t).find(".js-row-radio:checked");r&&r.length>0&&i.push(r.val())}else i.push(a.val())}});var o=$("#js-change-custom-roles-confirm");o.fadeIn(),$(".cancel",o).click(function(){o.fadeOut()});var s=$(".confirm",o);s.unbind("click"),$(s).click(function(){$.ajax({dataType:"json",url:"/api/usercard/save-roles",type:"post",cache:!1,data:{userName:n,customerNumber:a,roles:i},success:function(e){e&&$(t).closest(".js-user-company-row").find(".js-show-custom-roles").trigger("click")}}),o.fadeOut()})}),$("#js-profile-dropdown").change(function(e){var t=$(this).data("customerno"),a=$(this).data("username"),n=$("option:selected",this).val(),i=$(this).closest(".usercard-account-details").find(".js-custom-roles-button-container");"Anpassad"==n?i.removeClass("hidden"):(i.addClass("hidden"),$.ajax({dataType:"json",url:"/api/usercard/save-profile",type:"post",cache:!1,data:{userName:a,customerNumber:t,profileId:n},success:function(e){}}))}),$(document).on("click",".js-show-custom-roles",function(e){e.preventDefault();var t=this;$(t).closest(".setting-link").hasClass("is-active")?$(t).closest(".js-user-company-row").next(".lm__listing-block__item__options").slideUp("150",function(){$(t).closest(".setting-link").removeClass("is-active"),$(this).removeClass("is-expanded").removeAttr("style")}):($(t).closest(".setting-link").addClass("is-active"),$(t).closest(".js-user-company-row").next(".lm__listing-block__item__options").slideDown("150",function(){$(this).addClass("is-expanded").removeAttr("style")}))}),$(document).on("click",".js-close-custom-roles",function(e){e.preventDefault(),$(this).closest(".js-user-company-row").find(".js-show-custom-roles").trigger("click")}),$(".js-update-usersettings").click(function(){var e=[];$(this).closest(".message-settings-content").find(".js-setting-input").each(function(){e.push({CustomerOrgId:$(this).data("customerorgid"),MessageSettingsId:$(this).data("messagesettingid"),ModeOfDeliveryId:$(this).data("modeofdeliveryid"),MsgAreaId:$(this).data("areaid"),MsgTypeId:$(this).data("msgtypeid"),UserID:$(this).data("userid"),Value:!!$(this).is(":checked")})}),e.length>0&&$.ajax({dataType:"json",url:"/api/usercard/save-message-settings",type:"post",cache:!1,data:{settings:e},success:function(e){!0===e&&$("#confirm-save-message-settings").fadeIn()}})})}}}();window.gro=window.gro||{},gro.modules=gro.modules||{},gro.modules.tabNavigation=function(){var e={init:function(){if($(".js-tab").length){var t=gro.modules.url.getUrlParam("tab");if(t)e.switchTab(t);else{var a=$(".js-tab").first().data("tab");e.switchTab(a)}}$(document).on("click",".js-tab",function(t){t.preventDefault();var a=$(this).data("tab");$(this).data("tab-url")&&gro.modules.url.addUrlParam(null,"tab",a),e.switchTab(a)})},switchTab:function(e){var t=$("[data-tab='"+e+"']"),a=$(t).data("tab");t.length&&($(t).hasClass("is-active")||($(t).addClass("is-active").siblings(".tab-navigation__tab").removeClass("is-active"),$(t).closest(".tab-navigation__tab-container").next(".tab-navigation__tab-content-container").find(".tab-navigation__tab-content").removeClass("is-active").filter("[data-tab='"+a+"']").addClass("is-active")))}};$(function(){e.init()})}(),window.gro=window.gro||{},gro.modules=gro.modules||{},gro.modules.internalMessageSettings=function(){var e={init:function(){$(document).on("click",".js-message-settings-tab",function(e){e.preventDefault();var t=$(this).data("tab");$(this).hasClass("is-active")||($(this).addClass("is-active").siblings(".message-settings-tab").removeClass("is-active"),$(this).closest(".message-settings-tab-container").next(".message-settings-content-container").find(".message-settings-content").removeClass("is-active").filter("[data-tab='"+t+"']").addClass("is-active"))}),$(document).on("click",".js-open-message-settings",function(e){e.preventDefault();var t=this;$(t).closest(".setting-link").hasClass("is-active")?$(t).closest(".js-user-company-row").find(".js-user-card-message-settings").slideUp("150",function(){$(t).closest(".setting-link").removeClass("is-active"),$(this).removeClass("is-expanded").removeAttr("style")}):($(t).closest(".setting-link").addClass("is-active"),$(t).closest(".js-user-company-row").find(".js-user-card-message-settings").slideDown("150",function(){$(this).addClass("is-expanded").removeAttr("style")}))}),$(document).on("click",".js-close-message-settings",function(e){e.preventDefault();$(this).closest(".js-user-company-row").find(".js-open-message-settings").trigger("click")})}};$(function(){e.init()})}(),window.farmday=window.farmday||{},farmday.modules=farmday.modules||{},farmday.modules.toggle=function(){var e={},t={};return e.effect={FADE:"fade",SLIDE:"slide"},e.function={ACCORDION:"accordion"},e.init=function(){if($(".js-toggle").length){var a=gro.modules.url.getUrlParam("toggle");if(a){var n=$("[aria-controls='"+a+"']");t.show(n)}}$(document).on("click",".js-toggle",function(t){var a=$(this).data("toggle-target"),n=$(this).data("toggle-effect"),i=$(this).data("toggle-duration"),r=$(this).data("toggle-function"),o=e.isVisible(a);t.preventDefault(),t.stopPropagation(),o?e.hide(this,a,n,i):e.show(this,a,n,i,r)}),$(document).on("click",".js-trigger-toggle",function(){var t=$(this).data("target");$(".js-toggle[data-target='"+t+"'").each(function(){var a=e.isVisible(t),n=$(this).data("toggle-effect"),i=$(this).data("toggle-duration");a?e.hide(this,t,n,i):e.show(this,t,n,i)})})},e.show=function(t,a,n,i,r){var o=$(t).attr("aria-controls"),s=$(t).data("toggle-url");void 0===i&&(i=0),r===e.function.ACCORDION&&$(t).siblings(".collapse__control.is-active").each(function(){var t=$(this).data("toggle-target"),a=$(this).data("toggle-effect"),n=$(this).data("toggle-duration");e.hide(this,t,a,n)}),$(t).addClass("is-active").attr("aria-expanded",!0),n===e.effect.FADE?$(a).fadeIn(i,function(){$(a).addClass("is-active").attr("aria-hidden",!1).removeAttr("style")}):n===e.effect.SLIDE&&$(a).slideDown(i,function(){$(a).addClass("is-active").attr("aria-hidden",!1).removeAttr("style")}),s&&gro.modules.url.addUrlParam(document.location.search,"toggle",o)},e.hide=function(t,a,n,i){void 0===i&&(i=0),n===e.effect.FADE?$(a).fadeOut(i,function(){$(t).removeClass("is-active").attr("aria-expanded",!1),$(a).removeClass("is-active").attr("aria-hidden",!0).removeAttr("style")}):n===e.effect.SLIDE&&$(a).slideUp(i,function(){$(t).removeClass("is-active").attr("aria-expanded",!1),$(a).removeClass("is-active").attr("aria-hidden",!0).removeAttr("style")})},e.isVisible=function(e){return $(e).hasClass("is-active")},t.collapseAll=function(t){$(t).find(".collapse__control").each(function(){var t=$(this).data("toggle-target");e.hide(this,t,"slide",0)})},t.show=function(t){var a=$(t).data("toggle-target"),n=$(t).data("toggle-effect"),i=$(t).data("toggle-duration"),r=$(t).data("toggle-function");e.isVisible(a)||e.show(t,a,n,i,r)},t.hide=function(t){var a=$(t).data("toggle-target"),n=$(t).data("toggle-effect"),i=$(t).data("toggle-duration");e.isVisible(a)&&e.hide(t,a,n,i)},$(function(){e.init()}),t}(),$(function(){var e=function(){var e=0,t=0;function a(){$(".loader-wrapper").hide()}function n(){$(".loader-wrapper").show()}var i=function(t){n(),$.ajax({dataType:"json",url:"/api/myorders/getmyorders",type:"get",data:{index:t},cache:!1,success:function(n){if(a(),n&&n.length>0){var i=$.templates("#my-orders-template").render(n);$(".js-my-orders").append(i),$(".js-my-orders-text").removeClass("hidden"),t<e-1?$(".js-show-more-orders").removeClass("hidden"):$(".js-show-more-orders").addClass("hidden")}},error:function(){}})};return $(".js-show-more-orders").on("click",function(){i(t+=1)}),{init:function(){return $(".js-my-orders").length&&(n(),$.ajax({dataType:"json",url:"/api/myorders/getmyorderspages",type:"get",data:{},cache:!1,success:function(t){a(),t&&(e=t,t>0&&i(0))},error:function(){}})),!1}}};$(document).ready(function(){(new e).init()})}),window.farmday=window.farmday||{},farmday.modules=farmday.modules||{},farmday.modules.machine=function(){var e={init:function(){$(".js-page-identifier-machine").length&&($(".modal-trigger").click(function(e){var t=e.target.dataset.triggerModal;$("#"+t).removeClass("hidden")}),$("#add-machine-cancel").click(function(){var e=$(".js-page-identifier-machine").data("url");""!==e&&void 0!==e&&(location.href=e)}))}};$(function(){e.init()})}(),window.farmday=window.farmday||{},farmday.modules=farmday.modules||{},farmday.modules.contact=function(){var e={init:function(){if($(".js-page-identifier-contact").length){document.addEventListener("invalid",function(e){document.getElementById("query").focus()},!0);var e=document.getElementById("siteUserId").value;if(!e||0===e.trim().length)return;$(".workshop-star").click(function(t){e&&e.trim()&&($("section.lm__contents").addClass("inactive-view"),$.ajax({type:"POST",url:"/api/workshop/setstar",data:{city:t.target.dataset.city,newStarValue:"True"===t.target.dataset.star?"False":"True"},dataType:"json",cache:!1,success:function(){$(".marked").toggleClass("marked"),$(t.target).toggleClass("marked")}}).fail(function(){location.reload()}).always(function(){$("section.lm__contents").removeClass("inactive-view")}))})}}};$(function(){e.init()})}(),window.farmday=window.farmday||{},farmday.modules=farmday.modules||{},farmday.modules.startpage=function(){var e={};e.init=function(){if($(".js-page-identifier-startpage").length){$(".customer-number").on("input",function(e){(e.which<48||e.which>57)&&e.preventDefault();var t=$(this).closest("tr").data("orgnumber"),a=$(".update-button[data-form-id='org_"+t+"']");$(this).val()?a.removeClass("invisible"):a.addClass("invisible")});var e=$("#customer-table");$(".update-button").on("click",function(t){var a=t.target,n=$(t.target).data("formId"),i=$("#"+n),r=i.data("orgnumber"),o=i.find(".active-customer").is(":checked"),s=i.find(".customer-number")[0].value;if(s&&0!==s.trim().length||1!=o){e.css("pointer-events","none"),e.css("opacity",.6);var l=$("#org_"+r);$.ajax({type:"POST",url:"/api/customer-support/update",data:{organizationNumber:r,customerNumber:s,isActive:o},success:function(t){if(e.css("pointer-events","auto"),e.css("opacity",1),console.log(t),t.error)return l.css("outline","thin solid orange"),void l.find(".input-err").html(t.error);var n;l.find(".input-err").html(""),l.css("outline","none"),n=$(a).closest("tr").addClass("deleted").children("td"),setTimeout(function(){$(n).animate({paddingTop:0,paddingBottom:0},500).wrapInner("<div />").children().slideUp(500,function(){$(this).closest("tr").remove()})},1e3)},error:function(t,a,n){e.css("pointer-events","auto"),e.css("opacity",1),l.find(".input-err").html(""),$("#error-message").css("display","block")},dataType:"json"})}}),$(".active-customer").on("change",function(e){var t=$(e.target).is(":checked"),a=$(e.target).data("orgnumber"),n=$(".update-button[data-form-id='org_"+a+"']"),i=$("#active_"+a).find(".customer-number").val();t?($("#inactive_"+a).css("display","none"),$("#active_"+a).css("display","block"),i||n.addClass("invisible")):($("#inactive_"+a).css("display","block"),$("#active_"+a).css("display","none"),n.removeClass("invisible"))})}},$(function(){e.init()})}(),window.farmday=window.farmday||{},farmday.modules=farmday.modules||{},farmday.modules.login=function(){var e={init:function(){e.start(),e.validate()},start:function(){if($(".js-page-identifier-login").length){var e=document.getElementsByTagName("html");e.length>0&&(e[0].className+=" iam-html"),$("#email").on("invalid",function(e){e.preventDefault(),console.log(e),$("#error-message-label").removeClass("hidden")})}},validate:function(){$("#changePasswordSubmit").click(function(e){$("#changePasswordForm").validate({rules:{newPassword:{required:!0,regex:/^[A-Za-z0-9\d=!\-@.!#$%&()+={}[\:;'<>?,\]_\/*]*$/},retypeNewPassword:{equalTo:"#newPassword"}},messages:{newPassword:{required:"Du måste fylla i alla fälten för att kunna byta lösenord.",regex:"Lösenordet är inte av rätt typ. Se krav för nytt lösenord."},retypeNewPassword:"Lösenorden stämmer inte överens med varandra. Vänligen försök igen."},errorLabelContainer:".js-validate-error",wrapper:"li"}).form()?$("#changePasswordSubmit").submit():console.log("Failed")}),$("#resetPasswordSubmit").click(function(e){e.preventDefault(e),$("#loginform").validate({rules:{password:{required:!0,regex:/^[A-Za-z0-9\d=!\-@.!#$%&()+={}[\:;'<>?,\]_\/*]*$/},confirmpassword:{equalTo:"#password"}},messages:{password:{required:"Du måste fylla i alla fälten för att kunna byta lösenord.",regex:"Lösenordet är inte av rätt typ. Se krav för nytt lösenord."},confirmpassword:"Lösenorden stämmer inte överens med varandra. Vänligen försök igen."},errorLabelContainer:".js-validate-error",wrapper:"li"}).form()?$("#loginform").submit():console.log("Failed")})}};$(function(){e.init()})}(),window.farmday=window.farmday||{},farmday.modules=farmday.modules||{},farmday.modules.organization=function(){var e={init:function(){if($(".js-page-identifier-organization-add-user").length&&($(".js-page-identifier-organization-add-user").data("debug")?$.getScript("/Static/dist/scripts/addUserToOrganization.js"):$.getScript("/Static/dist/scripts/addUserToOrganization.production.js")),$(".js-page-identifier-organization-handle-user").length&&($(".js-page-identifier-organization-handle-user").data("debug")?$.getScript("/Static/dist/scripts/handleOrganizationUser.js"):$.getScript("/Static/dist/scripts/handleOrganizationUser.production.js")),$(".js-page-identifier-organization-delivery-address").length){$("ul.errors-list li").each(function(e,t){$(t).hide()}),jQuery.validator&&$("#editDeliveryAddress").validate({ignore:[],errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{AdressStreet:"required",ZipCode:{required:!0,zipCode:!0},Place:{required:!0},SilosName:{subItemRequired:function(){var e=!0;return $("input.silo-number").each(function(t,a){var n=$(a),i=n.val();i&&""!==i.toString()?n.hasClass("error")&&n.removeClass("error"):(e=!1,n.addClass("error"))}),e}},MobileNumber:{required:!0,mobileSE:!0}},messages:{AdressStreet:"Du måste ange Gatuadress",ZipCode:{required:window.validationMessage.zipCode.required,zipCode:window.validationMessage.zipCode.valid},Place:{required:"Du måste ange Ort"},SilosList:{},MobileNumber:{required:window.validationMessage.mobileSE.required,mobileSE:window.validationMessage.mobileSE.valid}},highlight:function(e,t,a){console.log("jquery validation"),$("ul.errors-list").show(),$("li#li_"+$(e).attr("id")).show(),$(e).addClass(this.settings.errorElementClass).removeClass(t)},unhighlight:function(e,t,a){$(e).hasClass("silo-number")||($(e).removeClass(this.settings.errorElementClass).removeClass(t),$("li#li_"+$(e).attr("id")).hide(),!1===$("ul.errors-list").find('li[id^="li"]').is(":visible")&&$("ul.errors-list").hide())}})}}};$(function(){e.init()})}(),window.gro=window.gro||{},gro.modules=gro.modules||{},gro.modules.myAgreements=function(){var e={init:function(){}};$(function(){e.init()})}(),window.gro=window.gro||{},gro.modules=gro.modules||{},gro.modules.manageElected=function(){var e={init:function(){$(".js-add-elected").length&&(e.addEmailValidation(),e.addCreateUserValidation(),e.bindEvents(),e.loadAllDistricts(),e.loadElectedForDistrict(400),e.loadDistrictsForElected(0))},bindEvents:function(){$(document).on("submit","#js-me-check-user",function(e){e.preventDefault();var t=$(this).closest("form");if(t.valid()){var a=t.serializeArray();$(".js-allready-elected").addClass("hidden"),$(".js-existing-user-information").hide(),$(".js-create-user").hide(),$.ajax({dataType:"json",url:"/api/manage-elected/find-existing",type:"post",data:a,cache:!1,success:function(e){e&&!$.isEmptyObject(e)?e.isElected?$(".js-allready-elected").removeClass("hidden"):($(".js-existing-user-information").slideDown("fast"),$(".js-user-name").text(e.firstName+" "+e.lastName),$(".js-user-telephone").text(e.telephone),$(".js-user-mobile").text(e.mobile),$(".js-user-email").text(e.email),$(".js-user-email").prop("href","mailto:"+e.email)):$(".js-create-user").slideDown("fast")},error:function(){}})}}),$(document).on("submit",".js-create-user",function(e){e.preventDefault();var t=$(this).closest("form");if(t.valid()){var a=t.serializeArray(),n=$("#js-me-check-user .js-add-owner-epost");a.push({name:"email",value:n.val()}),$.ajax({dataType:"json",url:"/api/manage-elected/add-new-user",type:"post",data:a,cache:!1,success:function(e){e&&!$.isEmptyObject(e)&&($(".js-user-name").text(e.firstName+" "+e.lastName),$(".js-user-telephone").text(e.telephone),$(".js-user-mobile").text(e.mobile),$(".js-user-email").text(e.email),$(".js-user-email").prop("href","mailto:"+e.email),$(".js-check-user").hide(),$(".js-create-user").hide(),$(".js-add-district").show(),$(n).val(""),$(t).trigger("reset"))},error:function(){}})}}),$(".js-filter-user-list").on("input change",function(){var e=$(this).data("list"),t=$(this).data("no-hits"),a=$(this).val(),n=!1,i=!1;$(".js-search-query").text(a),farmday.modules.toggle.collapseAll(e),$(e).find("button:not("+t+")").each(function(){var e=$(this);-1!==e.text().toLowerCase().indexOf(a.toLowerCase())?(n=!0,e.show()):(e.hide(),i=!0)}),n?$(t).hide():$(t).show(),i?$(".js-user-list-show-all-btn").css("display","inline-block"):$(".js-user-list-show-all-btn").hide()}),$(".js-user-list-show-all-btn").on("click",function(e){e.preventDefault();var t=$(this).data("query-element");$(t).val("").trigger("change")}),$(".js-show-add-elected-form").on("click",function(){$(".js-add-elected").slideToggle("fast")}),$(".js-cancel-add-elected").on("click",function(){$(".js-add-elected").slideUp("fast",function(){$(".js-existing-user-information").hide(),$(".js-add-district").hide(),$(".js-create-user").hide(),$(".js-check-user").show(),$(".js-add-owner-epost").val("")})}),$(".js-cancel-add-elected-existing-user").on("click",function(){$(".js-existing-user-information").slideUp("fast"),$(".js-add-owner-epost").val("")}),$(".js-add-as-elected").on("click",function(){$(".js-check-user").hide(),$(".js-add-district").show()}),$(".js-save-as-elected").on("click",function(){var t=$("#js-user-add-email"),a=$(this).closest("form").serializeArray();$.ajax({dataType:"json",url:"/api/manage-elected/add-existing-user",type:"post",data:{userName:t.text(),districts:a},cache:!1,success:function(t){t&&$(".js-add-elected").slideUp("fast",function(){$(".js-existing-user-information").hide(),$(".js-add-district").hide();var t=$("#js-all-districts").val();e.loadElectedForDistrict(parseInt(t)),$(".js-add-owner-epost").val(""),$(".js-check-user").show()})},error:function(){}})}),$(document).on("click",".js-save-edit-elected",function(){var t=$(this).closest("form"),a=$(t).find(".js-user-add-email").text(),n=t.serializeArray();$.ajax({dataType:"json",url:"/api/manage-elected/add-existing-user",type:"post",data:{userName:a,districts:n},cache:!1,success:function(t){if(t){var a=$("#js-all-districts").val();e.loadElectedForDistrict(parseInt(a))}},error:function(){}})}),$(document).on("click",".js-cancel-edit-elected",function(){farmday.modules.toggle.collapseAll(".js-user-list")}),$(document).on("click",".js-delete-elected",function(){var t=$(this).data("user");$.ajax({dataType:"json",url:"/api/manage-elected/delete-elected",type:"post",data:{userName:t},cache:!1,success:function(t){if(t){var a=$("#js-all-districts").val();e.loadElectedForDistrict(parseInt(a))}},error:function(){}})}),$(".js-back-from-add-district-to-select-user").on("click",function(){$(".js-add-district").hide(),$(".js-check-user").show()}),$(document).on("click",".js-add-district-to-elected",function(){var e=$(this).closest(".js-district-container"),t=e.find(".js-district-dropdown"),a=e.find(".js-district-list"),n=t.find(":selected"),i=e.find(".js-no-district-chosen");if(n.val()){var r={Name:n.val(),ReadRoleId:n.data("read"),WriteRoleId:n.data("write"),WriteRights:!1},o=$.templates("#elected-district-template");$(n).remove(),$(a).append(o.render(r)),i.addClass("is-hidden")}}),$(document).on("click",".js-delete-district",function(){var e=$(this),t={Name:e.data("name"),ReadRoleId:e.data("read"),WriteRoleId:e.data("write")},a=$.templates("#elected-add-district-dropdown-template"),n=$(this).closest(".js-district-container"),i=n.find(".js-district-dropdown"),r=n.find(".js-district-list");(i.append(a.render(t)),$(this).closest("li").remove(),0===r.children().length)&&n.find(".js-no-district-chosen").removeClass("is-hidden")}),$(document).on("change","#js-all-districts",function(){var t=$(this).val();e.loadElectedForDistrict(parseInt(t))}),$(document).on("click",".js-expand-elected",function(e){e.preventDefault();var t=$(this).closest(".js-elected"),a=t.find(".js-elected-details"),n=t.find(".show-details"),i=t.find(".js-hide-details");a.hasClass("is-expanded")?a.removeClass("is-expanded").slideUp("fast",function(){n.attr("colspan","1"),t.removeClass("is-expanded"),i.show()}):(t.addClass("is-expanded"),i.hide(),n.attr("colspan","2"),a.addClass("is-expanded").slideDown("fast"))})}};$(document).on("click",".js-elected-toggle",function(t){if(t.preventDefault(),$(this).hasClass("is-active"));else{var a=$(this).data("user");$.when(e.loadDistrictsForElectedAjax(a),e.loadDistrictsForElectedAjax(0)).done(function(e,t){var n=$("#elected-container-"+a),i=n.find(".js-district-dropdown");$(i).empty();var r=n.find(".js-district-list");$(r).empty();var o=$.grep(t[0],function(t,a){var n=!0;return $.each(e[0],function(e,a){t.Name==a.Name&&(n=!1)}),n}),s=$.templates("#elected-add-district-dropdown-template");$.each(o,function(e,t){$(i).append(s.render(t))});var l=$.templates("#elected-district-template");$.each(e[0],function(e,t){$(r).append(l.render(t))});var d=e[0].length,c=n.find(".js-no-district-chosen");0===d?c.removeClass("is-hidden"):c.addClass("is-hidden")})}}),e.loadAllDistricts=function(){$("#js-add-districts").empty(),$.ajax({dataType:"json",url:"/api/manage-elected/district-groups",type:"get",cache:!1,success:function(e){if(e){var t=$.templates("#elected-all-district-dropdown-template");$.each(e,function(e,a){$("#js-all-districts").append(t.render(a))})}},error:function(){}})},e.loadDistrictsForElected=function(t){$("#js-add-district-dropdown").empty(),$.when(e.loadDistrictsForElectedAjax(t)).done(function(e){if(e){var t=$.templates("#elected-add-district-dropdown-template");$.each(e,function(e,a){$("#js-add-district-dropdown").append(t.render(a))})}})},e.loadElectedForDistrict=function(t){$(".js-user-list").empty(),$.when(e.loadElectedForDistrictAjax(t)).done(function(e){if(e){var t=$.templates("#elected-user-list-template");$.each(e,function(e,a){a.Index=e,$(".js-user-list").append(t.render(a))})}})},e.loadDistrictsForElectedAjax=function(e){return $.ajax({dataType:"json",url:"/api/manage-elected/districts-for-elected",type:"post",data:{id:e},cache:!1,success:function(e){},error:function(){}})},e.loadElectedForDistrictAjax=function(e){return $.ajax({dataType:"json",url:"/api/manage-elected/elected-district",type:"post",data:{id:e},cache:!1,success:function(e){},error:function(){}})},e.addCreateUserValidation=function(){$().validate&&$(".js-create-user").validate({errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{firstName:{required:!0},lastName:{required:!0},mobile:{required:!0,mobileSE:!0},telephone:{phoneSE:!0}},messages:{firstName:{required:"Du måste ange förnamn"},lastName:{required:"Du måste ange efternamn"},mobile:{required:window.validationMessage.mobileSE.required,mobileSE:window.validationMessage.mobileSE.valid},telephone:{phoneSE:window.validationMessage.phoneSE.valid}}})},e.addEmailValidation=function(){$().validate&&$("#js-me-check-user").validate({errorElementClass:"error",errorClass:"error-item",errorElement:"span",rules:{email:{required:!0,email:!0}},messages:{email:{required:"Du måste ange en E-postadress",email:"Ange en korrekt epost"}}})},$(function(){e.init()})}(),window.farmday=window.farmday||{},farmday.modules=farmday.modules||{},farmday.modules.documentManagement=function(){var e={init:function(){$(document).on("change",".js-new-file-upload",function(){var e=$.templates("#new-file-created-template"),t=$(this).data("target"),a=$(this).val(),n=$(t).prev(".document-management__item-container"),i=$(this).closest("li").find(".js-toggle").first(),r={url:"/",name:a,className:"icon--document"};n.removeClass("is-empty"),$(t).prepend(e.render(r)),farmday.modules.toggle.show(i)}),$(document).on("click",".js-add-folder",function(){var e=$.templates("#create-new-folder-template"),t=$(this).data("target"),a=$(t).prev(".document-management__item-container"),n=$(this).closest("li").find(".js-toggle").first();a.removeClass("is-empty"),$(t).prepend(e.render()),farmday.modules.toggle.show(n)}),$(document).on("submit",".js-new-folder-form",function(e){var t=$.templates("#new-folder-created-template"),a=$(this).closest("li"),n=$(this).closest("ul"),i=$(this).find(".new-folder-input").val(),r={id:(new Date).getUTCMilliseconds(),name:i};e.preventDefault(),$(this).validate(),$(this).valid()&&(a.remove(),$(n).prepend(t.render(r)))}),$(document).on("click",".js-delete-file",function(){$(this).closest("li").remove()})}};$(function(){e.init()})}();